
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>imagen &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for imagen</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Objects capable of generating a two-dimensional array of values.</span>

<span class="sd">Such patterns can be used as input to machine learning, neural</span>
<span class="sd">network, or compuatational neuroscience algorithms, or for any other</span>
<span class="sd">purpose where a two-dimensional pattern may be needed.  Any new</span>
<span class="sd">PatternGenerator classes can be derived from these, and can then be</span>
<span class="sd">combined with the existing classes easily.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="n">__version__</span><span class="o">=</span><span class="s">&#39;$Revision$&#39;</span>


<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy.oldnumeric</span> <span class="kn">import</span> <span class="n">around</span><span class="p">,</span> <span class="n">bitwise_and</span><span class="p">,</span> <span class="n">bitwise_or</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">alltrue</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">fft</span><span class="p">,</span> <span class="n">flipud</span><span class="p">,</span> \
        <span class="n">floor</span><span class="p">,</span> <span class="n">fmod</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">hstack</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">multiply</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> \
        <span class="n">repeat</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="nb">max</span>

<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">ParamOverrides</span>
<span class="kn">from</span> <span class="nn">param</span> <span class="kn">import</span> <span class="n">ClassSelector</span>

<span class="c"># Imported here so that all PatternGenerators will be in the same package</span>
<span class="kn">from</span> <span class="nn">patterngenerator</span> <span class="kn">import</span> <span class="n">Constant</span><span class="p">,</span> <span class="n">PatternGenerator</span>

<span class="kn">from</span> <span class="nn">dataviews</span> <span class="kn">import</span> <span class="n">SheetStack</span>
<span class="kn">from</span> <span class="nn">dataviews.sheetcoords</span> <span class="kn">import</span> <span class="n">SheetCoordinateSystem</span>
<span class="kn">from</span> <span class="nn">dataviews</span> <span class="kn">import</span> <span class="n">boundingregion</span><span class="p">,</span> <span class="n">sheetcoords</span> <span class="c"># pyflakes:ignore (API import)</span>

<span class="kn">from</span> <span class="nn">patternfn</span> <span class="kn">import</span> <span class="n">gaussian</span><span class="p">,</span><span class="n">exponential</span><span class="p">,</span><span class="n">gabor</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">disk</span><span class="p">,</span><span class="n">ring</span><span class="p">,</span>\
    <span class="n">sigmoid</span><span class="p">,</span><span class="n">arc_by_radian</span><span class="p">,</span><span class="n">arc_by_center</span><span class="p">,</span><span class="n">smooth_rectangle</span><span class="p">,</span><span class="n">float_error_ignore</span><span class="p">,</span> \
    <span class="n">log_gaussian</span>

<span class="kn">import</span> <span class="nn">numbergen</span>
<span class="kn">from</span> <span class="nn">imagen.transferfn</span> <span class="kn">import</span> <span class="n">DivisiveNormalizeL1</span>


<span class="c"># Could add a Gradient class, where the brightness varies as a</span>
<span class="c"># function of an equation for a plane.  This could be useful as a</span>
<span class="c"># background, or to see how sharp a gradient is needed to get a</span>
<span class="c"># response.</span>


<div class="viewcode-block" id="HalfPlane"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.HalfPlane">[docs]</a><span class="k">class</span> <span class="nc">HalfPlane</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant pattern on in half of the plane, and off in the rest,</span>
<span class="sd">    with optional Gaussian smoothing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                             <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">falloff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">*</span><span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">float_error_ignore</span><span class="p">():</span>
                <span class="n">falloff</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span>
                                                <span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">falloff</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Gaussian"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Gaussian">[docs]</a><span class="k">class</span> <span class="nc">Gaussian</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D Gaussian pattern generator.</span>

<span class="sd">    The sigmas of the Gaussian are calculated from the size and</span>
<span class="sd">    aspect_ratio parameters:</span>

<span class="sd">      ysigma=size/2</span>
<span class="sd">      xsigma=ysigma*aspect_ratio</span>

<span class="sd">    The Gaussian is then computed for the given (x,y) values as::</span>

<span class="sd">      exp(-x^2/(2*xsigma^2) - y^2/(2*ysigma^2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">0.31</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Ratio of the width to the height.</span>
<span class="s">        Specifically, xsigma=ysigma*aspect_ratio (see size).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.155</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Overall size of the Gaussian, defined by:</span>
<span class="s">        exp(-x^2/(2*xsigma^2) - y^2/(2*ysigma^2)</span>
<span class="s">        where ysigma=size/2 and xsigma=size/2*aspect_ratio.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">ysigma</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">xsigma</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">ysigma</span>

        <span class="k">return</span> <span class="n">gaussian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">xsigma</span><span class="p">,</span><span class="n">ysigma</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ExponentialDecay"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.ExponentialDecay">[docs]</a><span class="k">class</span> <span class="nc">ExponentialDecay</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D Exponential pattern generator.</span>

<span class="sd">    Exponential decay based on distance from a central peak,</span>
<span class="sd">    i.e. exp(-d), where d is the distance from the center (assuming</span>
<span class="sd">    size=1.0 and aspect_ratio==1.0).  More generally, the size and</span>
<span class="sd">    aspect ratio determine the scaling of x and y dimensions:</span>

<span class="sd">      yscale=size/2</span>
<span class="sd">      xscale=yscale*aspect_ratio</span>

<span class="sd">    The exponential is then computed for the given (x,y) values as::</span>

<span class="sd">      exp(-sqrt((x/xscale)^2 - (y/yscale)^2))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">0.31</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of the width to the height.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.155</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Overall scaling of the x and y dimensions.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">yscale</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">xscale</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">yscale</span>

        <span class="k">return</span> <span class="n">exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">xscale</span><span class="p">,</span><span class="n">yscale</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SineGrating"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SineGrating">[docs]</a><span class="k">class</span> <span class="nc">SineGrating</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2D sine grating pattern generator.&quot;&quot;&quot;</span>

    <span class="n">frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
                       <span class="n">precedence</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Frequency of the sine grating.&quot;</span><span class="p">)</span>

    <span class="n">phase</span>     <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
                       <span class="n">precedence</span><span class="o">=</span><span class="mf">0.51</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Phase of the sine grating.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SineGrating.function"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SineGrating.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a sine grating pattern (two-dimensional sine wave).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="Gabor"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Gabor">[docs]</a><span class="k">class</span> <span class="nc">Gabor</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2D Gabor pattern generator.&quot;&quot;&quot;</span>

    <span class="n">frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Frequency of the sine grating component.&quot;</span><span class="p">)</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.51</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Phase of the sine grating component.&quot;</span><span class="p">)</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ratio of pattern width to height.</span>
<span class="sd">        The width of the Gaussian component is size*aspect_ratio (see Gaussian).</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Determines the height of the Gaussian component (see Gaussian).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">height</span>

        <span class="k">return</span> <span class="n">gabor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span>
                     <span class="n">p</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Line"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Line">[docs]</a><span class="k">class</span> <span class="nc">Line</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2D line pattern generator.&quot;&quot;&quot;</span>

    <span class="n">thickness</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.006</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
                         <span class="n">precedence</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span>
                         <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (width) of the solid central part of the line.&quot;</span><span class="p">)</span>
    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                       <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span>
                       <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Disk"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Disk">[docs]</a><span class="k">class</span> <span class="nc">Disk</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D disk pattern generator.</span>

<span class="sd">    An elliptical disk can be obtained by adjusting the aspect_ratio of a circular</span>
<span class="sd">    disk; this transforms a circle into an ellipse by stretching the circle in the</span>
<span class="sd">    y (vertical) direction.</span>

<span class="sd">    The Gaussian fall-off at a point P is an approximation for non-circular disks,</span>
<span class="sd">    since the point on the ellipse closest to P is taken to be the same point as</span>
<span class="sd">    the point on the circle before stretching that was closest to P.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span>  <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Ratio of width to height; size*aspect_ratio gives the width of the disk.&quot;</span><span class="p">)</span>

    <span class="n">size</span>  <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Top to bottom height of the disk&quot;</span><span class="p">)</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                       <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">*</span><span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Ring"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Ring">[docs]</a><span class="k">class</span> <span class="nc">Ring</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D ring pattern generator.</span>

<span class="sd">    See the Disk class for a note about the Gaussian fall-off.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">thickness</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (line width) of the ring.&quot;</span><span class="p">)</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off inside and outside the ring.&quot;</span><span class="p">)</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Ratio of width to height; size*aspect_ratio gives the overall width.&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">*</span><span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">ring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OrientationContrast"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.OrientationContrast">[docs]</a><span class="k">class</span> <span class="nc">OrientationContrast</span><span class="p">(</span><span class="n">SineGrating</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular pattern for testing responses to differences in contrast.</span>

<span class="sd">    The pattern contains a sine grating ring surrounding a sine grating disk, each</span>
<span class="sd">    with parameters (orientation, size, scale and offset) that can be</span>
<span class="sd">    changed independently.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orientationcenter</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Orientation of the center grating.&quot;</span><span class="p">)</span>
    <span class="n">orientationsurround</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Orientation of the surround grating, either absolute or relative to the central grating.&quot;</span><span class="p">)</span>
    <span class="n">surround_orientation_relative</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Determines whether the surround grating is relative to the central grating.&quot;</span><span class="p">)</span>
    <span class="n">sizecenter</span>     <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Size of the center grating.&quot;</span><span class="p">)</span>
    <span class="n">sizesurround</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Size of the surround grating.&quot;</span><span class="p">)</span>
    <span class="n">scalecenter</span>    <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Scale of the center grating.&quot;</span><span class="p">)</span>
    <span class="n">scalesurround</span>  <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Scale of the surround grating.&quot;</span><span class="p">)</span>
    <span class="n">offsetcenter</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Offset of the center grating.&quot;</span><span class="p">)</span>
    <span class="n">offsetsurround</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Offset of the surround grating.&quot;</span><span class="p">)</span>
    <span class="n">smoothing</span>      <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>  <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off inside and outside the ring.&quot;</span><span class="p">)</span>
    <span class="n">thickness</span>      <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (line width) of the ring.&quot;</span><span class="p">)</span>
    <span class="n">aspect_ratio</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>  <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Ratio of width to height; size*aspect_ratio gives the overall width.&quot;</span><span class="p">)</span>
    <span class="n">size</span>           <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params_to_override</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params_to_override</span><span class="p">)</span>
        <span class="n">input_1</span><span class="o">=</span><span class="n">SineGrating</span><span class="p">(</span><span class="n">mask_shape</span><span class="o">=</span><span class="n">Disk</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">phase</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                            <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientationcenter</span><span class="p">,</span>
                            <span class="n">scale</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scalecenter</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">offsetcenter</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sizecenter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">surround_orientation_relative</span><span class="p">:</span>
            <span class="n">surround_or</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">orientationcenter</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">orientationsurround</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">surround_or</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">orientationsurround</span>
        <span class="n">input_2</span><span class="o">=</span><span class="n">SineGrating</span><span class="p">(</span><span class="n">mask_shape</span><span class="o">=</span><span class="n">Ring</span><span class="p">(</span><span class="n">thickness</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">phase</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">phase</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                            <span class="n">orientation</span><span class="o">=</span><span class="n">surround_or</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scalesurround</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">offsetsurround</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sizesurround</span><span class="p">)</span>

        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_1</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">),</span>
                    <span class="n">input_2</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">)]</span>

        <span class="n">image_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">patterns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_array</span>


</div>
<div class="viewcode-block" id="RawRectangle"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.RawRectangle">[docs]</a><span class="k">class</span> <span class="nc">RawRectangle</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D rectangle pattern generator with no smoothing, for use when drawing</span>
<span class="sd">    patterns pixel by pixel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span>   <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Ratio of width to height; size*aspect_ratio gives the width of the rectangle.&quot;</span><span class="p">)</span>

    <span class="n">size</span>  <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Height of the rectangle.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">height</span>
        <span class="k">return</span> <span class="n">bitwise_and</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span>
                           <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">height</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Rectangle"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Rectangle">[docs]</a><span class="k">class</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2D rectangle pattern, with Gaussian smoothing around the edges.&quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Ratio of width to height; size*aspect_ratio gives the width of the rectangle.&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Height of the rectangle.&quot;</span><span class="p">)</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off outside the rectangle.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">size</span>
        <span class="n">width</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">height</span>

        <span class="k">return</span> <span class="n">smooth_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span>
                                <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Arc"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Arc">[docs]</a><span class="k">class</span> <span class="nc">Arc</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D arc pattern generator.</span>

<span class="sd">    Draws an arc (partial ring) of the specified size (radius*2),</span>
<span class="sd">    starting at radian 0.0 and ending at arc_length.  The orientation</span>
<span class="sd">    can be changed to choose other start locations.  The pattern is</span>
<span class="sd">    centered at the center of the ring.</span>

<span class="sd">    See the Disk class for a note about the Gaussian fall-off.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.31</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Ratio of width to height; size*aspect_ratio gives the overall width.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">thickness</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (line width) of the ring.&quot;</span><span class="p">)</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Width of the Gaussian fall-off inside and outside the ring.&quot;</span><span class="p">)</span>

    <span class="n">arc_length</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
                              <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.62</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Length of the arc, in radians, starting from orientation 0.0.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">*</span><span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">arc_by_radian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                             <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">arc_length</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Curve"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Curve">[docs]</a><span class="k">class</span> <span class="nc">Curve</span><span class="p">(</span><span class="n">Arc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D curve pattern generator.</span>

<span class="sd">    Based on Arc, but centered on a tangent point midway through the</span>
<span class="sd">    arc, rather than at the center of a ring, and with curvature</span>
<span class="sd">    controlled directly rather than through the overall size of the</span>
<span class="sd">    pattern.</span>

<span class="sd">    Depending on the size_type, the size parameter can control either</span>
<span class="sd">    the width of the pattern, keeping this constant regardless of</span>
<span class="sd">    curvature, or the length of the curve, keeping that constant</span>
<span class="sd">    instead (as for a long thin object being bent).</span>

<span class="sd">    Specifically, for size_type==&#39;constant_length&#39;, the curvature</span>
<span class="sd">    parameter determines the ratio of height to width of the arc, with</span>
<span class="sd">    positive curvature for concave shape and negative for convex. The</span>
<span class="sd">    size parameter determines the width of the curve.</span>

<span class="sd">    For size_type==&#39;constant_width&#39;, the curvature parameter</span>
<span class="sd">    determines the portion of curve radian to 2pi, and the curve</span>
<span class="sd">    radius is changed accordingly following the formula::</span>

<span class="sd">      size=2pi*radius*curvature</span>

<span class="sd">    Thus, the size parameter determines the total length of the</span>
<span class="sd">    curve. Positive curvature stands for concave shape, and negative</span>
<span class="sd">    for convex.</span>

<span class="sd">    See the Disk class for a note about the Gaussian fall-off.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Hide unused parameters</span>
    <span class="n">arc_length</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">precedence</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">size_type</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;constant_length&#39;</span><span class="p">,</span>
        <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;constant_length&#39;</span><span class="p">,</span><span class="s">&#39;constant_width&#39;</span><span class="p">],</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.61</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        For a given size, whether to draw a curve with that total length,</span>
<span class="s">        or with that width, keeping it constant as curvature is varied.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">curvature</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="mf">0.62</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Ratio of height to width of the arc, with positive value giving</span>
<span class="s">        a concave shape and negative value giving convex.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arc_by_center</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">curvature</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">size_type</span><span class="o">==</span><span class="s">&#39;constant_length&#39;</span><span class="p">),</span>
                             <span class="n">p</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">smoothing</span><span class="p">)</span>



<span class="c">#JABALERT: Can&#39;t this be replaced with a Composite?</span></div>
<div class="viewcode-block" id="TwoRectangles"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.TwoRectangles">[docs]</a><span class="k">class</span> <span class="nc">TwoRectangles</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Two 2D rectangle pattern generator.&quot;&quot;&quot;</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;X center of rectangle 1.&quot;</span><span class="p">)</span>

    <span class="n">y1</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Y center of rectangle 1.&quot;</span><span class="p">)</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;X center of rectangle 2.&quot;</span><span class="p">)</span>

    <span class="n">y2</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Y center of rectangle 2.&quot;</span><span class="p">)</span>

    <span class="c"># YC: Maybe this can be implemented much more cleanly by calling</span>
    <span class="c"># the parent&#39;s function() twice, but it&#39;s hard to see how to</span>
    <span class="c"># set the (x,y) offset for the parent.</span>
    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="o">*</span><span class="n">height</span>

        <span class="k">return</span> <span class="n">bitwise_or</span><span class="p">(</span>
               <span class="n">bitwise_and</span><span class="p">(</span><span class="n">bitwise_and</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">x1</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">x1</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">4.0</span><span class="p">),</span>
                      <span class="n">bitwise_and</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">y1</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mf">4.0</span><span class="p">)),</span>
               <span class="n">bitwise_and</span><span class="p">(</span><span class="n">bitwise_and</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">x2</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x2</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">x2</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">4.0</span><span class="p">),</span>
                      <span class="n">bitwise_and</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">p</span><span class="o">.</span><span class="n">y2</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">p</span><span class="o">.</span><span class="n">y2</span><span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mf">4.0</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="SquareGrating"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SquareGrating">[docs]</a><span class="k">class</span> <span class="nc">SquareGrating</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2D squarewave grating pattern generator.&quot;&quot;&quot;</span>

    <span class="n">frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Frequency of the square grating.&quot;</span><span class="p">)</span>

    <span class="n">phase</span>     <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
        <span class="n">precedence</span><span class="o">=</span><span class="mf">0.51</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Phase of the square grating.&quot;</span><span class="p">)</span>

    <span class="c"># We will probably want to add anti-aliasing to this,</span>
    <span class="c"># and there might be an easier way to do it than by</span>
    <span class="c"># cropping a sine grating.</span>

<div class="viewcode-block" id="SquareGrating.function"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SquareGrating.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a square-wave grating (alternating black and white bars).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">around</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">phase</span><span class="p">))</span>


<span class="c"># CB: I removed motion_sign from this class because I think it is</span>
<span class="c"># unnecessary. But maybe I misunderstood the original author&#39;s</span>
<span class="c"># intention?</span>
<span class="c">#</span>
<span class="c"># In any case, the original implementation was incorrect - it was not</span>
<span class="c"># possible to get some motion directions (directions in one whole</span>
<span class="c"># quadrant were missed out).</span>
<span class="c">#</span>
<span class="c"># Note that to get a 2pi range of directions, one must use a 2pi range</span>
<span class="c"># of orientations (there are two directions for any given</span>
<span class="c"># orientation).  Alternatively, we could generate a random sign, and</span>
<span class="c"># use an orientation restricted to a pi range.</span>
</div></div>
<div class="viewcode-block" id="Sweeper"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Sweeper">[docs]</a><span class="k">class</span> <span class="nc">Sweeper</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PatternGenerator that sweeps a supplied PatternGenerator in a direction</span>
<span class="sd">    perpendicular to its orientation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generator</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Gaussian</span><span class="p">(),</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Pattern to sweep.&quot;</span><span class="p">)</span>

    <span class="n">speed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Sweep speed: number of sheet coordinate units per unit time.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of steps at the given speed to move in the sweep direction.</span>
<span class="s">        The distance moved is speed*step.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># Provide access to value needed for measuring maps</span>
    <span class="k">def</span> <span class="nf">__get_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">phase</span>
    <span class="k">def</span> <span class="nf">__set_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">new_val</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">new_val</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__get_phase</span><span class="p">,</span><span class="n">__set_phase</span><span class="p">)</span>

<div class="viewcode-block" id="Sweeper.function"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Sweeper.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Selects and returns one of the patterns in the list.&quot;&quot;&quot;</span>
        <span class="n">pg</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">generator</span>
        <span class="n">motion_orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="n">new_x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">pg</span><span class="o">.</span><span class="n">x</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">pg</span><span class="o">.</span><span class="n">y</span>

        <span class="n">image_array</span> <span class="o">=</span> <span class="n">pg</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                         <span class="n">x</span><span class="o">=</span><span class="n">new_x</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">step</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">motion_orientation</span><span class="p">),</span>
                         <span class="n">y</span><span class="o">=</span><span class="n">new_y</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">step</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">motion_orientation</span><span class="p">),</span>
                         <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span>
                         <span class="n">scale</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_array</span>

</div></div>
<div class="viewcode-block" id="Composite"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Composite">[docs]</a><span class="k">class</span> <span class="nc">Composite</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PatternGenerator that accepts a list of other PatternGenerators.</span>
<span class="sd">    To create a new pattern, asks each of the PatternGenerators in the</span>
<span class="sd">    list to create a pattern, then it combines the patterns to create a</span>
<span class="sd">    single pattern that it returns.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># The Accum_Replace operator from LISSOM is not yet supported,</span>
    <span class="c"># but it should be added once PatternGenerator bounding boxes</span>
    <span class="c"># are respected and/or GenericImage patterns support transparency.</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Binary Numpy function used to combine the individual patterns.</span>

<span class="s">        Any binary Numpy array &quot;ufunc&quot; returning the same</span>
<span class="s">        type of array as the operands and supporting the reduce</span>
<span class="s">        operator is allowed here.  Supported ufuncs include::</span>

<span class="s">          add</span>
<span class="s">          subtract</span>
<span class="s">          multiply</span>
<span class="s">          divide</span>
<span class="s">          maximum</span>
<span class="s">          minimum</span>
<span class="s">          remainder</span>
<span class="s">          power</span>
<span class="s">          logical_and</span>
<span class="s">          logical_or</span>
<span class="s">          logical_xor</span>

<span class="s">        The most useful ones are probably add and maximum, but there</span>
<span class="s">        are uses for at least some of the others as well (e.g. to</span>
<span class="s">        remove pieces of other patterns).</span>

<span class="s">        You can also write your own operators, by making a class that</span>
<span class="s">        has a static method named &quot;reduce&quot; that returns an array of the</span>
<span class="s">        same size and type as the arrays in the list.  For example::</span>

<span class="s">          class return_first(object):</span>
<span class="s">              @staticmethod</span>
<span class="s">              def reduce(x):</span>
<span class="s">                  return x[0]</span>

<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">generators</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">Constant</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)],</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span>
        <span class="n">class_</span><span class="o">=</span><span class="n">PatternGenerator</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        List of patterns to use in the composite pattern.  The default is</span>
<span class="s">        a blank pattern, and should thus be overridden for any useful work.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">size</span>  <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Scaling factor applied to all sub-patterns.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_advance_pattern_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses can override this method to provide constraints on</span>
<span class="sd">        the values of generators&#39; parameters and/or eliminate</span>
<span class="sd">        generators from this list if necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">generators</span>

<div class="viewcode-block" id="Composite.state_push"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Composite.state_push">[docs]</a>    <span class="k">def</span> <span class="nf">state_push</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Push the state of all generators</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Composite</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">state_push</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
            <span class="n">gen</span><span class="o">.</span><span class="n">state_push</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Composite.state_pop"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Composite.state_pop">[docs]</a>    <span class="k">def</span> <span class="nf">state_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop the state of all generators</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Composite</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">state_pop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
            <span class="n">gen</span><span class="o">.</span><span class="n">state_pop</span><span class="p">()</span>

    <span class="c"># JABALERT: To support large numbers of patterns on a large input region,</span>
    <span class="c"># should be changed to evaluate each pattern in a small box, and then</span>
    <span class="c"># combine them at the full Composite Bounding box size.</span></div>
<div class="viewcode-block" id="Composite.function"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Composite.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs combined pattern out of the individual ones.&quot;&quot;&quot;</span>
        <span class="n">generators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advance_pattern_generators</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span><span class="s">&#39;reduce&#39;</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; does not support &#39;reduce&#39;.&quot;</span>

        <span class="c"># CEBALERT: mask gets applied by all PGs including the Composite itself</span>
        <span class="c"># (leads to redundant calculations in current lissom_oo_or usage, but</span>
        <span class="c"># will lead to problems/limitations in the future).</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">pg</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span>
                       <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                       <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">-</span> <span class="n">pg</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)),</span>
                       <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span> <span class="n">pg</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)),</span>
                       <span class="n">orientation</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span>
                       <span class="n">size</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">pg</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">]</span>
        <span class="n">image_array</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">patterns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_array</span>


</div></div>
<div class="viewcode-block" id="SeparatedComposite"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SeparatedComposite">[docs]</a><span class="k">class</span> <span class="nc">SeparatedComposite</span><span class="p">(</span><span class="n">Composite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized version of the Composite PatternGenerator that enforces spacing constraints</span>
<span class="sd">    between pattern centers.</span>

<span class="sd">    Currently supports minimum spacing, but can be generalized to</span>
<span class="sd">    support maximum spacing also (and both at once).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">min_separation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
                            <span class="n">softbounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Minimum distance to enforce between all pairs of pattern centers.</span>

<span class="s">        Useful for ensuring that multiple randomly generated patterns</span>
<span class="s">        do not overlap spatially.  Note that as this this value is</span>
<span class="s">        increased relative to the area in which locations are chosen,</span>
<span class="s">        the likelihood of a pattern appearing near the center of the</span>
<span class="s">        area will decrease.  As this value approaches the available</span>
<span class="s">        area, the corners become far more likely to be chosen, due to</span>
<span class="s">        the distances being greater along the diagonals.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c">### JABNOTE: Should provide a mechanism for collecting and</span>
        <span class="c">### plotting the training pattern center distribution, so that</span>
        <span class="c">### such issues can be checked.</span>

    <span class="n">max_trials</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
                         <span class="n">softbounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of times to try for a new pattern location that meets the criteria.</span>

<span class="s">        This is an essentially arbitrary timeout value that helps</span>
<span class="s">        prevent an endless loop in case the requirements cannot be</span>
<span class="s">        met.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__distance_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g0</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns true if the distance between the (x,y) locations of two generators</span>
<span class="sd">        g0 and g1 is greater than a minimum separation.</span>

<span class="sd">        Can be extended easily to support other criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">g1</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">g0</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">g0</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dist</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">min_separation</span>


    <span class="k">def</span> <span class="nf">_advance_pattern_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Advance the parameters for each generator for this presentation.</span>

<span class="sd">        Picks a position for each generator that is accepted by __distance_valid</span>
<span class="sd">        for all combinations.  Returns a new list of the generators, with</span>
<span class="sd">        some potentially omitted due to failure to meet the constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid_generators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_trials</span><span class="p">):</span>
                <span class="c"># Generate a new position and add generator if it&#39;s ok</span>

                <span class="k">if</span> <span class="n">alltrue</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__distance_valid</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid_generators</span><span class="p">]):</span>
                    <span class="n">valid_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">g</span><span class="o">.</span><span class="n">force_new_dynamic_value</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">force_new_dynamic_value</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Unable to place pattern </span><span class="si">%s</span><span class="s"> subject to given constraints&quot;</span> <span class="o">%</span>
                             <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_generators</span>


</div>
<span class="k">class</span> <span class="nc">Animation</span><span class="p">(</span><span class="n">SheetStack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Animation is a collection of SheetLayers associated with</span>
<span class="sd">    corresponding time values using a fixed timebase. Each individual</span>
<span class="sd">    Sheetlayers is given a time value that is a multiple of the</span>
<span class="sd">    timestep parameter and therefore Animations assume regular</span>
<span class="sd">    sampling of data over time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Dynamic</span><span class="o">.</span><span class="n">time_fn</span><span class="p">,</span>
                               <span class="n">class_</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The time object shared across the time-varying objects</span>
<span class="s">        that are to be sampled.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      The time offset from which frames are generated given the</span>
<span class="s">      supplied pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The number of frames generated relative to offset using the</span>
<span class="s">       supplied pattern if available. Frames are only generated if not</span>
<span class="s">       None.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Constant</span><span class="p">(),</span> <span class="n">class_</span><span class="o">=</span><span class="n">PatternGenerator</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      The pattern used to generate frames if the frames parameter is</span>
<span class="s">      not None. Defaults to blank white frames.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">timestep</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The time interval between successive layers. Valid time values</span>
<span class="s">       must be an integer multiple of this timestep value (which may</span>
<span class="s">       be a float or some other numeric type).&quot;&quot;&quot;</span> <span class="p">)</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;frames&#39;</span><span class="p">],</span> <span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       Animations are indexed by time. This may be by integer frame</span>
<span class="s">       number or some continuous (e.g. floating point or rational)</span>
<span class="s">       representation of time.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_items</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Animation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">initial_items</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">initial_items</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">state_push</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">[:]</span>
                    <span class="n">t</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">state_pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Animation</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">map_fn</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_item_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_vals</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dim_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">))</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Frame time value not a multiple of timestep.&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Animation</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_item_check</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>



<span class="c">#JABALERT: replace with x%1.0 below</span>
<span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circularly alias the numeric value x into the range [lower,upper).</span>

<span class="sd">    Valid for cyclic quantities like orientations or hues.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#I have no idea how I came up with this algorithm; it should be simplified.</span>
    <span class="c">#</span>
    <span class="c"># Note that Python&#39;s % operator works on floats and arrays;</span>
    <span class="c"># usually one can simply use that instead.  E.g. to wrap array or</span>
    <span class="c"># scalar x into 0,2*pi, just use &quot;x % (2*pi)&quot;.</span>
    <span class="n">range_</span><span class="o">=</span><span class="n">upper</span><span class="o">-</span><span class="n">lower</span>
    <span class="k">return</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">fmod</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">lower</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">range_</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">range_</span><span class="p">))),</span> <span class="n">range_</span><span class="p">)</span>



<div class="viewcode-block" id="Selector"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Selector">[docs]</a><span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PatternGenerator that selects from a list of other PatternGenerators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generators</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span><span class="n">class_</span><span class="o">=</span><span class="n">PatternGenerator</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">Disk</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)],</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;List of patterns from which to select.&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Scaling factor applied to all sub-patterns.&quot;</span><span class="p">)</span>

    <span class="c"># CB: needs to have time_fn=None</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">numbergen</span><span class="o">.</span><span class="n">UniformRandom</span><span class="p">(</span><span class="n">lbound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ubound</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">76</span><span class="p">),</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">precedence</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Index into the list of pattern generators, on a scale from 0</span>
<span class="s">        (start of the list) to 1.0 (end of the list).  Typically a</span>
<span class="s">        random value or other number generator, to allow a different item</span>
<span class="s">        to be selected each time.&quot;&quot;&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Selector.function"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Selector.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Selects and returns one of the patterns in the list.&quot;&quot;&quot;</span>
        <span class="n">int_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">generators</span><span class="p">)</span><span class="o">*</span><span class="n">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">pg</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">generators</span><span class="p">[</span><span class="n">int_index</span><span class="p">]</span>

        <span class="n">image_array</span> <span class="o">=</span> <span class="n">pg</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                         <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">-</span><span class="n">pg</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)),</span>
                         <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="n">pg</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)),</span>
                         <span class="n">orientation</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                         <span class="n">scale</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">offset</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_array</span>
</div>
<div class="viewcode-block" id="Selector.get_current_generator"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Selector.get_current_generator">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the current generator (as specified by self.index).&quot;&quot;&quot;</span>
        <span class="n">int_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">)</span><span class="o">*</span><span class="n">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generators</span><span class="p">[</span><span class="n">int_index</span><span class="p">]</span>




<span class="c">### JABALERT: This class should be eliminated if at all possible; it</span>
<span class="c">### is just a specialized version of Composite, and should be</span>
<span class="c">### implementable directly using what is already in Composite.</span></div></div>
<div class="viewcode-block" id="GaussiansCorner"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.GaussiansCorner">[docs]</a><span class="k">class</span> <span class="nc">GaussiansCorner</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Two Gaussian pattern generators with a variable intersection point,</span>
<span class="sd">    appearing as a corner or cross.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;X center of the corner&quot;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Y center of the corner&quot;</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;The size of the corner&quot;</span><span class="p">)</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">0.31</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Ratio of the width to the height for both Gaussians&quot;</span><span class="p">)</span>

    <span class="n">angle</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.99</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;The angle of the corner&quot;</span><span class="p">)</span>

    <span class="n">cross</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Where the two Gaussians cross, as a fraction of their half length&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params_to_override</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params_to_override</span><span class="p">)</span>

        <span class="n">g_1</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">()</span>
        <span class="n">g_2</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">()</span>

        <span class="n">x_1</span> <span class="o">=</span> <span class="n">g_1</span><span class="p">(</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span>
                            <span class="n">ydensity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">cross</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">cross</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">)</span>
        <span class="n">x_2</span> <span class="o">=</span> <span class="n">g_2</span><span class="p">(</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span>
                            <span class="n">ydensity</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">cross</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">,</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">cross</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span> <span class="p">)</span>


</div>
<div class="viewcode-block" id="Translator"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Translator">[docs]</a><span class="k">class</span> <span class="nc">Translator</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PatternGenerator that translates another PatternGenerator over</span>
<span class="sd">    time.</span>

<span class="sd">    This PatternGenerator will create a series of episodes, where in</span>
<span class="sd">    each episode the underlying generator is moved in a fixed</span>
<span class="sd">    direction at a fixed speed.  To begin an episode, the Translator&#39;s</span>
<span class="sd">    x, y, and direction are evaluated (e.g. from random</span>
<span class="sd">    distributions), and the underlying generator is then drawn at</span>
<span class="sd">    those values plus changes over time that are determined by the</span>
<span class="sd">    speed.  The orientation of the underlying generator should be set</span>
<span class="sd">    to 0 to get motion perpendicular to the generator&#39;s orientation</span>
<span class="sd">    (which is typical).</span>

<span class="sd">    Note that at present the parameter values for x, y, and direction</span>
<span class="sd">    cannot be passed in when the instance is called; only the values</span>
<span class="sd">    set on the instance are used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Gaussian</span><span class="p">(),</span>
        <span class="n">class_</span><span class="o">=</span><span class="n">PatternGenerator</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Pattern to be translated.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">direction</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The direction in which the pattern should move, in radians.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">speed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The speed with which the pattern should move,</span>
<span class="s">        in sheet coordinates per time_fn unit.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">reset_period</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Period between generating each new translation episode.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">episode_interval</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Interval between successive translation episodes.</span>

<span class="s">        If nonzero, the episode_separator pattern is presented for</span>
<span class="s">        this amount of time_fn time after each episode, e.g. to</span>
<span class="s">        allow processing of the previous episode to complete.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">episode_separator</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Constant</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
         <span class="n">class_</span><span class="o">=</span><span class="n">PatternGenerator</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         Pattern to display during the episode_interval, if any.</span>
<span class="s">         The default is a blank pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">time_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Dynamic</span><span class="o">.</span><span class="n">time_fn</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Function to generate the time used as a base for translation.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_advance_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Explicitly generate new values for these parameters only</span>
<span class="sd">        when appropriate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;direction&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force_new_dynamic_value</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Translator</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_advance_params</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params_to_override</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params_to_override</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">reset_period</span><span class="p">:</span>
            <span class="c">## Returns early if within episode interval</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="p">()</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">last_time</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">reset_period</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">episode_interval</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">episode_separator</span><span class="p">(</span><span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span>
                                           <span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span>
                                           <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_advance_params</span><span class="p">()</span>

        <span class="c"># JABALERT: Does not allow x, y, or direction to be passed in</span>
        <span class="c"># to the call; fixing this would require implementing</span>
        <span class="c"># inspect_value and force_new_dynamic_value (for</span>
        <span class="c"># use in _advance_params) for ParamOverrides.</span>
        <span class="c">#</span>
        <span class="c"># Access parameter values without giving them new values</span>
        <span class="k">assert</span> <span class="p">(</span><span class="s">&#39;x&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params_to_override</span> <span class="ow">and</span>
                <span class="s">&#39;y&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params_to_override</span> <span class="ow">and</span>
                <span class="s">&#39;direction&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params_to_override</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspect_value</span><span class="p">(</span><span class="s">&#39;direction&#39;</span><span class="p">)</span>

        <span class="c"># compute how much time elapsed from the last reset</span>
        <span class="c"># float(t) required because time could be e.g. gmpy.mpq</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">last_time</span><span class="p">)</span>

        <span class="c">## CEBALERT: mask gets applied twice, both for the underlying</span>
        <span class="c">## generator and for this one.  (leads to redundant</span>
        <span class="c">## calculations in current lissom_oo_or usage, but will lead</span>
        <span class="c">## to problems/limitations in the future).</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">generator</span><span class="p">(</span>
            <span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">speed</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">speed</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="p">(</span><span class="n">direction</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="DifferenceOfGaussians"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.DifferenceOfGaussians">[docs]</a><span class="k">class</span> <span class="nc">DifferenceOfGaussians</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Two-dimensional difference of gaussians pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">positive_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the positive region of the pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the positive region of the pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_x</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;X position for the central peak of the positive region.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_y</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Y position for the central peak of the positive region.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="n">negative_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the negative region of the pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the negative region of the pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_x</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;X position for the central peak of the negative region.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_y</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Y position for the central peak of the negative region.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_y</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_aspect_ratio</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">output_fns</span><span class="o">=</span><span class="p">[</span><span class="n">DivisiveNormalizeL1</span><span class="p">()])</span>

        <span class="n">negative</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_y</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_aspect_ratio</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">output_fns</span><span class="o">=</span><span class="p">[</span><span class="n">DivisiveNormalizeL1</span><span class="p">()])</span>

        <span class="k">return</span> <span class="n">Composite</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="p">[</span><span class="n">positive</span><span class="p">,</span><span class="n">negative</span><span class="p">],</span> <span class="n">operator</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span>
            <span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">)()</span>


</div>
<div class="viewcode-block" id="Sigmoid"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Sigmoid">[docs]</a><span class="k">class</span> <span class="nc">Sigmoid</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Two-dimensional sigmoid pattern, dividing the plane into positive</span>
<span class="sd">    and negative halves with a smoothly sloping transition between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">slope</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Parameter controlling the smoothness of the transition</span>
<span class="s">        between the two regions; high values give a sharp transition.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="SigmoidedDoG"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SigmoidedDoG">[docs]</a><span class="k">class</span> <span class="nc">SigmoidedDoG</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sigmoid multiplicatively combined with a difference of Gaussians,</span>
<span class="sd">    such that one part of the plane can be the mirror image of the other.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">positive_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the positive Gaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the positive Gaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the negative Gaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the negative Gaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sigmoid_slope</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Parameter controlling the smoothness of the transition between the two regions;</span>
<span class="s">            high values give a sharp transition.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sigmoid_position</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;X position of the transition between the two regions.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">diff_of_gaussians</span> <span class="o">=</span> <span class="n">DifferenceOfGaussians</span><span class="p">(</span><span class="n">positive_x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">positive_y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">negative_x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">negative_y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">positive_size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">positive_aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_aspect_ratio</span><span class="p">,</span>
            <span class="n">negative_size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">negative_aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_aspect_ratio</span><span class="p">)</span>

        <span class="n">sigmoid</span> <span class="o">=</span> <span class="n">Sigmoid</span><span class="p">(</span><span class="n">slope</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sigmoid_slope</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">sigmoid_position</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Composite</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="p">[</span><span class="n">diff_of_gaussians</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">operator</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">,</span> <span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">)()</span>


</div>
<div class="viewcode-block" id="LogGaussian"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.LogGaussian">[docs]</a><span class="k">class</span> <span class="nc">LogGaussian</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2D Log Gaussian pattern generator allowing standard gaussian</span>
<span class="sd">    patterns but with the added advantage of movable peaks.</span>

<span class="sd">    The spread governs decay rates from the peak of the Gaussian,</span>
<span class="sd">    mathematically this is the sigma term.</span>

<span class="sd">    The center governs the peak position of the Gaussian,</span>
<span class="sd">    mathematically this is the mean term.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of the pattern&#39;s width to height.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">x_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the x axis.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">y_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the y axis.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params_to_override</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the subclass&#39;s &#39;function&#39; method on a rotated and scaled coordinate system.</span>

<span class="sd">        Creates and fills an array with the requested pattern.  If</span>
<span class="sd">        called without any params, uses the values for the Parameters</span>
<span class="sd">        as currently set on the object. Otherwise, any params</span>
<span class="sd">        specified override those currently set on the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_to_override</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_xy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">fn_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_mask</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fn_result</span><span class="p">)</span>

        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">fn_result</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">scale_factor</span><span class="o">*</span><span class="n">fn_result</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">offset</span>

        <span class="k">for</span> <span class="n">of</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">output_fns</span><span class="p">:</span>
            <span class="n">of</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">_setup_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce pattern coordinate matrices from the bounds and</span>
<span class="sd">        density (or rows and cols), and transforms them according to</span>
<span class="sd">        x, y, and orientation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="s">&quot;bounds=</span><span class="si">%s</span><span class="s">, xdensity=</span><span class="si">%s</span><span class="s">, ydensity=</span><span class="si">%s</span><span class="s">, x=</span><span class="si">%s</span><span class="s">, y=</span><span class="si">%s</span><span class="s">, orientation=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">))</span>

        <span class="n">x_points</span><span class="p">,</span><span class="n">y_points</span> <span class="o">=</span> <span class="n">SheetCoordinateSystem</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">)</span><span class="o">.</span><span class="n">sheetcoordinates_of_matrixidx</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_and_rotate_coordinate_arrays</span><span class="p">(</span><span class="n">x_points</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y_points</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_create_and_rotate_coordinate_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create pattern matrices from x and y vectors, and rotate</span>
<span class="sd">        them to the specified orientation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.0</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">10.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="mf">10.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">pattern_x</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="n">pattern_y</span> <span class="o">=</span> <span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>

        <span class="n">clip</span><span class="p">(</span><span class="n">pattern_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">pattern_x</span><span class="p">)</span>
        <span class="n">clip</span><span class="p">(</span><span class="n">pattern_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Infinity</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">pattern_y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pattern_x</span><span class="p">,</span> <span class="n">pattern_y</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">log_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">x_shape</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y_shape</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="SigmoidedDoLG"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.SigmoidedDoLG">[docs]</a><span class="k">class</span> <span class="nc">SigmoidedDoLG</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sigmoid multiplicatively combined with a difference of Log Gaussians, such that one part of the plane can be</span>
<span class="sd">    the mirror image of the other, and the peaks of the gaussians are movable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>


    <span class="n">positive_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the positive LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the positive LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_x_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the x axis for the positive LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_y_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the y axis for the positive LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">positive_scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Multiplicative scale for the positive LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="n">negative_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Size of the negative LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_aspect_ratio</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ratio of width to height for the negative LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_x_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the x axis for the negative LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_y_shape</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of the tail along the y axis for the negative LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">negative_scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Multiplicative scale for the negative LogGaussian pattern.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="n">sigmoid_slope</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Parameter controlling the smoothness of the transition between the two regions;</span>
<span class="s">            high values give a sharp transition.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sigmoid_position</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;X position of the transition between the two regions.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">LogGaussian</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_aspect_ratio</span><span class="p">,</span> <span class="n">x_shape</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_x_shape</span><span class="p">,</span>
            <span class="n">y_shape</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_y_shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">positive_scale</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">output_fns</span><span class="o">=</span><span class="p">[])</span>

        <span class="n">negative</span> <span class="o">=</span> <span class="n">LogGaussian</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_size</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_aspect_ratio</span><span class="p">,</span> <span class="n">x_shape</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_x_shape</span><span class="p">,</span>
            <span class="n">y_shape</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_y_shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">negative_scale</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">output_fns</span><span class="o">=</span><span class="p">[])</span>

        <span class="n">diff_of_log_gaussians</span> <span class="o">=</span> <span class="n">Composite</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="p">[</span><span class="n">positive</span><span class="p">,</span> <span class="n">negative</span><span class="p">],</span> <span class="n">operator</span><span class="o">=</span><span class="n">subtract</span><span class="p">,</span>
            <span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

        <span class="n">sigmoid</span> <span class="o">=</span> <span class="n">Sigmoid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">sigmoid_position</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sigmoid_slope</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation</span><span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Composite</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="p">[</span><span class="n">diff_of_log_gaussians</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">operator</span><span class="o">=</span><span class="n">multiply</span><span class="p">,</span> <span class="n">xdensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ydensity</span><span class="p">,</span> <span class="n">output_fns</span><span class="o">=</span><span class="p">[</span><span class="n">DivisiveNormalizeL1</span><span class="p">()])()</span>


</div>
<span class="k">class</span> <span class="nc">TimeSeries</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic class to return intervals of a discretized time series.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_series</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">repeat</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="mi">50</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;An array of numbers that form a series.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">44100</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The number of samples taken per second to form the series.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">seconds_per_iteration</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Number of seconds advanced along the time series on each iteration.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">interval_length</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The length of time in seconds to be returned on each iteration.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">repeat</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Whether the signal loops or terminates once it reaches its end.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeSeries</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds_per_iteration</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Seconds per iteration &gt; interval length, some signal will be skipped.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">append_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_signal</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="p">,</span> <span class="n">new_signal</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">extract_specific_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overload if special behaviour is required when a series ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">interval_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval_start</span><span class="p">)</span>
        <span class="n">interval_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval_end</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interval_start</span> <span class="o">&gt;=</span> <span class="n">interval_end</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Requested interval&#39;s start point is past the requested end point.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">interval_start</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">:</span>
                <span class="n">interval_end</span> <span class="o">=</span> <span class="n">interval_end</span> <span class="o">-</span> <span class="n">interval_start</span>
                <span class="n">interval_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Requested interval&#39;s start point is past the end of the time series.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interval_end</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="n">interval_start</span><span class="p">:</span><span class="n">interval_end</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">requested_interval_size</span> <span class="o">=</span> <span class="n">interval_end</span> <span class="o">-</span> <span class="n">interval_start</span>
            <span class="n">remaining_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="n">interval_start</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">requested_interval_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span> <span class="o">=</span> <span class="n">requested_interval_size</span><span class="o">-</span><span class="n">remaining_signal</span><span class="o">.</span><span class="n">size</span>
                    <span class="n">interval</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">remaining_signal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span><span class="p">]))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">repeated_signal</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="n">requested_interval_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span> <span class="o">=</span> <span class="n">requested_interval_size</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span>

                    <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="n">remaining_signal</span><span class="p">,</span> <span class="n">repeated_signal</span><span class="p">)))[</span><span class="mi">0</span><span class="p">:</span><span class="n">requested_interval_size</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Returning last interval of the time series.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_series</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="n">samples_per_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_length</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">remaining_signal</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="n">samples_per_interval</span><span class="o">-</span><span class="n">remaining_signal</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">interval</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">interval_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span>
        <span class="n">interval_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">interval_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_length</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_next_interval_start</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds_per_iteration</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_specific_interval</span><span class="p">(</span><span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_end</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">generate_sine_wave</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">):</span>
    <span class="n">time_axis</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">duration</span><span class="o">*</span><span class="n">sample_rate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">time_axis</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">TimeSeriesParam</span><span class="p">(</span><span class="n">ClassSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value is a TimeSeries object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeSeriesParam</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">TimeSeries</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>



<div class="viewcode-block" id="PowerSpectrum"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.PowerSpectrum">[docs]</a><span class="k">class</span> <span class="nc">PowerSpectrum</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Outputs the spectral density of a rolling interval of the input</span>
<span class="sd">    signal each time it is called. Over time, the results could be</span>
<span class="sd">    arranged into a spectrogram, e.g. for an audio signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">precedence</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The amount by which to scale amplitudes by. This is useful if we want to rescale to say a range [0:1].</span>

<span class="s">        Note: Constant scaling is preferable to dynamic scaling so as not to artificially ramp down loud sounds while ramping</span>
<span class="s">        up hiss and other background interference.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">TimeSeriesParam</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">generate_sine_wave</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">20000</span><span class="p">),</span> <span class="n">sample_rate</span><span class="o">=</span><span class="mi">20000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;A TimeSeries object on which to perfom the Fourier Transform.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">min_frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Smallest frequency for which to return an amplitude.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Largest frequency for which to return an amplitude.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">windowing_function</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;This function is multiplied with the current interval, i.e. the most recent portion of the</span>
<span class="s">        waveform interval of a signal, before performing the Fourier transform.  It thus shapes the interval,</span>
<span class="s">        which is otherwise always rectangular.</span>

<span class="s">        The function chosen here dictates the tradeoff between resolving comparable signal strengths with similar</span>
<span class="s">        frequencies, and resolving disparate signal strengths with dissimilar frequencies.</span>

<span class="s">        numpy provides a number of options, e.g. bartlett, blackman, hamming, hanning, kaiser; see</span>
<span class="s">        http://docs.scipy.org/doc/numpy/reference/routines.window.html</span>

<span class="s">        You may also supply your own.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PowerSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span>


    <span class="k">def</span> <span class="nf">_create_frequency_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;PowerSpectrum: min frequency must be lower than max frequency.&quot;</span><span class="p">)</span>

        <span class="c"># calculate the discrete frequencies possible for the given sample rate.</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">sample_rate</span>
        <span class="n">available_frequency_range</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sample_rate</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">sample_rate</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">available_frequency_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">available_frequency_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Specified frequency interval [</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">] is unavailable, available range is [</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">]. Adjust to these frequencies or modify the sample rate of the TimeSeries object.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">,</span> <span class="n">available_frequency_range</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">available_frequency_range</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

        <span class="n">min_freq</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="n">available_frequency_range</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_freq</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="n">available_frequency_range</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_frequency_spacing</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_set_frequency_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency spacing to use, i.e. how to map the available frequency range to the discrete sheet rows.</span>

<span class="sd">        NOTE: We&#39;re calculating the spacing of a range between the highest and lowest frequencies, the actual</span>
<span class="sd">        segmentation and averaging of the frequencies to fit this spacing occurs in _getAmplitudes().</span>

<span class="sd">        This method is here solely to provide a minimal overload if custom spacing is required.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_row_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a real Discrete Fourier Transform (DFT; implemented using a Fast Fourier Transform algorithm, FFT)</span>
<span class="sd">        of the current sample from the signal multiplied by the smoothing window.</span>

<span class="sd">        See numpy.rfft for information about the Fourier transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">signal_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="p">()</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">sample_rate</span>

        <span class="c"># A signal window *must* span one sample rate</span>
        <span class="n">signal_window</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">signal_interval</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">interval_length</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowing_function</span><span class="p">:</span>
            <span class="n">smoothed_window</span> <span class="o">=</span> <span class="n">signal_window</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">sample_rate</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowing_function</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smoothed_window</span> <span class="o">=</span> <span class="n">signal_window</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">sample_rate</span><span class="p">]</span>

        <span class="n">amplitudes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">smoothed_window</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="n">sample_rate</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">start_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">end_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">normalisation_factor</span> <span class="o">=</span>  <span class="n">end_frequency</span> <span class="o">-</span> <span class="n">start_frequency</span>
            <span class="k">if</span> <span class="n">normalisation_factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">amplitudes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">start_frequency</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amplitudes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">[</span><span class="n">start_frequency</span><span class="p">:</span><span class="n">end_frequency</span><span class="p">])</span> <span class="o">/</span> <span class="n">normalisation_factor</span>

        <span class="k">return</span> <span class="n">flipud</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">set_matrix_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PowerSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_matrix_dimensions</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span> <span class="o">=</span> <span class="n">SheetCoordinateSystem</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_frequency_indices</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_shape_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_amplitudes</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">row_amplitudes</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">row_amplitudes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">row_amplitudes</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_frequency</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_frequency</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frequency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_frequency_indices</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_row_amplitudes</span><span class="p">())</span>


</div>
<div class="viewcode-block" id="Spectrogram"><a class="viewcode-back" href="../Reference_Manual/imagen-module.html#imagen.Spectrogram">[docs]</a><span class="k">class</span> <span class="nc">Spectrogram</span><span class="p">(</span><span class="n">PowerSpectrum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extends PowerSpectrum to provide a temporal buffer, yielding</span>
<span class="sd">    a 2D representation of a fixed-width spectrogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">min_latency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Smallest latency (in milliseconds) for which to return amplitudes.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_latency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Largest latency (in milliseconds) for which to return amplitudes.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Spectrogram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span>


    <span class="k">def</span> <span class="nf">_shape_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_column</span><span class="p">):</span>

        <span class="n">millisecs_per_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">seconds_per_iteration</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">millisecs_per_iteration</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span><span class="mi">0</span><span class="p">:]</span> <span class="o">=</span> <span class="n">new_column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Slide old values along, add new data to left hand side.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="n">millisecs_per_iteration</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">millisecs_per_iteration</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">millisecs_per_iteration</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column</span>

        <span class="n">sheet_representation</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">start_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latency_spacing</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="n">end_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latency_spacing</span><span class="p">[</span><span class="n">column</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">normalisation_factor</span> <span class="o">=</span> <span class="n">end_latency</span> <span class="o">-</span> <span class="n">start_latency</span>
            <span class="k">if</span> <span class="n">normalisation_factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sheet_representation</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="n">start_latency</span><span class="p">:</span><span class="n">end_latency</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">normalisation_factor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sheet_representation</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="n">start_latency</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sheet_representation</span>


    <span class="k">def</span> <span class="nf">set_matrix_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Spectrogram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_matrix_dimensions</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">xdensity</span><span class="p">,</span> <span class="n">ydensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_latency_indices</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_create_latency_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Spectrogram: min latency must be lower than max latency.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_latency_spacing</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectrogram</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheet_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_latency</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_latency</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_min_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_max_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_latency_indices</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Spectrogram</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">()</span>
</div>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">_public</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">_k</span> <span class="k">for</span> <span class="n">_k</span><span class="p">,</span><span class="n">_v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_v</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">_v</span><span class="p">,</span><span class="n">PatternGenerator</span><span class="p">)]))</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="n">_public</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">,</span> <span class="s">&quot;random&quot;</span><span class="p">,</span><span class="s">&quot;boundingregion&quot;</span><span class="p">,</span> <span class="s">&quot;sheetcoords&quot;</span><span class="p">]</span>
<span class="n">__path__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">boundingregion</span><span class="o">.</span><span class="n">__file__</span><span class="p">)))</span>
<span class="n">__path__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sheetcoords</span><span class="o">.</span><span class="n">__file__</span><span class="p">)))</span>

<span class="c"># Avoids loading the audio and opencvcamera modules, which rely on external</span>
<span class="c"># libraries that might not be present on this system.</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../index.html">Home</a></li>
<li><a href="../News/index.html">News</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>
<li><a href="../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../Forums/index.html">Forums</a></li>
<li><a href="../Team_Members/index.html">Team Members</a></li>
<li><a href="../Future_Work/index.html">Future Work</a></li>
<li><a href="../FAQ/index.html">FAQ</a></li>
<li><a href="../Links/index.html">Links</a></li>
<li><a href="../Home/pubs.html">Publications</a></li>
<li><a href="../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/_modules/imagen.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" >Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 07, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>