<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>topo.tkgui.editor &mdash; Topographica</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/custom.js"></script>
    <link rel="shortcut icon" href="../../../_static/topo-favicon.ico"/>
    <link rel="top" title="Topographica" href="../../../index.html" />
    <link rel="up" title="topo.tkgui" href="../tkgui.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>



<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../tkgui.html" accesskey="U">topo.tkgui</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for topo.tkgui.editor</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The GUI model editor.</span>

<span class="sd">Tools:   for the editor menu bar</span>
<span class="sd">Objects: that can be manipulated in the canvas</span>
<span class="sd">Window:  window and canvas</span>

<span class="sd">Originally written by Alan Lindsay.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getdoc</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">Frame</span><span class="p">,</span> <span class="n">TOP</span><span class="p">,</span> <span class="n">LEFT</span><span class="p">,</span> <span class="n">RIGHT</span><span class="p">,</span> <span class="n">BOTTOM</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">LAST</span><span class="p">,</span> <span class="n">FIRST</span><span class="p">,</span> <span class="n">OptionMenu</span><span class="p">,</span> <span class="n">StringVar</span><span class="p">,</span><span class="n">Canvas</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">GROOVE</span><span class="p">,</span><span class="n">RAISED</span><span class="p">,</span><span class="n">Checkbutton</span><span class="p">,</span><span class="n">Menu</span><span class="p">,</span><span class="n">Scrollbar</span><span class="p">,</span> <span class="n">YES</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">END</span><span class="p">,</span><span class="n">BOTH</span>
<span class="kn">from</span> <span class="nn">tkFileDialog</span> <span class="kn">import</span> <span class="n">asksaveasfilename</span>


<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param</span> <span class="kn">import</span> <span class="n">parameterized</span><span class="p">,</span><span class="n">normalize_path</span>
<span class="kn">import</span> <span class="nn">paramtk</span> <span class="kn">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">paramtk.tilewrapper</span> <span class="kn">import</span> <span class="n">Combobox</span>

<span class="kn">import</span> <span class="nn">topo</span>
<span class="kn">from</span> <span class="nn">topo.command.analysis</span> <span class="kn">import</span> <span class="n">update_activity</span>
<span class="kn">from</span> <span class="nn">topo.misc.util</span> <span class="kn">import</span> <span class="n">shortclassname</span>
<span class="kn">from</span> <span class="nn">topo.base.simulation</span> <span class="kn">import</span> <span class="n">EventProcessor</span>

<span class="c"># Make sure at least some sheets or projections are available to</span>
<span class="c"># choose from; rest will be available if some other module imports *</span>
<span class="c"># from sheet and projection</span>
<span class="kn">from</span> <span class="nn">topo.base.sheet</span> <span class="kn">import</span> <span class="n">Sheet</span>
<span class="kn">from</span> <span class="nn">topo.base.projection</span> <span class="kn">import</span> <span class="n">Projection</span>
<span class="kn">from</span> <span class="nn">topo.base.cf</span> <span class="kn">import</span> <span class="n">CFProjection</span>


<span class="c">###########################################################################</span>
<span class="c">## WINDOW</span>
<span class="c">###########################################################################</span>

<span class="c"># These can be customized, e.g. in .topographicarc; they should probably be parameters</span>
<span class="c"># somewhere.</span>
<span class="n">canvas_width</span> <span class="o">=</span> <span class="mi">1200</span>
<span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">item_scale</span>
<span class="n">enlarging_factor</span> <span class="o">=</span> <span class="mf">1.25</span>

<span class="n">canvas_region</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">canvas_width</span><span class="p">,</span> <span class="n">canvas_width</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Size of the canvas, as a bounding box (xl yl xh yh).&quot;&quot;&quot;</span>


<div class="viewcode-block" id="EditorCanvas"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas">[docs]</a><span class="k">class</span> <span class="nc">EditorCanvas</span><span class="p">(</span><span class="n">Canvas</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EditorCanvas extends the Tk Canvas class.</span>
<span class="sd">    There are 3 modes that determine the effect of mouse events in the Canvas</span>
<span class="sd">    A Canvas can accept new objects, move objects and make connections</span>
<span class="sd">    between them. The intended use of this class is as the main</span>
<span class="sd">    canvas in a Topographica model-editing GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">600</span><span class="p">):</span>
        <span class="n">Canvas</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="c"># bg = &quot;white&quot;, bd = 2, relief = SUNKEN)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">X</span><span class="p">)</span>
        <span class="c"># Top bar of the canvas, allowing changes in size, display and to force refresh.</span>
        <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Refresh&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Reduce&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reduce_scale</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Enlarge&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enlarge_scale</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">guimain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh_checkbutton</span> <span class="o">=</span> <span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Auto-refresh&quot;</span><span class="p">,</span>
                                                    <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_auto_refresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh_checkbutton</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_checkbutton</span> <span class="o">=</span> <span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Normalize&quot;</span><span class="p">,</span>
                                                    <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_normalize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_checkbutton</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">EditorSheet</span><span class="o">.</span><span class="n">normalize</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalize_checkbutton</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node_labels_checkbutton</span> <span class="o">=</span> <span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Node labels&quot;</span><span class="p">,</span>
                                                    <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_node_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_labels_checkbutton</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">EditorNode</span><span class="o">.</span><span class="n">show_label</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_labels_checkbutton</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection_labels_checkbutton</span> <span class="o">=</span> <span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Connection labels&quot;</span><span class="p">,</span>
                                                    <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_connection_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_labels_checkbutton</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">EditorConnection</span><span class="o">.</span><span class="n">show_label</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_labels_checkbutton</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>

        <span class="c"># retain the current focus in the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">item_scale</span><span class="c">#scaling_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># list holding references to all the objects in the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># set the initial mode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">=</span> <span class="s">&#39;video&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;ARROW&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_VIEWS</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c"># get the topo simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span>

        <span class="c"># create the menu widget used as a popup on objects and connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_add</span><span class="p">(</span><span class="s">&quot;*Menu.tearOff&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="p">)</span>
        <span class="c"># add property, toggle activity drawn on sheets, object draw ordering and delete entries to the menu.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">insert_command</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Properties&#39;</span><span class="p">,</span>
            <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Change View&#39;</span><span class="p">,</span> <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="n">underline</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">insert_command</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Move Forward&#39;</span><span class="p">,</span>
            <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">insert_command</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Move to Front&#39;</span><span class="p">,</span>
            <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_front</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">insert_command</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Move to Back&#39;</span><span class="p">,</span>
            <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_back</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">insert_command</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Delete&#39;</span><span class="p">,</span>
            <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_focus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">))</span>
        <span class="c"># the indexes of the menu items that are for objects only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_options</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="p">)</span>
        <span class="n">mode_options</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Export as PostScript image&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_snapshot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Select Mode&#39;</span><span class="p">,</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">mode_options</span><span class="p">)</span>
        <span class="n">mode_options</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Video&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_display_mode</span><span class="p">(</span><span class="s">&#39;video&#39;</span><span class="p">))</span>
        <span class="n">mode_options</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_display_mode</span><span class="p">(</span><span class="s">&#39;normal&#39;</span><span class="p">))</span>
        <span class="n">mode_options</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Printing&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_display_mode</span><span class="p">(</span><span class="s">&#39;printing&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Sheet options&#39;</span><span class="p">,</span> <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet_options</span><span class="p">,</span> <span class="n">underline</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_options</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Toggle Density Grid&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_object_density</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_options</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Toggle Activity&#39;</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_object_activity</span><span class="p">)</span>

        <span class="c"># bind key_press events in canvas.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;KeyPress&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_press</span><span class="p">)</span>
        <span class="c"># bind the possible left button events to the canvas.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;B1-Motion&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_click_drag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_double_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;ButtonRelease-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_release</span><span class="p">)</span>
        <span class="c"># bind the possible right button events to the canvas.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;&lt;right-click&gt;&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_click</span><span class="p">)</span>
        <span class="c"># because right-click opens menu, a release event can only be flagged by the menu.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;&lt;right-click-release&gt;&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_release</span><span class="p">)</span>

        <span class="c"># add scroll bar; horizontal and vertical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">scrollregion</span> <span class="o">=</span> <span class="n">canvas_region</span><span class="p">)</span>
        <span class="n">vertical_scrollbar</span> <span class="o">=</span> <span class="n">Scrollbar</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">horizontal_scrollbar</span> <span class="o">=</span> <span class="n">Scrollbar</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">vertical_scrollbar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
        <span class="n">horizontal_scrollbar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">vertical_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">xscrollcommand</span><span class="o">=</span><span class="n">horizontal_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
        <span class="n">vertical_scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">Y</span><span class="p">)</span>
        <span class="n">horizontal_scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">X</span><span class="p">)</span>

<div class="viewcode-block" id="EditorCanvas.key_press"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.key_press">[docs]</a>    <span class="k">def</span> <span class="nf">key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What happens when a key is pressed.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="p">)</span>


    <span class="c">#   Left mouse button event handlers</span>
</div>
<div class="viewcode-block" id="EditorCanvas.left_click"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.left_click">[docs]</a>    <span class="k">def</span> <span class="nf">left_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What is to happen if the left button is pressed.&quot;</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="p">{</span><span class="s">&quot;ARROW&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_move</span><span class="p">,</span>           <span class="c"># case Arrow mode</span>
         <span class="s">&quot;MAKE&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">none</span><span class="p">,</span>                 <span class="c"># case Make mode</span>
         <span class="s">&quot;CONNECTION&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_connection</span> <span class="c"># case Connection mode.</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">](</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>                    <span class="c"># select function depending on mode</span>
</div>
<div class="viewcode-block" id="EditorCanvas.left_click_drag"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.left_click_drag">[docs]</a>    <span class="k">def</span> <span class="nf">left_click_drag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What is to happen if the mouse is dragged while the left button is pressed.&quot;</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="p">{</span><span class="s">&quot;ARROW&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_move</span><span class="p">,</span>              <span class="c"># case Arrow mode</span>
         <span class="s">&quot;MAKE&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">none</span><span class="p">,</span>                   <span class="c"># case Make mode</span>
         <span class="s">&quot;CONNECTION&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_connection</span> <span class="c"># case Connection mode.</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">](</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>                      <span class="c"># select function depending on mode</span>
</div>
<div class="viewcode-block" id="EditorCanvas.left_release"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.left_release">[docs]</a>    <span class="k">def</span> <span class="nf">left_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What is to happen when the left mouse button is released.&quot;</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="p">{</span><span class="s">&quot;ARROW&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_move</span><span class="p">,</span>            <span class="c"># case Arrow mode</span>
         <span class="s">&quot;MAKE&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_object</span><span class="p">,</span>        <span class="c"># case Make mode</span>
         <span class="s">&quot;CONNECTION&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_connection</span>  <span class="c"># case Connection mode.</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">](</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>                    <span class="c"># select function depending on mode</span>
</div>
<div class="viewcode-block" id="EditorCanvas.left_double_click"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.left_double_click">[docs]</a>    <span class="k">def</span> <span class="nf">left_double_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        What is to happen if the left button is double clicked.</span>
<span class="sd">        The same for all modes - show the properties for the clicked item.</span>
<span class="sd">        Gets object or connection at this point and gives it the focus.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">focus</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="c"># show the object or connection&#39;s properties.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_properties</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span>


    <span class="c">#   Right mouse button event handlers</span>
</div>
<div class="viewcode-block" id="EditorCanvas.right_click"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.right_click">[docs]</a>    <span class="k">def</span> <span class="nf">right_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What is to happen if the right button is pressed.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_hang_list</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorCanvas.right_release"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.right_release">[docs]</a>    <span class="k">def</span> <span class="nf">right_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;What is to happen when the right mouse button is released (bound to the menu).&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span> <span class="c"># remove focus.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>


    <span class="c">#   Mode Methods</span>
</div>
<div class="viewcode-block" id="EditorCanvas.change_mode"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.change_mode">[docs]</a>    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="s">&quot;Changes the mode of the canvas, i.e., what mouse events will do.&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="c"># remove the focus from the previous toolbar item</span>
        <span class="p">{</span><span class="s">&quot;ARROW&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrow_tool</span><span class="o">.</span><span class="n">set_focus</span><span class="p">,</span>     <span class="c"># arrow toolbar item</span>
         <span class="s">&quot;MAKE&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_tool</span><span class="o">.</span><span class="n">set_focus</span><span class="p">,</span>        <span class="c"># object toolbar item</span>
         <span class="s">&quot;CONNECTION&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_tool</span><span class="o">.</span><span class="n">set_focus</span> <span class="c"># connection toolbar item</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">](</span><span class="bp">False</span><span class="p">)</span>                  <span class="c"># select function depending on mode</span>

        <span class="c"># determine the new mode and corresponding toolbar item.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;CONNECTION&quot;</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_tool</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&#39;m&#39;</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;MAKE&quot;</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_tool</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;ARROW&quot;</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrow_tool</span>
        <span class="c"># set the focus of the toolbar item of the new mode and retain the note the new mode.</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>


    <span class="c">#   Panel methods</span>
</div>
    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">connection_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">from_connections</span><span class="p">[:]</span>
            <span class="n">connection_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">connection_list</span><span class="p">:</span>
                <span class="n">con</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">enlarge_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">*=</span> <span class="n">enlarging_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reduce_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">/=</span> <span class="n">enlarging_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">toggle_auto_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">auto_refresh_panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">auto_refresh_panels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toggle_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EditorSheet</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">EditorSheet</span><span class="o">.</span><span class="n">normalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">toggle_node_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">show_label</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">EditorNode</span><span class="o">.</span><span class="n">show_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">toggle_connection_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EditorConnection</span><span class="o">.</span><span class="n">show_label</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">EditorConnection</span><span class="o">.</span><span class="n">show_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>



    <span class="c">#   Object moving methods</span>
    <span class="c">#</span>
    <span class="c"># If an object is left clicked in the canvas, these methods allow</span>
    <span class="c"># it to be repositioned in the canvas.</span>

<div class="viewcode-block" id="EditorCanvas.init_move"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.init_move">[docs]</a>    <span class="k">def</span> <span class="nf">init_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Determine if click was on an object.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="c"># if it was, give it the focus</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorCanvas.update_move"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.update_move">[docs]</a>    <span class="k">def</span> <span class="nf">update_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;If dragging an object, refresh its position&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorCanvas.end_move"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.end_move">[docs]</a>    <span class="k">def</span> <span class="nf">end_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;If dropping an object, remove focus and refresh.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c"># redraw all the objects in the canavas and dereference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_object</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">#   Connection methods</span>
    <span class="c">#</span>
    <span class="c"># these methods allow a connection to be made between two objects in the canvas</span>
</div>
<div class="viewcode-block" id="EditorCanvas.init_connection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.init_connection">[docs]</a>    <span class="k">def</span> <span class="nf">init_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Determine if click was on an object, and retain if so.&quot;</span>

        <span class="n">current_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current_object</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span> <span class="c"># if not change to ARROW mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>  <span class="c"># if on an object, create a connection and give it the focus</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_tool</span><span class="o">.</span><span class="n">new_cover</span><span class="p">(</span><span class="n">current_object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorCanvas.update_connection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.update_connection">[docs]</a>    <span class="k">def</span> <span class="nf">update_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Update connection&#39;s position.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span><span class="o">.</span><span class="n">update_position</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EditorCanvas.end_connection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.end_connection">[docs]</a>    <span class="k">def</span> <span class="nf">end_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Determine if the connection has been dropped on an object.&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span> <span class="c"># if an object, connect the objects and remove focus</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_tool</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">connected</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="c"># if not an object, remove the connection</span>
            <span class="n">connected</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>
        <span class="c"># dereference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_connection</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="EditorCanvas.get_connection_xy"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.get_connection_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_connection_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Return connection at given x, y (None if no connection).&quot;</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">connection_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">from_connections</span><span class="p">[:]</span>
            <span class="n">connection_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">connection_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="n">con</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="c">#   Object Methods</span>
</div>
<div class="viewcode-block" id="EditorCanvas.create_object"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.create_object">[docs]</a>    <span class="k">def</span> <span class="nf">create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Create a new object.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_tool</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EditorCanvas.add_object"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.add_object">[docs]</a>    <span class="k">def</span> <span class="nf">add_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Add a new object to the Canvas.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span>
</div>
<div class="viewcode-block" id="EditorCanvas.add_object_to_back"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.add_object_to_back">[docs]</a>    <span class="k">def</span> <span class="nf">add_object_to_back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Add a new object to the Canvas at back of the list.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">+</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="EditorCanvas.remove_object"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.remove_object">[docs]</a>    <span class="k">def</span> <span class="nf">remove_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Remove an object from the canvas.&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="k">break</span>
        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="c"># object was not found</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">i</span>
</div>
    <span class="k">def</span> <span class="nf">toggle_object_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">EditorSheet</span><span class="o">.</span><span class="n">show_density</span><span class="p">:</span>
            <span class="n">EditorSheet</span><span class="o">.</span><span class="n">show_density</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EditorSheet</span><span class="o">.</span><span class="n">show_density</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">toggle_object_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">EditorSheet</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;activity&#39;</span><span class="p">:</span>
            <span class="n">EditorSheet</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="s">&#39;normal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EditorSheet</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="s">&#39;activity&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<div class="viewcode-block" id="EditorCanvas.get_object_xy"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.get_object_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Return object at given x, y (or None if no object).&quot;</span>

        <span class="c"># search through the bounds of each object in the canvas.</span>
        <span class="c"># returns the first (nearest to front) object, None if no object at x,y</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
                <span class="k">break</span>
        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">obj</span>

</div>
<div class="viewcode-block" id="EditorCanvas.show_properties"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.show_properties">[docs]</a>    <span class="k">def</span> <span class="nf">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="s">&quot;Show properties of an object or connection, and remove the focus.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">focus</span><span class="o">.</span><span class="n">show_properties</span><span class="p">()</span>
            <span class="n">focus</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorCanvas.delete_focus"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.delete_focus">[docs]</a>    <span class="k">def</span> <span class="nf">delete_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="s">&quot;Tell a connection or object to delete itself.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">focus</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>

    <span class="c">#   Object Order Methods</span>
    <span class="c">#</span>
    <span class="c"># These methods ensure the ordering in the canvas window is held</span>
    <span class="c"># and allows manipulation of the order.</span>
</div>
<div class="viewcode-block" id="EditorCanvas.redraw_objects"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.redraw_objects">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redraw all the objects in the canvas.</span>

<span class="sd">        If non-None, the index specifies that only the objects below</span>
<span class="sd">        that index need drawing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">move_to_front</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">))</span> <span class="p">:</span> <span class="c"># find object index in list</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="k">break</span>
        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="c"># object was not found</span>
        <span class="c"># swap this object for the one higher in the canvas and redraw</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_to_back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_object_to_back</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>

    <span class="c">#   Hang List Methods</span>
    <span class="c">#</span>
    <span class="c"># If there is an object or connection at the right clicked point,</span>
    <span class="c"># a popup menu is displayed, allowing for modifications to the</span>
    <span class="c"># particular obj/con.</span>

    <span class="k">def</span> <span class="nf">show_hang_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="c"># change to ARROW mode and get x, y mouse coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c"># get connection at this point</span>
        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_VIEWS</span><span class="p">)</span> <span class="p">:</span> <span class="c"># max number of views</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># if no connection, checks bounds of objects</span>
            <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="c"># fill in menu items that are just for objects</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">foreground</span> <span class="o">=</span> <span class="s">&#39;Black&#39;</span><span class="p">,</span> <span class="n">activeforeground</span> <span class="o">=</span> <span class="s">&#39;Black&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># gray out menu items that are just for objects</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">foreground</span> <span class="o">=</span> <span class="s">&#39;Gray&#39;</span><span class="p">,</span> <span class="n">activeforeground</span> <span class="o">=</span> <span class="s">&#39;Gray&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span> <span class="ow">in</span> <span class="n">focus</span><span class="o">.</span><span class="n">viewing_choices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="n">function</span><span class="p">)</span>
            <span class="c"># give the connection or object the focus</span>
            <span class="n">focus</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="n">focus</span>
            <span class="c"># create the popup menu at current mouse coord</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">item_menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas_menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>

    <span class="c">#   Utility methods</span>

    <span class="k">def</span> <span class="nf">save_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">POSTSCRIPT_FILETYPES</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Encapsulated PostScript images&#39;</span><span class="p">,</span><span class="s">&#39;*.eps&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s">&#39;PostScript images&#39;</span><span class="p">,</span><span class="s">&#39;*.ps&#39;</span><span class="p">),(</span><span class="s">&#39;All files&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">)]</span>
        <span class="n">snapshot_name</span> <span class="o">=</span> <span class="n">asksaveasfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="n">POSTSCRIPT_FILETYPES</span><span class="p">,</span>
                                          <span class="n">initialdir</span><span class="o">=</span><span class="n">normalize_path</span><span class="p">(),</span>
                                          <span class="n">initialfile</span><span class="o">=</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">basename</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.ps&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">snapshot_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postscript</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">snapshot_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_display_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_tool_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrow_tool</span><span class="p">,</span> <span class="n">connection_tool</span><span class="p">,</span> <span class="n">object_tool</span><span class="p">):</span>
        <span class="c"># reference to the toolbar items, a tool is notified when the canvas is changed</span>
        <span class="c"># to the mode corresponding to it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_tool</span> <span class="o">=</span> <span class="n">arrow_tool</span>
        <span class="c"># connection tool supplies &#39;connection&#39; objects that can draw themselves in the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_tool</span> <span class="o">=</span> <span class="n">connection_tool</span>
        <span class="c"># object tool supplies &#39;object&#39; objects that can draw themselves in the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_tool</span> <span class="o">=</span> <span class="n">object_tool</span>
        <span class="c"># initialise mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>

    <span class="c"># does nothing</span>
    <span class="k">def</span> <span class="nf">none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span> <span class="k">pass</span>

<div class="viewcode-block" id="EditorCanvas.get_xy"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorCanvas.get_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;Returns the connection or object at this x, y position or None if there is not one.&quot;</span>

        <span class="c"># check for a connection</span>
        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># if no connection, check bounds of objects</span>
            <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">focus</span> <span class="c"># return the first found or None</span>




<span class="c"># JABALERT: I made this into parameterized.Parameterized to make self.warning work,</span>
<span class="c"># but it should be changed to a PlotGroupPanel eventually</span></div></div>
<div class="viewcode-block" id="ModelEditor"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ModelEditor">[docs]</a><span class="k">class</span> <span class="nc">ModelEditor</span><span class="p">(</span><span class="n">parameterized</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class constructs the main editor window. It uses a instance</span>
<span class="sd">    of GUICanvas as the main editing canvas and inserts the</span>
<span class="sd">    three-option toolbar in a Frame along the left side of the window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">master</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">parameterized</span><span class="o">.</span><span class="n">Parameterized</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="c"># create editor window and set title</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">AppWindow</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Model Editor&quot;</span><span class="p">)</span>

        <span class="n">canvas_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">canvas_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span><span class="n">fill</span> <span class="o">=</span> <span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="n">YES</span><span class="p">)</span>

        <span class="n">toolbar_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">toolbar_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">LEFT</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">EditorCanvas</span><span class="p">(</span><span class="n">canvas_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="n">YES</span><span class="p">)</span>


        <span class="c"># object/node = sheet</span>

        <span class="n">parameters_tool</span> <span class="o">=</span> <span class="n">ParametersTool</span><span class="p">(</span><span class="n">toolbar_frame</span><span class="p">)</span>
        <span class="n">arrow_tool</span><span class="o">=</span><span class="n">ArrowTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">toolbar_frame</span><span class="p">,</span><span class="n">parameters_tool</span><span class="p">)</span>
        <span class="n">object_tool</span><span class="o">=</span><span class="n">NodeTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">toolbar_frame</span><span class="p">,</span><span class="n">parameters_tool</span><span class="p">)</span>
        <span class="n">connection_tool</span><span class="o">=</span><span class="n">ConnectionTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">toolbar_frame</span><span class="p">,</span><span class="n">parameters_tool</span><span class="p">)</span>

        <span class="n">arrow_tool</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">object_tool</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">connection_tool</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">parameters_tool</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>


        <span class="c"># give the canvas a reference to the toolbars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_tool_bars</span><span class="p">(</span><span class="n">arrow_tool</span><span class="p">,</span> <span class="n">connection_tool</span><span class="p">,</span> <span class="n">object_tool</span><span class="p">)</span>

        <span class="c"># give the canvas focus and import any objects and connections already in the simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>


        <span class="c"># Grid layout defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstart</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ystart</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xstart</span><span class="o">+</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ystart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="mi">150</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="mi">150</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">import_model</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">import_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># get a list of all the objects in the simulation</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">simulation</span>
        <span class="n">node_dictionary</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">EventProcessor</span><span class="p">)</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c"># create the editor covers for the nodes</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
            <span class="c"># if the sheet has x,y coords, use them</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s">&#39;layout_location&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">layout_location</span><span class="o">!=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">layout_location</span>
            <span class="c"># if not generate new coords on a grid layout</span>
            <span class="c"># Could use dot/graphviz to place the objects nicely</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_x</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ystep</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span> <span class="o">&gt;</span> <span class="n">canvas_region</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ystart</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">next_x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xstep</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_x</span> <span class="o">&gt;</span> <span class="n">canvas_region</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">next_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xstart</span> <span class="o">+</span> <span class="mi">15</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">next_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ystart</span> <span class="o">+</span> <span class="mi">15</span>

            <span class="c"># Could handle more EventProcessor subclasses here</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">Sheet</span><span class="p">):</span>
                <span class="n">editor_node</span> <span class="o">=</span> <span class="n">EditorSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">editor_node</span> <span class="o">=</span> <span class="n">EditorEP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">node</span><span class="o">.</span><span class="n">layout_location</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="n">editor_node</span><span class="p">)</span>

        <span class="c"># create the editor covers for the connections</span>

        <span class="k">for</span> <span class="n">editor_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">editor_node</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">out_connections</span><span class="p">:</span>
                <span class="c"># Could handle more EditorConnection subclasses here</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="n">CFProjection</span><span class="p">):</span>
                    <span class="n">editor_connection</span> <span class="o">=</span> <span class="n">EditorProjection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">editor_node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">editor_connection</span> <span class="o">=</span> <span class="n">EditorEPConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">editor_node</span><span class="p">)</span>

                <span class="c"># find the EditorNode that the proj connects to</span>
                <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">object_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">simobj</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">dest</span><span class="p">):</span>
                        <span class="c"># connect the connection to the destination node</span>
                        <span class="n">editor_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;The model editor cannot draw connection&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                 <span class="s">&quot;because&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;is not drawn in the editor.&quot;</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>























<span class="c">###########################################################################</span>
<span class="c">## TOOLS</span>
<span class="c">###########################################################################</span>
</div>
<div class="viewcode-block" id="ArrowTool"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ArrowTool">[docs]</a><span class="k">class</span> <span class="nc">ArrowTool</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ArrowTool is a selectable frame containing an arrow icon and a label. It is a</span>
<span class="sd">    toolbar item in a ModelEditor that allows the user to change the GUICanvas to</span>
<span class="sd">    &#39;ARROW&#39; mode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span>  <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">parambar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span> <span class="c"># hold canvas reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">=</span> <span class="n">parambar</span> <span class="c"># To display class properties and name</span>
        <span class="c"># label sets canvas mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Move:&quot;</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span><span class="s">&#39;light grey&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;Use the arrow tool to select and</span><span class="se">\n</span><span class="s">move objects in the canvas around&#39;</span>
        <span class="c"># arrow icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">create_polygon</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span> <span class="c"># icon sets canvas mode</span>
        <span class="c"># pack in toolbar at top and fill out in X direction; click changes canvas mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="c"># (ARROW)</span>

<div class="viewcode-block" id="ArrowTool.set_focus"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ArrowTool.set_focus">[docs]</a>    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="s">&quot;Change the background highlight to reflect whether this toolbar item is selected.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span><span class="p">):</span>
             <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;dark grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">GROOVE</span>
             <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="s">&#39;Arrow&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span>

        <span class="c"># ALERT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">relief</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>



<span class="c"># hack to sort by precedence</span>
<span class="c"># (won&#39;t need when modeleditor is plotgroup)</span></div></div>
<span class="k">def</span> <span class="nf">names_sorted_by_precedence</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
    <span class="n">classes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">precedence</span><span class="p">,</span><span class="o">-</span><span class="n">y</span><span class="o">.</span><span class="n">precedence</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">class_</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">]</span>


<div class="viewcode-block" id="NodeTool"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.NodeTool">[docs]</a><span class="k">class</span> <span class="nc">NodeTool</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NodeTool extends Frame. It is expected to be included in a topographica</span>
<span class="sd">    model development GUI and functions as a self populating Node tool.</span>
<span class="sd">    The available Sheet types are supplied to be selected from. This Tool supplies</span>
<span class="sd">    a suitable Editor cover for a node and creates the corresponding topo object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># hack: we can do this properly when converting to a plotgrouppanel</span>
    <span class="n">default_sheet</span> <span class="o">=</span> <span class="s">&#39;CFSheet&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span>  <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">parambar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span> <span class="c"># hold canvas reference.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">=</span> <span class="n">parambar</span> <span class="c"># To display class properties and name</span>
        <span class="c"># bind clicks, pack in toolbar at top and fill out in X direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">X</span><span class="p">)</span>
        <span class="c"># label sets canvas mode</span>

        <span class="c"># CebAlerT: make these &#39;move&#39; &#39;add sheet of type&#39; things etc</span>
        <span class="c"># look like buttons again, or -better - clean up the whole</span>
        <span class="c"># interface!</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Add sheet of type:&quot;</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span><span class="s">&#39;light grey&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;Use the sheet tool to click a</span><span class="se">\n</span><span class="s">sheet object into the canvas.&#39;</span>
        <span class="c"># gets list of all the available sheets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">concrete_descendents</span><span class="p">(</span><span class="n">Sheet</span><span class="p">)</span>

        <span class="n">sheet_list</span> <span class="o">=</span> <span class="n">names_sorted_by_precedence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c">## menu with list of available sheets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span> <span class="o">=</span> <span class="n">StringVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_sheet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span> <span class="o">=</span> <span class="n">Combobox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="p">,</span>
                                    <span class="n">values</span><span class="o">=</span><span class="n">sheet_list</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&#39;readonly&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">trace_variable</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">set_option</span><span class="p">)</span>





    <span class="c">#   Focus Methods</span>

    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span> <span class="c"># (&#39;MAKE&#39;)</span>

<div class="viewcode-block" id="NodeTool.set_focus"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.NodeTool.set_focus">[docs]</a>    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="s">&quot;Change the background highlight to reflect whether this toolbar item is selected.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;dark grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">GROOVE</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_option</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">current_option</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span>

        <span class="c"># ALERT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">relief</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
        <span class="c">#self.option_menu.config(bg = col)</span>


    <span class="c">#   Node Methods</span>
</div>
    <span class="k">def</span> <span class="nf">create_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>
        <span class="c"># get the current selection and create the new topo object</span>

        <span class="c"># CEBALERT: because Parameterized overwrites the name</span>
        <span class="c"># unless it&#39;s passed in params when the object is created, I</span>
        <span class="c"># pass the class name (set by ParametersFrameWithApply) here.</span>
        <span class="c"># Same goes for projections. (i.e. Allow people to set the name</span>
        <span class="c"># for a new sheet or projection.)</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="c"># Instead, should have a popup that asks for the name.</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">simobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">](</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">simobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">]()</span>

        <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">simulation</span> <span class="c"># get the current simulation</span>
        <span class="n">sim</span><span class="p">[</span><span class="n">simobj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">simobj</span>
        <span class="c"># create the cover for the simobj and return it.</span>
        <span class="k">return</span> <span class="n">EditorSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">simobj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="c">#   Util Methods</span>

<div class="viewcode-block" id="NodeTool.set_option"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.NodeTool.set_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>




<span class="c"># JABHACKALERT: Currently only searches for topo.projection (connections have not been implemented yet).</span></div></div>
<div class="viewcode-block" id="ConnectionTool"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ConnectionTool">[docs]</a><span class="k">class</span> <span class="nc">ConnectionTool</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ConnectionTool extends Frame. It is expected to be included in a topographica</span>
<span class="sd">    model development GUI and functions as a self populating Connection toolbar.</span>
<span class="sd">    The available Connection types are listed and the user can select one.</span>
<span class="sd">    When a connection is formed between two nodes a topo.projection of the</span>
<span class="sd">    specified type is instantiated and a reference to it is stored in it&#39;s Editor</span>
<span class="sd">    cover. Allows user to change the EditorCanvas mode to &#39;CONNECTION&#39; mode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">parambar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c"># super constructor call.</span>
        <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span> <span class="c"># hold canvas reference.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">=</span> <span class="n">parambar</span> <span class="c"># To display class properties and name</span>
        <span class="c"># bind clicks, pack in toolbar at top and fill out in X direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">X</span><span class="p">)</span>
        <span class="c"># label sets canvas mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Add projection of type:&quot;</span><span class="p">,</span><span class="n">bg</span> <span class="o">=</span><span class="s">&#39;light grey&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;Use the connection tool to</span><span class="se">\n</span><span class="s">drag connections between objects&#39;</span>
        <span class="c"># gets list of all the available projections.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_list</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">concrete_descendents</span><span class="p">(</span><span class="n">Projection</span><span class="p">)</span>
        <span class="n">proj_list</span> <span class="o">=</span> <span class="n">names_sorted_by_precedence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proj_list</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


        <span class="c">## menu with list of available projections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span> <span class="o">=</span> <span class="n">StringVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">proj_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span> <span class="o">=</span> <span class="n">Combobox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="p">,</span>
                                    <span class="n">values</span><span class="o">=</span><span class="n">proj_list</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&#39;readonly&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_menu</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">trace_variable</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">set_option</span><span class="p">)</span>



    <span class="c">#   Canvas Topo Linking Methods</span>

<div class="viewcode-block" id="ConnectionTool.new_cover"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ConnectionTool.new_cover">[docs]</a>    <span class="k">def</span> <span class="nf">new_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an EditorProjection and return it.</span>

<span class="sd">        If there is more than one representation for connections/</span>
<span class="sd">        projections, the returned object will depend on the current</span>
<span class="sd">        selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EditorProjection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ConnectionTool.create_connection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ConnectionTool.create_connection">[docs]</a>    <span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor_connection</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="s">&quot;Connects the editor connection and the topo simulation connection.&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">simulation</span>
        <span class="n">from_node</span> <span class="o">=</span> <span class="n">editor_connection</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">simobj</span>
        <span class="n">to_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">simobj</span>
        <span class="n">con_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">]</span>
        <span class="n">con_name</span> <span class="o">=</span> <span class="n">con_type</span><span class="o">.</span><span class="n">name</span>
        <span class="c"># CEBHACKALERT: see alert about sheet name</span>

        <span class="c"># CEBHACKALERT: should probably catch a specific error?</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">con_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">con</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">from_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">to_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">connection_type</span><span class="o">=</span><span class="n">con_type</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">con_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">con</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">from_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">to_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">connection_type</span><span class="o">=</span><span class="n">con_type</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Unable to connect these sheets with the given &quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_option</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;).&quot;</span><span class="p">)</span>
            <span class="n">editor_connection</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">editor_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="ConnectionTool.set_option"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ConnectionTool.set_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


    <span class="c">#   Focus Methods</span>
</div>
    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span> <span class="c"># (&#39;CONNECTION&#39;)</span>

<div class="viewcode-block" id="ConnectionTool.set_focus"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.ConnectionTool.set_focus">[docs]</a>    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="s">&quot;Change the background highlight to reflect whether this toolbar item is selected.&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">focus</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;dark grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">GROOVE</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">current_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_option</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_option</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_tool</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">current_option</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;light grey&#39;</span><span class="p">;</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">RAISED</span>

        <span class="c"># ALERT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">relief</span> <span class="o">=</span> <span class="n">relief</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
        <span class="c">#self.option_menu.config(bg = col)</span>

</div></div>
<span class="k">class</span> <span class="nc">ParametersTool</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="c"># CEBALERT: need to tidy up the title, positioning, etc.</span>
        <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Times&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">)</span>

        <span class="c"># CEBALERT: will the users think they have to press &#39;apply&#39; rather than just clicking</span>
        <span class="c"># on the canvas to get the new object?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">ParametersFrameWithApply</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="c">#,buttons_to_remove=[&#39;Close&#39;,&#39;Defaults&#39;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">hide_param</span><span class="p">(</span><span class="s">&#39;Close&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">hide_param</span><span class="p">(</span><span class="s">&#39;Defaults&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">BOTTOM</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">focus_class</span><span class="p">,</span> <span class="n">doc</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">focus_class</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">set_PO</span><span class="p">(</span><span class="n">focus_class</span><span class="p">)</span>



<span class="c">###########################################################################</span>
<span class="c">## OBJECTS</span>
<span class="c">###########################################################################</span>

<span class="c"># CEBALERT: should be a Parameterized</span>
<div class="viewcode-block" id="EditorObject"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject">[docs]</a><span class="k">class</span> <span class="nc">EditorObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Anything that can be added and manipulated in an EditorCanvas. Every EditorCanvas</span>
<span class="sd">    has a corresponding Topo object associated with it. An instance of this class can</span>
<span class="sd">    have the focus.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FROM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TO</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span> <span class="c"># retains a reference to the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="c"># set the name of the sheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># this does not have the focus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewing_choices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="bp">None</span>

<div class="viewcode-block" id="EditorObject.draw"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Draw the object at the current x, y position.&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="EditorObject.objdoc"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.objdoc">[docs]</a>    <span class="k">def</span> <span class="nf">objdoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Documentation string for this object.&quot;&quot;&quot;</span>
        <span class="c">### JABALERT: Should be expanded to allow a per-object description,</span>
        <span class="c">### and should be bound to the actual editor object as well.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; is of type &quot;</span> <span class="o">+</span> \
               <span class="n">shortclassname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="p">)</span> <span class="o">+</span> \
               <span class="s">&quot;:</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">getdoc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EditorObject.show_properties"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.show_properties">[docs]</a>    <span class="k">def</span> <span class="nf">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Show parameters frame for object.&quot;</span>

        <span class="n">parameter_window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">AppWindow</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">guimain</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#status=tk.StatusBar(parameter_window)</span>
        <span class="c">#status.pack(side=&quot;bottom&quot;,fill=&#39;x&#39;,expand=&#39;yes&#39;)</span>

        <span class="n">parameter_window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">balloon</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Balloon</span><span class="p">(</span><span class="n">parameter_window</span><span class="p">)</span>

<span class="c">#        import __main__;__main__.__dict__[&#39;AAA&#39;] = parameter_window</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">parameter_window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">title</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">ParametersFrameWithApply</span><span class="p">(</span>
            <span class="n">parameter_window</span><span class="p">,</span>
            <span class="n">msg_handler</span><span class="o">=</span><span class="n">parameter_window</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">parameter_window</span><span class="o">.</span><span class="n">sizeright</span><span class="p">()</span>

        <span class="n">balloon</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">objdoc</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_window</span> <span class="o">=</span> <span class="n">parameter_window</span>
</div>
    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">okay_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>
        <span class="n">parameter_window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="p">:</span> <span class="c"># set focus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="n">focus</span>

<div class="viewcode-block" id="EditorObject.move"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Update position of object and redraw.&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="EditorObject.remove"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Remove this object from the canvas and from the Topographica simulation.&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="EditorObject.in_bounds"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorObject.in_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
        <span class="s">&quot;Return true if x,y lies within this gui object&#39;s boundary.&quot;</span>
        <span class="k">pass</span>


</div></div>
<div class="viewcode-block" id="EditorNode"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorNode">[docs]</a><span class="k">class</span> <span class="nc">EditorNode</span><span class="p">(</span><span class="n">EditorObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An EditorNode is used to cover any topographica node, presently this can only be a sheet.</span>
<span class="sd">    It is a sub class of EditorObject and supplies the methods required by any node to be used</span>
<span class="sd">    in a EditorCanvas. Extending classes will supply a draw method and other type specific</span>
<span class="sd">    attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">show_label</span><span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Whether to show a textual label for this object&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">EditorObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># connections from this node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># connections to this node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># set the x and y coords of the center of this node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">display_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span> <span class="o">=</span> <span class="n">simobj</span>

    <span class="c">#   Connection methods</span>

    <span class="k">def</span> <span class="nf">attach_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">from_to</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">from_to</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">FROM</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span> <span class="o">+</span> <span class="p">[</span><span class="n">con</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="o">+</span> <span class="p">[</span><span class="n">con</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">from_to</span><span class="p">)</span> <span class="p">:</span> <span class="c"># remove a connection to or from this node</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">from_to</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">con</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">con</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span> <span class="p">:</span> <span class="k">return</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


    <span class="c">#   Util methods</span>

    <span class="k">def</span> <span class="nf">get_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="c"># return center point of node</span>

    <span class="k">def</span> <span class="nf">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EditorObject</span><span class="o">.</span><span class="n">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">set_PO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="p">)</span>
        <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Connections&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">)</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">)))</span>
        <span class="n">connection_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection_var</span> <span class="o">=</span> <span class="n">StringVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">connection_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">connection_menu</span> <span class="o">=</span> <span class="n">OptionMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_window</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_var</span><span class="p">,</span><span class="o">*</span><span class="n">connection_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection_var</span><span class="o">.</span><span class="n">trace_variable</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">view_connection_parameters</span><span class="p">)</span>

        <span class="n">connection_menu</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="n">TOP</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">view_connection_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">con_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">con_sel</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span>
        <span class="n">con</span><span class="o">.</span><span class="n">show_properties</span><span class="p">()</span>



<span class="c"># JABALERT: Should probably combine this with EditorNode</span></div>
<div class="viewcode-block" id="EditorEP"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorEP">[docs]</a><span class="k">class</span> <span class="nc">EditorEP</span><span class="p">(</span><span class="n">EditorNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents any topo EventProcessor as a small, fixed-size oval by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">simobj</span><span class="o">.</span><span class="n">layout_location</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="c"># store the ed coords in the topo sheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_bounds</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_colours</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_draw</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="c"># create a new parallelogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentCol</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c">#   Draw methods</span>

    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="c"># remove label</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c"># call to super&#39;s set focus</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="ow">not</span> <span class="n">focus</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_draw</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c"># create new one with correct colour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentCol</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">select_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_choice</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view_choice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">redraw_objects</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_colours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">colour</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;video&#39;</span><span class="p">:(</span><span class="s">&#39;dark red&#39;</span><span class="p">,</span><span class="s">&#39;black&#39;</span><span class="p">),</span>
                  <span class="s">&#39;normal&#39;</span><span class="p">:(</span><span class="s">&#39;slate blue&#39;</span><span class="p">,</span> <span class="s">&#39;lavender&#39;</span><span class="p">),</span>
                  <span class="s">&#39;printing&#39;</span><span class="p">:(</span><span class="s">&#39;grey&#39;</span><span class="p">,</span><span class="s">&#39;white&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="n">colour</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">]</span> <span class="c"># colours for drawing this node on the canvas</span>

    <span class="k">def</span> <span class="nf">init_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colour</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">focus</span> <span class="p">:</span> <span class="n">label_colour</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">label_colour</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">h</span><span class="p">)</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span><span class="n">outline</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)]</span>
        <span class="n">dX</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">dX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">E</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">label_colour</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dec_to_hex_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="c"># expects a normalised value and maps it to a hex value of the given length</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">0</span><span class="si">%d</span><span class="s">x&#39;</span><span class="o">%</span><span class="n">length</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="n">max_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># move the parallelogram and label by the given x, y coords (default redraw)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="c"># redraw the connections</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span><span class="p">):</span>
                <span class="n">con</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span><span class="p">)):</span>
                <span class="n">con</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span><span class="p">)):</span>
                <span class="n">con</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>


    <span class="c">#   Update methods</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">)</span> <span class="c"># remove all the connections from and to this sheet</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c"># remove from canvas&#39; object list</span>
        <span class="k">del</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="c"># actually delete the sheet</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c"># the connections position is updated</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">layout_location</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="c"># update topo sheet position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">old</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="c">#   Connection methods</span>

    <span class="k">def</span> <span class="nf">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">from_to</span><span class="p">):</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">from_to</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">from_to</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">from_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">to_node</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">draw_index</span>
        <span class="c"># Decrease the indexes of the connections between the same nodes and with a higher index.</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">connection</span><span class="o">.</span><span class="n">to_node</span> <span class="ow">and</span> <span class="n">connection</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">&gt;=</span> <span class="n">index</span><span class="p">):</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">decrement_draw_index</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="n">connection</span><span class="o">.</span><span class="n">from_node</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">connection</span><span class="o">.</span><span class="n">from_node</span> <span class="ow">and</span> <span class="n">connection</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">&gt;=</span> <span class="n">index</span><span class="p">):</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">decrement_draw_index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_connection_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="n">node</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">node</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span> <span class="p">:</span> <span class="n">count</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">count</span>


    <span class="c">#   Util methods</span>

    <span class="k">def</span> <span class="nf">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">pos_x</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>  <span class="ow">and</span> <span class="p">(</span><span class="n">pos_x</span><span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">pos_y</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pos_y</span><span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">set_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Default representation: fixed-size node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="mf">0.7</span>


    <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_colours</span><span class="p">()</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="c"># remove label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_connections</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_connections</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>



</div>
<div class="viewcode-block" id="EditorSheet"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorSheet">[docs]</a><span class="k">class</span> <span class="nc">EditorSheet</span><span class="p">(</span><span class="n">EditorEP</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents any topo sheet. It is a subclass of EditorEP and fills in the</span>
<span class="sd">    methods that are not defined. It is represented by a Parallelogram in its</span>
<span class="sd">    Canvas. The colours used for drawing can be set. Uses bounding box to</span>
<span class="sd">    determine if x, y coord is within its boundary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalize</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">show_density</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;activity&#39;</span><span class="p">,</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;activity&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c"># Should call EditorEP&#39;s constructor instead</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">simobj</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">simobj</span><span class="o">.</span><span class="n">layout_location</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="c"># store the ed coords in the topo sheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_element_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_bounds</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_colours</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_draw</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="c"># create a new parallelogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentCol</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewing_choices</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Normal&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;normal&#39;</span><span class="p">)),</span>
                                <span class="p">(</span><span class="s">&#39;Activity&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;activity&#39;</span><span class="p">))]</span>


    <span class="c">#   Draw methods</span>

    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="c"># remove label</span>
        <span class="n">EditorNode</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c"># call to super&#39;s set focus</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="ow">not</span> <span class="n">focus</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_draw</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c"># create new one with correct colour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentCol</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colour</span><span class="p">,</span> <span class="n">focus</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">focus</span> <span class="p">:</span> <span class="n">label_colour</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">label_colour</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span><span class="n">factor</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;activity&#39;</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">h</span>
                <span class="c"># AL, the idea will be to allow any available plots to be shown on the sheet.</span>
                <span class="c"># eg m = self.simobj.sheet_views[&#39;OrientationPreference&#39;].view()[0]</span>
                <span class="n">update_activity</span><span class="p">()</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">Maps</span><span class="p">[</span><span class="s">&#39;ActivityBuffer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_plot</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">matrix_width</span><span class="p">,</span> <span class="n">matrix_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_count</span>
                <span class="n">dX</span><span class="p">,</span> <span class="n">dY</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span> <span class="n">matrix_width</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">matrix_height</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_height</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_width</span><span class="p">):</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dY</span>
                        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">dX</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a</span>
                        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">dY</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dY</span>
                        <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">dX</span><span class="p">,</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">dX</span>
                        <span class="n">point</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">point</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">point</span> <span class="o">=</span> <span class="mf">0.0</span>
                        <span class="k">if</span> <span class="n">point</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">point</span> <span class="o">=</span> <span class="mf">1.0</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dec_to_hex_str</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_polygon</span>
                           <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">col</span><span class="p">)]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">x3</span><span class="p">,</span><span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">y2</span>
        <span class="n">x4</span><span class="p">,</span><span class="n">y4</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">y1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_polygon</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="n">colour</span> <span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">)]</span>
        <span class="n">dX</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">dX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">E</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">label_colour</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c"># adds a density grid over the sheet</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_density</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">h</span>
            <span class="n">matrix_width</span><span class="p">,</span> <span class="n">matrix_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_count</span>
            <span class="n">dX</span><span class="p">,</span> <span class="n">dY</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span> <span class="n">matrix_width</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">matrix_height</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">dY</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">dY</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s">&#39;slate blue&#39;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">dX</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s">&#39;slate blue&#39;</span><span class="p">)]</span>

<div class="viewcode-block" id="EditorSheet.normalize_plot"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorSheet.normalize_plot">[docs]</a>    <span class="k">def</span> <span class="nf">normalize_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize an array s.</span>
<span class="sd">        In case of a constant array, ones is returned for value greater than zero,</span>
<span class="sd">        and zeros in case of value inferior or equal to zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># AL is it possible to use the normalize method in plot?</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
        <span class="n">a_offset</span> <span class="o">=</span> <span class="n">a</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">max_a_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a_offset</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">max_a_offset</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
             <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">a_offset</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">max_a_offset</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
                  <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
             <span class="k">else</span><span class="p">:</span>
                  <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="c">#   Util methods</span>
</div>
    <span class="k">def</span> <span class="nf">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">)</span> <span class="p">:</span> <span class="c"># returns true if point lies in a bounding box</span>
        <span class="c"># if the coord is pressed within the parallelogram representation this</span>
        <span class="c"># returns true.</span>
        <span class="c"># Get the parallelogram points and centers them around the given point</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos_x</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">pos_y</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">w</span><span class="p">),</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># calculate the line constants</span>
        <span class="c"># As the gradient of the lines is 1 the calculation is simple.</span>
        <span class="n">a_AB</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a_CD</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># The points are centered around the given coord, finding the</span>
        <span class="c"># intersects with line y = 0 and ensuring that the left line</span>
        <span class="c"># lies on the negative side of the point and the right line</span>
        <span class="c"># lies on the positive side of the point determines that the</span>
        <span class="c"># point is within the parallelogram.</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a_AB</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a_CD</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">matrix_element_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># returns the length and width of the matrix that holds this sheet&#39;s plot values</span>
        <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">aarect</span><span class="p">()</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">xdensity</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">density</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">density</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use the default sheet bounds as to set the &quot;normal&quot; size</span>
        <span class="c"># of SheetObject in the GUI, so simulations using very large</span>
        <span class="c"># sheets still look normal.</span>
        <span class="n">dl</span><span class="p">,</span><span class="n">db</span><span class="p">,</span><span class="n">dr</span><span class="p">,</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">nominal_bounds</span><span class="o">.</span><span class="n">aarect</span><span class="p">()</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">width_fact</span> <span class="o">=</span> <span class="mf">120.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">dr</span> <span class="o">-</span> <span class="n">dl</span><span class="p">)</span>
        <span class="n">height_fact</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="n">db</span><span class="p">)</span>
        <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">aarect</span><span class="p">()</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width_fact</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height_fact</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>



</div>
<div class="viewcode-block" id="EditorConnection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorConnection">[docs]</a><span class="k">class</span> <span class="nc">EditorConnection</span><span class="p">(</span><span class="n">EditorObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A connection formed between 2 EditorNodes on a EditorCanvas. A EditorConnection is used</span>
<span class="sd">    to cover any topographica connection (connection / projection), and extending</span>
<span class="sd">    classes will supply a draw method and other type specific attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">show_label</span><span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Whether to show a textual label for this object&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">):</span>
        <span class="n">EditorObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span> <span class="o">=</span> <span class="n">from_node</span> <span class="c"># initial node selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># updated when the user selects the second node - self.connect(..)</span>
        <span class="c"># temporary point, for when the to connection node is undefined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_position</span> <span class="o">=</span> <span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">display_mode</span>


    <span class="c">#   Draw methods</span>

    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="p">:</span> <span class="c"># give this connection the focus</span>
        <span class="n">EditorObject</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


    <span class="c">#   Update methods</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># if one of the nodes connected by this connection move, then move by redrawing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="p">:</span> <span class="c"># update the temporary point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_position</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_node</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span> <span class="p">:</span> <span class="c"># pass the node this connection is to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span> <span class="o">=</span> <span class="n">con</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">=</span> <span class="n">to_node</span> <span class="c"># store a reference to the node this is connected to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_position</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">attach_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FROM</span><span class="p">)</span> <span class="c"># tell the sheets that they are connected.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">attach_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TO</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># CEBALERT: there&#39;s no code here to handle GUI object</span>
        <span class="c"># removal (though the EditorProjection subclass does have GUI</span>
        <span class="c"># removal code, so presumably projections do get removed from</span>
        <span class="c"># the screen. But I&#39;m confused about what is treated as a</span>
        <span class="c"># connection, and what as a projection in the model editor).</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;simobj&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


    <span class="c">#   Util methods</span>

    <span class="k">def</span> <span class="nf">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EditorObject</span><span class="o">.</span><span class="n">show_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_frame</span><span class="o">.</span><span class="n">set_PO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="p">)</span>


<span class="c"># JABALERT: Should probably combine this with EditorConnection</span></div>
<div class="viewcode-block" id="EditorEPConnection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorEPConnection">[docs]</a><span class="k">class</span> <span class="nc">EditorEPConnection</span><span class="p">(</span><span class="n">EditorConnection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents any topo EPConnection using a line with an arrow head in the middle.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">):</span>
        <span class="n">EditorConnection</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">)</span>
        <span class="c"># if more than one connection between nodes,</span>
        <span class="c"># this will reflect how to draw this connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balloon</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Balloon</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_colours</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="s">&#39;line&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewing_choices</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Line&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;line&#39;</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_factor</span><span class="p">()</span>

    <span class="c">#   Draw methods</span>

    <span class="k">def</span> <span class="nf">select_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_choice</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view_choice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_colours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">colours</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;video&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="s">&#39;dark red&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">),</span>
                   <span class="s">&#39;normal&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;dark red&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">),</span>
                   <span class="s">&#39;printing&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;grey&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="n">colours</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># determine if connected to a second node, and find the correct from_position</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="p">:</span> <span class="c"># remove the old connection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">from_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span> <span class="c"># get the center points of the two nodes</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>  <span class="c"># if not connected yet, use temporary point.</span>
            <span class="n">to_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_fn</span><span class="p">(</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">):</span>
        <span class="c"># set the colour to be used depending on whether connection has the focus.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_middle</span><span class="p">(</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">to_position</span> <span class="o">==</span> <span class="n">from_position</span><span class="p">)</span> <span class="p">:</span> <span class="c"># connection to and from the same node</span>
            <span class="n">deviation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="mi">20</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="n">deviation</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">40</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">deviation</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="p">((</span><span class="mi">30</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="n">deviation</span><span class="p">)</span>
            <span class="n">midX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_middle</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">x2</span><span class="p">,</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># create oval and an arrow head.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">midX</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">midX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">arrow</span> <span class="o">=</span> <span class="n">FIRST</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">))</span>
            <span class="c"># draw name label beside arrow head</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                    <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">30</span> <span class="o">+</span> <span class="n">deviation</span><span class="p">)</span> <span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c"># create a line between the nodes - use 2 to make arrow in center.</span>
            <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span>
            <span class="n">from_pos</span> <span class="o">=</span> <span class="n">from_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span><span class="p">,</span> <span class="n">from_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dev</span><span class="p">,</span> <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">from_pos</span><span class="p">,</span> <span class="n">mid</span> <span class="p">,</span> <span class="n">arrow</span> <span class="o">=</span> <span class="n">LAST</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">to_position</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">))</span>
            <span class="c"># draw name label</span>
            <span class="n">dX</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">dY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dX</span><span class="p">,</span>
                    <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dY</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">E</span><span class="p">)</span>


    <span class="c">#   Update methods</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span> <span class="c"># if a connection had been made then remove it from the &#39;to&#39; node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TO</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FROM</span><span class="p">)</span> <span class="c"># and remove from &#39;from&#39; node</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="p">:</span> <span class="c"># remove the representation from the canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="c"># CEBALERT: see earlier alert about EditorObject not inheriting from object.</span>
        <span class="n">EditorConnection</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c">#super(EditorProjection,self).remove()</span>


    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># if one of the nodes connected by this connection move, then move by redrawing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_gradient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_factor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">decrement_draw_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_coord</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_node</span><span class="p">,</span> <span class="n">con</span><span class="p">):</span>
        <span class="n">EditorConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_node</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_connection_count</span><span class="p">(</span><span class="n">to_node</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_node</span> <span class="o">==</span> <span class="n">to_node</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_to_coord</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_gradient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radius</span><span class="p">()</span>

    <span class="c">#   Util methods</span>

    <span class="k">def</span> <span class="nf">get_middle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">)</span> <span class="p">:</span> <span class="c"># returns the middle of two points</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">pos1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>

<div class="viewcode-block" id="EditorEPConnection.get_radius"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorEPConnection.get_radius">[docs]</a>    <span class="k">def</span> <span class="nf">get_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not implemented in this class&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">update_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">connect_to_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">sign</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">)))</span> <span class="o">*</span> <span class="n">width</span>

    <span class="c"># returns the gradients of the two lines making the opening &#39;v&#39; part of the receptive field.</span>
    <span class="c"># this depends on the draw_index, as it determines where the projection&#39;s representation begins.</span>
<div class="viewcode-block" id="EditorEPConnection.calculate_gradient"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorEPConnection.calculate_gradient">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not implemented in this class&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span> <span class="c"># returns true if point lies in a bounding box</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="c"># If connections are represented as lines</span>
        <span class="c"># currently uses an extent around the arrow head.</span>
        <span class="n">to_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="n">from_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="p">):</span>
            <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="mi">30</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="n">dev</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_middle</span><span class="p">(</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dev</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">dev</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_colours</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="EditorProjection"><a class="viewcode-back" href="../../../Reference_Manual/topo.tkgui.html#topo.tkgui.editor.EditorProjection">[docs]</a><span class="k">class</span> <span class="nc">EditorProjection</span><span class="p">(</span><span class="n">EditorEPConnection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents any topo CFProjection. It is a subclass of EditorEPConnection and fills</span>
<span class="sd">    in the methods that are not defined. Can be represented by a representation of a</span>
<span class="sd">    projection&#39;s receptive field or by a line with an arrow head in the middle;</span>
<span class="sd">    lateral projections are represented by a dotted ellipse around the center.</span>
<span class="sd">    Can determine if x,y coord is within the triangular receptive field or within an</span>
<span class="sd">    area around the arrow head. The same can be determined for a lateral projection</span>
<span class="sd">    ellipse.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">,</span> <span class="n">receptive_field</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">EditorEPConnection</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">from_node</span><span class="p">)</span>
        <span class="c"># if more than one connection between nodes,</span>
        <span class="c"># this will reflect how to draw this connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radius</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receptive_field</span> <span class="o">=</span> <span class="n">receptive_field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="s">&#39;radius&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewing_choices</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Field Radius&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;radius&#39;</span><span class="p">)),</span>
                                <span class="p">(</span><span class="s">&#39;Line&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;line&#39;</span><span class="p">)),</span>
                                <span class="p">(</span><span class="s">&#39;Fixed Size&#39;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_view</span><span class="p">(</span><span class="s">&#39;normal&#39;</span><span class="p">))]</span>


    <span class="c">#   Draw methods</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_fn</span> <span class="o">=</span> \
        <span class="p">{</span><span class="s">&#39;normal&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_normal</span><span class="p">,</span>
         <span class="s">&#39;line&#39;</span> <span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">draw_line</span><span class="p">,</span>
         <span class="s">&#39;radius&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_radius</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">]</span>
        <span class="n">EditorEPConnection</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">draw_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">):</span>
         <span class="c"># set the colour to be used depending on whether connection has the focus.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lateral_colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lateral_colour</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># midpoint of line</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_middle</span><span class="p">(</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">to_position</span> <span class="o">==</span> <span class="n">from_position</span><span class="p">)</span> <span class="p">:</span> <span class="c"># connection to and from the same node</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radius</span><span class="p">()</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">lateral_colour</span><span class="p">,</span>
                <span class="n">dash</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">outline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

<span class="c"># CEBALERT: as far as I know, this balloon binding never worked.</span>
<span class="c">#            self.balloon.tagbind(self.canvas, self.id[0], self.name)</span>

        <span class="k">else</span> <span class="p">:</span>  <span class="c"># connection between distinct nodes</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">to_position</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">from_position</span>
            <span class="c"># this is for cases when the radius changes size.</span>
            <span class="n">radius_x</span><span class="p">,</span> <span class="n">radius_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radius</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">radius_x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">radius_x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">radius_x</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">radius_y</span><span class="p">,</span>
                    <span class="n">x2</span> <span class="o">+</span> <span class="n">radius_x</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">radius_y</span><span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">col</span><span class="p">))</span>
            <span class="c"># draw name label</span>
            <span class="n">dX</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">dY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">*</span> <span class="mi">20</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dX</span><span class="p">,</span>
                    <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dY</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">E</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">draw_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">):</span>
        <span class="c"># set the colour to be used depending on whether connection has the focus.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lateral_colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text_col</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lateral_colour</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># midpoint of line</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_middle</span><span class="p">(</span><span class="n">from_position</span><span class="p">,</span> <span class="n">to_position</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">to_position</span> <span class="o">==</span> <span class="n">from_position</span><span class="p">)</span> <span class="p">:</span> <span class="c"># connection to and from the same node</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">lateral_colour</span><span class="p">,</span>
                <span class="n">dash</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">outline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

<span class="c">#            self.balloon.tagbind(self.canvas, self.id[0], self.name)</span>

        <span class="k">else</span> <span class="p">:</span>  <span class="c"># connection between distinct nodes</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">to_position</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">from_position</span>
            <span class="n">x2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">col</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">radius</span><span class="p">),</span>
                <span class="n">x2</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">radius</span><span class="p">),</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">col</span><span class="p">))</span>
            <span class="c"># draw name label</span>
            <span class="n">dX</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">dY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span> <span class="o">*</span> <span class="mi">20</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_label</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dX</span><span class="p">,</span>
                    <span class="n">middle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dY</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">text_col</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anchor</span> <span class="o">=</span> <span class="n">E</span><span class="p">)</span>


    <span class="c">#   Util methods</span>

    <span class="k">def</span> <span class="nf">get_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span><span class="p">,</span> <span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span> <span class="o">*</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span>
        <span class="n">node_bounds</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">aarect</span><span class="p">()</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simobj</span><span class="o">.</span><span class="n">bounds_template</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span><span class="p">,</span> <span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span> <span class="o">*</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">radius_x</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">node_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">node_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">radius_y</span> <span class="o">=</span> <span class="n">radius_x</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">node</span><span class="o">.</span><span class="n">width</span>
        <span class="k">return</span> <span class="n">radius_x</span><span class="p">,</span> <span class="n">radius_y</span>

    <span class="c"># returns the size of the semimajor and semiminor axis of the ellipse representing</span>
    <span class="c"># the draw_index-th lateral projection.</span>
    <span class="k">def</span> <span class="nf">get_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">width</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">height</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">major</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span><span class="p">)))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">w</span><span class="p">;</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">minor</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_index</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">major</span><span class="p">,</span> <span class="n">minor</span>

    <span class="k">def</span> <span class="nf">update_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_factor</span><span class="p">()</span>

    <span class="c"># returns the gradients of the two lines making the opening &#39;v&#39; part of the receptive field.</span>
    <span class="c"># this depends on the draw_index, as it determines where the projection&#39;s representation begins.</span>
    <span class="k">def</span> <span class="nf">calculate_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;radius&#39;</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span><span class="p">),</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span><span class="p">),</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">den_BA</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">den_BA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">m_BA</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">den_BA</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">m_BA</span> <span class="o">=</span> <span class="mi">99999</span> <span class="c"># AL - this should be a big number</span>
        <span class="n">den_CA</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">den_CA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">m_CA</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">den_CA</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">m_CA</span> <span class="o">=</span> <span class="mi">99999</span> <span class="c"># AL - this should be a big number</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m_BA</span><span class="p">,</span> <span class="n">m_CA</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span> <span class="c"># returns true if point lies in a bounding box</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">scaling_factor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;line&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EditorEPConnection</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># returns true if x, y lie inside the oval representing this lateral projection</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;radius&#39;</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_radius</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">a</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="n">pY</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="p">))))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">pY</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">pY</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="c"># returns true if x, y lie inside the triangular receptive</span>
            <span class="c"># field representing this projection get the points of the</span>
            <span class="c"># triangular receptive field, centered around the x, y</span>
            <span class="c"># point given</span>
            <span class="n">to_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="n">from_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">==</span> <span class="s">&#39;radius&#39;</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">from_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">from_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c">#C = (T[0] + self.radius[0], T[1])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">to_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">from_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deviation</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">from_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_radius</span> <span class="o">*</span> <span class="n">factor</span><span class="p">),</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c">#C = (T[0] + (self.normal_radius * factor), T[1])</span>
            <span class="c"># if the y coords lie outwith the boundaries, return false</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">or</span>
                <span class="p">((</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="c"># calculate the constant for the lines of the triangle</span>
            <span class="n">a_BA</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">a_CA</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c"># The points are centered around the given coord, finding</span>
            <span class="c"># the intersects with line y = 0 and ensuring that the</span>
            <span class="c"># left line lies on the negative side of the point and the</span>
            <span class="c"># right line lies on the positive side of the point</span>
            <span class="c"># determines that the point is within the triangle.</span>
            <span class="k">if</span> <span class="p">(((</span><span class="mi">0</span> <span class="o">-</span> <span class="n">a_CA</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="mi">0</span> <span class="o">-</span> <span class="n">a_BA</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">False</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">

<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../News/index.html">News</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>
<li><a href="../../../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../../../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../../../Forums/index.html">Forums</a></li>
<li><a href="../../../Team_Members/index.html">Team Members</a></li>
<li><a href="../../../Future_Work/index.html">Future Work</a></li>
<li><a href="../../../FAQ/index.html">FAQ</a></li>
<li><a href="../../../Links/index.html">Links</a></li>
<li><a href="../../../Home/pubs.html">Publications</a></li>
<li><a href="../../../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../../../index.html">Table Of Contents</a></h3>



<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/_modules/topo/tkgui/editor.rst" rel="nofollow">Edit on GitHub</a></li>
    <li><a	href="http://doozy.inf.ed.ac.uk:8010/builders/topographica_docs" rel="nofollow">Rebuild docs</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>



<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../tkgui.html" >topo.tkgui</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>