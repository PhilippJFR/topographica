
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>topo.tests.test_script &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for topo.tests.test_script</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains tests to check a particular script&#39;s results or speed have</span>
<span class="sd">not changed.</span>

<span class="sd">Check README and buildbot to see how all these tests are run.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">__main__</span><span class="o">,</span> <span class="nn">timeit</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">cPickle</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_array_equal</span><span class="p">,</span> <span class="n">assert_array_almost_equal</span>

<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param</span> <span class="kn">import</span> <span class="n">resolve_path</span><span class="p">,</span> <span class="n">normalize_path</span>

<span class="kn">import</span> <span class="nn">topo</span>

<span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">nottest</span>

<span class="c"># While training data is usually checked into topo/tests and is the</span>
<span class="c"># same for all machines, speed data is generated by the machine</span>
<span class="c"># running this makefile. Therefore, speed data is stored in a</span>
<span class="c"># machine-specific directory.</span>

<span class="n">TOPOGRAPHICAHOME</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span>
<span class="n">TESTSDATADIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TOPOGRAPHICAHOME</span><span class="p">,</span><span class="s">&quot;tests&quot;</span><span class="p">)</span>
<span class="n">MACHINETESTSDATADIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTSDATADIR</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
<span class="n">FIXEDDATADIR</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="s">&quot;topo/tests/data_traintests&quot;</span><span class="p">,</span><span class="n">path_to_file</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>



<span class="c">######################################################################################</span>
<span class="c">### Support fns</span>

<div class="viewcode-block" id="ensure_path_exists"><a class="viewcode-back" href="../../../Reference_Manual/topo.tests.test_script-module.html#topo.tests.test_script.ensure_path_exists">[docs]</a><span class="k">def</span> <span class="nf">ensure_path_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Force the specified path to exist if it doesn&#39;t yet.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_support_old_args</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c"># support old data files which contain &#39;default_density&#39;, etc</span>
    <span class="k">if</span> <span class="s">&#39;default_density&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;cortex_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;default_density&#39;</span><span class="p">]</span>
        <span class="c">#del args[&#39;default_density&#39;]</span>
    <span class="k">if</span> <span class="s">&#39;default_retina_density&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;retina_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;default_retina_density&#39;</span><span class="p">]</span>
        <span class="c">#del args[&#39;default_retina_density&#39;]</span>
    <span class="k">if</span> <span class="s">&#39;default_lgn_density&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;lgn_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;default_lgn_density&#39;</span><span class="p">]</span>
        <span class="c">#del args[&#39;default_lgn_density&#39;]</span>
    <span class="c"># (left the dels commented out for now in case scripts still use old names)</span>

<span class="k">def</span> <span class="nf">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">arg</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;Setting </span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>

<span class="c"># For generating data in a separate process, leaving the parent with</span>
<span class="c"># the original settings (i.e. avoids having to do a reset of</span>
<span class="c"># simulation time, etc).</span>
<span class="c"># CEBALERT: is this somehow causing func to run more slowly than</span>
<span class="c"># without forking?</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="k">def</span> <span class="nf">_run_in_forked_process</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_instantiate_everything</span><span class="p">(</span>
    <span class="n">classes_to_exclude</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;topo.base.simulation.Simulation&quot;</span><span class="p">,</span><span class="s">&quot;topo.base.simulation.Simulation&quot;</span><span class="p">),</span>
    <span class="n">modules_to_exclude</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;plotting&#39;</span><span class="p">,</span><span class="s">&#39;tests&#39;</span><span class="p">,</span><span class="s">&#39;tkgui&#39;</span><span class="p">,</span><span class="s">&#39;command&#39;</span><span class="p">,</span><span class="s">&#39;util&#39;</span><span class="p">)):</span>

    <span class="c"># default excludes currently set up for pickle tests</span>

    <span class="c"># CEBALERT: this is basically get_PO_class_attributes from param.parameterized</span>
    <span class="k">def</span> <span class="nf">get_classes</span><span class="p">(</span><span class="n">module</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">processed_modules</span><span class="p">,</span><span class="n">module_excludes</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">exec</span> <span class="s">&quot;from </span><span class="si">%s</span><span class="s"> import *&quot;</span><span class="o">%</span><span class="n">module</span><span class="o">.</span><span class="n">__name__</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">dict_</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s">&#39;__all__&#39;</span> <span class="ow">in</span> <span class="n">dict_</span> <span class="ow">and</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismodule</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">module_excludes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed_modules</span><span class="p">:</span>
                    <span class="n">get_classes</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">processed_modules</span><span class="p">,</span><span class="n">module_excludes</span><span class="p">)</span>
                <span class="n">processed_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># class &amp; not parameterizedfunction &amp; not __abstract &amp; not excluded &amp; starts with topo. or param.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">ParameterizedFunction</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s">&quot;_</span><span class="si">%s</span><span class="s">__abstract&quot;</span><span class="o">%</span><span class="n">v</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s">&quot;_</span><span class="si">%s</span><span class="s">__abstract&quot;</span><span class="o">%</span><span class="n">v</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">):</span>
                    <span class="n">full_class_path</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">__module__</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">v</span><span class="o">.</span><span class="n">__name__</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">full_class_path</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">full_class_path</span> <span class="ow">in</span> <span class="n">classes_to_exclude</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">full_class_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;topo&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">full_class_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;param&quot;</span><span class="p">)):</span>
                        <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_class_path</span><span class="p">)</span>

    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">processed_modules</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="kn">import</span> <span class="nn">topo</span>
    <span class="n">get_classes</span><span class="p">(</span><span class="n">topo</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">processed_modules</span><span class="p">,</span><span class="n">module_excludes</span><span class="o">=</span><span class="n">modules_to_exclude</span><span class="p">)</span>
    <span class="n">get_classes</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">classes</span><span class="p">,</span><span class="n">processed_modules</span><span class="p">,</span><span class="n">module_excludes</span><span class="o">=</span><span class="n">modules_to_exclude</span><span class="p">)</span>

    <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">instantiated_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">uninstantiated_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">class_name</span><span class="o">+</span><span class="s">&quot;()&quot;</span><span class="p">))</span>
            <span class="n">instantiated_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c">#print &quot;Could not instantiate %s&quot;%class_name</span>
            <span class="n">uninstantiated_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> ** Instantiated </span><span class="si">%s</span><span class="s"> classes:&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">instantiated_names</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">instantiated_names</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> ** Could not instantiate </span><span class="si">%s</span><span class="s"> classes:&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">uninstantiated_names</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uninstantiated_names</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">instances</span>

<span class="c">######################################################################################</span>


<span class="c"># CEBALERT: document somewhere about when to delete data files</span>
<span class="c"># (i.e. when to generate new data) for train-tests and speed-tests and</span>
<span class="c"># startup-speed-tests.</span>


<span class="c">######################################################################################</span>
<span class="c">### train-tests</span>

<span class="n">RUN_FOR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">150</span><span class="p">]</span>
<span class="n">LOOK_AT</span> <span class="o">=</span> <span class="s">&quot;V1&quot;</span>
<span class="n">TRAINTESTS_CORTEXDENSITY</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">RETINA_DENSITY</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">LGN_DENSITY</span> <span class="o">=</span> <span class="mi">24</span>

<span class="k">def</span> <span class="nf">_generate_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="n">look_at</span><span class="o">=</span><span class="s">&#39;V1&#39;</span><span class="p">,</span><span class="n">run_for</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">150</span><span class="p">],</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>

    <span class="k">print</span> <span class="s">&quot;Generating data for </span><span class="si">%s</span><span class="s">&#39;s </span><span class="si">%s</span><span class="s"> after topo.sim.run(</span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">look_at</span><span class="p">,</span><span class="n">run_for</span><span class="p">)</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="nb">execfile</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">run_for</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Running for </span><span class="si">%s</span><span class="s"> iterations&quot;</span><span class="o">%</span><span class="n">time</span>
        <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Recording data for </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">look_at</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">())</span>
        <span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">()]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">args</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;run_for&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">run_for</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;look_at&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">look_at</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">release</span>

    <span class="k">print</span> <span class="s">&quot;Saving data to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">data_filename</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">data_filename</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>


<span class="nd">@nottest</span>
<div class="viewcode-block" id="test_script"><a class="viewcode-back" href="../../../Reference_Manual/topo.tests.test_script-module.html#topo.tests.test_script.test_script">[docs]</a><span class="k">def</span> <span class="nf">test_script</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">decimal</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run script with the parameters specified when its DATA file was</span>
<span class="sd">    generated, and check for changes.</span>

<span class="sd">    Looks for the DATA file at FIXEDDATADIR/script_name.ty_DATA (for</span>
<span class="sd">    data checked into SVN). If not found there, looks at</span>
<span class="sd">    TESTSDATADIR/script_name.ty_DATA. If also not found there, first</span>
<span class="sd">    generates a new DATA file at TESTSDATADIR/script_name.ty_DATA</span>
<span class="sd">    (i.e. to generate new data, delete the existing data before running).</span>

<span class="sd">    The decimal parameter defines how many decimal points to use when</span>
<span class="sd">    testing for array equality. The default of None causes exact</span>
<span class="sd">    matching.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Comparing results for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>

    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="c"># CEBALERT: clean up</span>
    <span class="n">ensure_path_exists</span><span class="p">(</span><span class="n">TESTSDATADIR</span><span class="p">)</span>
    <span class="n">data_filename_only</span> <span class="o">=</span> <span class="n">script_name</span><span class="o">+</span><span class="s">&quot;_DATA&quot;</span>
    <span class="n">data_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TESTSDATADIR</span><span class="p">,</span><span class="n">data_filename_only</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename_only</span><span class="p">,</span><span class="n">search_paths</span><span class="o">=</span><span class="p">[</span><span class="n">FIXEDDATADIR</span><span class="p">,</span><span class="n">TESTSDATADIR</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No existing data&quot;</span>
        <span class="c">#_run_in_forked_process(_generate_data,script,data_filename,run_for=RUN_FOR,cortex_density=TRAINTESTS_CORTEXDENSITY,lgn_density=LGN_DENSITY, retina_density=RETINA_DENSITY)</span>
        <span class="n">_generate_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="n">run_for</span><span class="o">=</span><span class="n">RUN_FOR</span><span class="p">,</span><span class="n">cortex_density</span><span class="o">=</span><span class="n">TRAINTESTS_CORTEXDENSITY</span><span class="p">,</span><span class="n">lgn_density</span><span class="o">=</span><span class="n">LGN_DENSITY</span><span class="p">,</span><span class="n">retina_density</span><span class="o">=</span><span class="n">RETINA_DENSITY</span><span class="p">)</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Reading data from </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>

    <span class="n">data_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Data from release=</span><span class="si">%s</span><span class="s">, version=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;versions&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">else</span> <span class="p">(</span><span class="s">&quot;unknown&quot;</span><span class="p">,</span><span class="s">&quot;unknown&quot;</span><span class="p">))</span>

    <span class="c"># retrieve parameters used when script was run</span>
    <span class="n">run_for</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;run_for&#39;</span><span class="p">]</span>
    <span class="n">look_at</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;look_at&#39;</span><span class="p">]</span>

    <span class="c">####################################################</span>
    <span class="c"># support very old data files that contain &#39;density&#39; instead of args[&#39;cortex_density&#39;]</span>
    <span class="k">if</span> <span class="s">&#39;args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;cortex_density&#39;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;density&#39;</span><span class="p">]}</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span>
    <span class="n">_support_old_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="c">####################################################</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Starting &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">script</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

    <span class="c">#########################################################</span>
    <span class="n">time_fmt</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span>
    <span class="c"># support old pickled data (could replace time_fmt(topo.sim.time()) with</span>
    <span class="c"># just topo.sim.timestr() if we didn&#39;t need to support old data</span>
    <span class="k">if</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">(</span><span class="n">run_for</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">time_fmt</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="c">#########################################################</span>

    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">run_for</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Running for </span><span class="si">%s</span><span class="s"> iterations&quot;</span><span class="o">%</span><span class="n">time</span>
        <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">decimal</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">time_fmt</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span>
                           <span class="n">err_msg</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">At topo.sim.time()=</span><span class="si">%d</span><span class="s">, with decimal=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">decimal</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">time_fmt</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span>
                           <span class="n">decimal</span><span class="p">,</span><span class="n">err_msg</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">At topo.sim.time()=</span><span class="si">%d</span><span class="s">, with decimal=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">decimal</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;Results from &quot;</span> <span class="o">+</span> <span class="n">script</span> <span class="o">+</span> <span class="s">&quot; have not changed.&quot;</span>
    <span class="k">if</span> <span class="n">decimal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">result</span><span class="o">+=</span> <span class="s">&quot; (</span><span class="si">%d</span><span class="s"> dp)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decimal</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">result</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>


<span class="c"># CEBALERT: old name</span>
<span class="c">#TestScript = test_script</span>


<span class="c">###########################################################################</span>
<span class="c">### speed-tests</span>
</div>
<span class="n">SPEEDTESTS_CORTEXDENSITY</span><span class="o">=</span><span class="mi">48</span>
<span class="n">SPEEDTESTS_ITERATIONS</span> <span class="o">=</span> <span class="mi">250</span>

<span class="c"># CEBALERT: see ALERT about variation by time_sim_startup()</span>
<span class="k">def</span> <span class="nf">_time_sim_run</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the script in __main__, then time topo.sim.run(iterations).</span>

<span class="sd">    Uses the timeit module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Running &#39;</span><span class="si">%s</span><span class="s">&#39; for </span><span class="si">%s</span><span class="s"> iterations&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">iterations</span><span class="p">)</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># ensure compilations etc happen outside timing</span>
    <span class="c"># CB: we enable garbage collection</span>
    <span class="c"># (http://docs.python.org/lib/module-timeit.html)</span>
    <span class="k">return</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&#39;topo.sim.run(&#39;</span><span class="o">+</span><span class="sb">`iterations`</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="s">&#39;gc.enable(); import topo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_generate_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Generating speed data for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">how_long</span> <span class="o">=</span> <span class="n">_time_sim_run</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">iterations</span><span class="p">)</span>

    <span class="n">speed_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;args&#39;</span><span class="p">:</span><span class="n">args</span><span class="p">,</span>
                  <span class="s">&#39;iterations&#39;</span><span class="p">:</span><span class="n">iterations</span><span class="p">,</span>
                  <span class="s">&#39;how_long&#39;</span><span class="p">:</span><span class="n">how_long</span><span class="p">}</span>

    <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">release</span>

    <span class="k">print</span> <span class="s">&quot;Saving data to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">data_filename</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">speed_data</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">data_filename</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="compare_speed_data"><a class="viewcode-back" href="../../../Reference_Manual/topo.tests.test_script-module.html#topo.tests.test_script.compare_speed_data">[docs]</a><span class="k">def</span> <span class="nf">compare_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run and time script with the parameters specified when its SPEEDDATA file was</span>
<span class="sd">    generated, and check for changes.</span>

<span class="sd">    Looks for the SPEEDDATA file at</span>
<span class="sd">    MACHINETESTSDATADIR/script_name.ty_DATA. If not found there, first</span>
<span class="sd">    generates a new SPEEDDATA file at</span>
<span class="sd">    MACHINETESTSDATADIR/script_name.ty_DATA (i.e. to generate new</span>
<span class="sd">    data, delete the existing data before running).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Comparing speed data for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>

    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="n">ensure_path_exists</span><span class="p">(</span><span class="n">MACHINETESTSDATADIR</span><span class="p">)</span>
    <span class="n">data_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MACHINETESTSDATADIR</span><span class="p">,</span><span class="n">script_name</span><span class="o">+</span><span class="s">&quot;_SPEEDDATA&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No existing data&quot;</span>
        <span class="c">#_run_in_forked_process(_generate_speed_data,script,data_filename,iterations=SPEEDTESTS_ITERATIONS,cortex_density=SPEEDTESTS_CORTEXDENSITY)</span>
        <span class="n">_generate_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="n">SPEEDTESTS_ITERATIONS</span><span class="p">,</span><span class="n">cortex_density</span><span class="o">=</span><span class="n">SPEEDTESTS_CORTEXDENSITY</span><span class="p">)</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Reading data from </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>

    <span class="n">speed_data_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">speed_data_file</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Data from release=</span><span class="si">%s</span><span class="s">, version=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;versions&#39;</span> <span class="ow">in</span> <span class="n">speed_data</span> <span class="k">else</span> <span class="p">(</span><span class="s">&quot;unknown&quot;</span><span class="p">,</span><span class="s">&quot;unknown&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
    <span class="c">###############################################################</span>
    <span class="c">## Support old data files (used to be string in the file rather</span>
    <span class="c">## than pickle)</span>
        <span class="n">speed_data_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="n">speed_data_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="n">iterations</span><span class="p">,</span><span class="n">old_time</span> <span class="o">=</span> <span class="n">speed_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">iterations</span><span class="p">);</span> <span class="n">old_time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">old_time</span><span class="p">)</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;iterations&#39;</span><span class="p">:</span><span class="n">iterations</span><span class="p">,</span>
                      <span class="s">&#39;how_long&#39;</span><span class="p">:</span><span class="n">old_time</span><span class="p">,</span>
                      <span class="s">&#39;args&#39;</span><span class="p">:{}}</span>
    <span class="c">###############################################################</span>

    <span class="n">speed_data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">old_time</span> <span class="o">=</span> <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;how_long&#39;</span><span class="p">]</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;iterations&#39;</span><span class="p">]</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span>

    <span class="n">_support_old_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">new_time</span> <span class="o">=</span> <span class="n">_time_sim_run</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">iterations</span><span class="p">)</span>

    <span class="n">percent_change</span> <span class="o">=</span> <span class="mf">100.0</span><span class="o">*</span><span class="p">(</span><span class="n">new_time</span><span class="o">-</span><span class="n">old_time</span><span class="p">)</span><span class="o">/</span><span class="n">old_time</span>

    <span class="k">print</span> <span class="s">&quot;[&quot;</span><span class="o">+</span><span class="n">script</span><span class="o">+</span><span class="s">&quot;]&quot;</span><span class="o">+</span> <span class="s">&#39;  Before: </span><span class="si">%2.1f</span><span class="s"> s  Now: </span><span class="si">%2.1f</span><span class="s"> s  (change=</span><span class="si">%2.1f</span><span class="s"> s, </span><span class="si">%2.1f</span><span class="s"> percent)&#39;</span>\
          <span class="o">%</span><span class="p">(</span><span class="n">old_time</span><span class="p">,</span><span class="n">new_time</span><span class="p">,</span><span class="n">new_time</span><span class="o">-</span><span class="n">old_time</span><span class="p">,</span><span class="n">percent_change</span><span class="p">)</span>

    <span class="c"># CEBALERT: whatever compensations the python timing functions are supposed to make for CPU</span>
    <span class="c"># activity, do they work well enough? If the processor is being used, these times jump all</span>
    <span class="c"># over the place (i.e. vary by more than 10%).</span>
    <span class="c">#assert percent_change&lt;=5, &quot;\nTime increase was greater than 5%&quot;</span>

<span class="c">###########################################################################</span>


<span class="c">###########################################################################</span>
<span class="c">### startup timing</span>

<span class="c"># CEBALERT: figure out what this meant: &quot;expect variation in these</span>
<span class="c"># results! see python&#39;s timeit module documentation&quot;</span></div>
<span class="k">def</span> <span class="nf">_time_sim_startup</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Starting </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>
    <span class="k">return</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&quot;execfile(&#39;</span><span class="si">%s</span><span class="s">&#39;,__main__.__dict__)&quot;</span><span class="o">%</span><span class="n">script</span><span class="p">,</span><span class="s">&#39;import __main__;gc.enable()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_generate_startup_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Generating startup speed data for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">how_long</span> <span class="o">=</span> <span class="n">_time_sim_startup</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

    <span class="n">speed_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;args&#39;</span><span class="p">:</span><span class="n">args</span><span class="p">,</span>
                  <span class="s">&#39;how_long&#39;</span><span class="p">:</span><span class="n">how_long</span><span class="p">}</span>

    <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">release</span>

    <span class="k">print</span> <span class="s">&quot;Saving data to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">data_filename</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">speed_data</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">data_filename</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="compare_startup_speed_data"><a class="viewcode-back" href="../../../Reference_Manual/topo.tests.test_script-module.html#topo.tests.test_script.compare_startup_speed_data">[docs]</a><span class="k">def</span> <span class="nf">compare_startup_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run and time script with the parameters specified when its</span>
<span class="sd">    STARTUPSPEEDDATA file was generated, and check for changes.</span>

<span class="sd">    Looks for the STARTUPSPEEDDATA file at</span>
<span class="sd">    MACHINETESTSDATADIR/script_name.ty_STARTUPSPEEDDATA. If not found</span>
<span class="sd">    there, first generates a new STARTUPSPEEDDATA file at</span>
<span class="sd">    MACHINETESTSDATADIR/script_name.ty_STARTUPSPEEDDATA (i.e. to</span>
<span class="sd">    generate new data, delete the existing data before running).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\\\</span><span class="s">&quot;</span><span class="p">)</span>
    
    <span class="k">print</span> <span class="s">&quot;Comparing startup speed data for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">script</span>

    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="n">ensure_path_exists</span><span class="p">(</span><span class="n">MACHINETESTSDATADIR</span><span class="p">)</span>
    <span class="n">data_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MACHINETESTSDATADIR</span><span class="p">,</span><span class="n">script_name</span><span class="o">+</span><span class="s">&quot;_STARTUPSPEEDDATA&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No existing data&quot;</span>
        <span class="c">#_run_in_forked_process(_generate_startup_speed_data,script,data_filename,cortex_density=SPEEDTESTS_CORTEXDENSITY)</span>
        <span class="n">_generate_startup_speed_data</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">data_filename</span><span class="p">,</span><span class="n">cortex_density</span><span class="o">=</span><span class="n">SPEEDTESTS_CORTEXDENSITY</span><span class="p">)</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">data_filename</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Reading data from </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>

    <span class="n">speed_data_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">speed_data_file</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Data from release=</span><span class="si">%s</span><span class="s">, version=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;versions&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;versions&#39;</span> <span class="ow">in</span> <span class="n">speed_data</span> <span class="k">else</span> <span class="p">(</span><span class="s">&quot;unknown&quot;</span><span class="p">,</span><span class="s">&quot;unknown&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
    <span class="c">###############################################################</span>
    <span class="c">## Support old data files (used to be string in the file rather</span>
    <span class="c">## than pickle)</span>
        <span class="n">speed_data_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="n">speed_data_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="n">density</span><span class="p">,</span><span class="n">old_time</span> <span class="o">=</span> <span class="n">speed_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">speed_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;cortex_density&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">density</span><span class="p">),</span>
                      <span class="s">&#39;how_long&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">old_time</span><span class="p">),</span>
                      <span class="s">&#39;args&#39;</span><span class="p">:{}}</span>

    <span class="n">_support_old_args</span><span class="p">(</span><span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">])</span>
    <span class="c">###############################################################</span>

    <span class="n">_setargs</span><span class="p">(</span><span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">])</span>

    <span class="n">speed_data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">old_time</span> <span class="o">=</span> <span class="n">speed_data</span><span class="p">[</span><span class="s">&#39;how_long&#39;</span><span class="p">]</span>
    <span class="n">new_time</span> <span class="o">=</span> <span class="n">_time_sim_startup</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

    <span class="n">percent_change</span> <span class="o">=</span> <span class="mf">100.0</span><span class="o">*</span><span class="p">(</span><span class="n">new_time</span><span class="o">-</span><span class="n">old_time</span><span class="p">)</span><span class="o">/</span><span class="n">old_time</span>

    <span class="k">print</span> <span class="s">&quot;[&quot;</span><span class="o">+</span><span class="n">script</span><span class="o">+</span> <span class="s">&#39; startup]  Before: </span><span class="si">%2.1f</span><span class="s"> s  Now: </span><span class="si">%2.1f</span><span class="s"> s  (change=</span><span class="si">%2.1f</span><span class="s"> s, </span><span class="si">%2.1f</span><span class="s"> percent)&#39;</span>\
          <span class="o">%</span><span class="p">(</span><span class="n">old_time</span><span class="p">,</span><span class="n">new_time</span><span class="p">,</span><span class="n">new_time</span><span class="o">-</span><span class="n">old_time</span><span class="p">,</span><span class="n">percent_change</span><span class="p">)</span>


<span class="c">### end startup timing</span>
<span class="c">###########################################################################</span>


<span class="c">###########################################################################</span>
<span class="c">### Snapshot tests</span>

<span class="c"># This is clumsy. We could control topographica subprocesses, but I</span>
<span class="c"># can&#39;t remember how to do it</span>
</div>
<span class="k">def</span> <span class="nf">compare_with_and_without_snapshot_NoSnapshot</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="s">&quot;models/lissom.ty&quot;</span><span class="p">,</span><span class="n">look_at</span><span class="o">=</span><span class="s">&#39;V1&#39;</span><span class="p">,</span><span class="n">cortex_density</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">lgn_density</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">retina_density</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="s">&#39;od&#39;</span><span class="p">,</span><span class="s">&#39;dr&#39;</span><span class="p">,</span><span class="s">&#39;cr&#39;</span><span class="p">,</span><span class="s">&#39;dy&#39;</span><span class="p">,</span><span class="s">&#39;sf&#39;</span><span class="p">],</span><span class="n">dataset</span><span class="o">=</span><span class="s">&quot;Gaussian&quot;</span><span class="p">,</span><span class="n">run_for</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">break_at</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>

    <span class="n">data_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;_PICKLETEST&quot;</span>

    <span class="c"># we must execute in main because e.g. scheduled events are run in __main__</span>
    <span class="c"># CEBALERT: should set global params</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;cortex_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cortex_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;lgn_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lgn_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;retina_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">retina_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;dims&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dims</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;dataset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dataset</span>

    <span class="nb">execfile</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">break_at</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()]</span><span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span>
    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_for</span><span class="o">-</span><span class="n">break_at</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()]</span><span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s">&#39;run_for&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">run_for</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;break_at&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">break_at</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;look_at&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">look_at</span>

    <span class="n">data</span><span class="p">[</span><span class="s">&#39;cortex_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cortex_density</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;lgn_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lgn_density</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;retina_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">retina_density</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;dims&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dims</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;dataset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dataset</span>

    <span class="n">locn</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;tests&quot;</span><span class="p">,</span><span class="n">data_filename</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Writing pickle to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compare_with_and_without_snapshot_CreateSnapshot</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="s">&quot;models/lissom.ty&quot;</span><span class="p">):</span>
    <span class="n">data_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;_PICKLETEST&quot;</span>

    <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,</span><span class="n">data_filename</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Loading pickle at </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Data file &#39;&quot;</span><span class="o">+</span><span class="n">data_filename</span><span class="o">+</span><span class="s">&quot;&#39; could not be opened; run _A() first.&quot;</span>
        <span class="k">raise</span>

    <span class="c"># retrieve parameters used when script was run</span>
    <span class="n">run_for</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;run_for&#39;</span><span class="p">]</span>
    <span class="n">break_at</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;break_at&#39;</span><span class="p">]</span>
    <span class="n">look_at</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;look_at&#39;</span><span class="p">]</span>

    <span class="c"># CEBALERT: shouldn&#39;t need to re-list - should be able to read from data!</span>
    <span class="n">cortex_density</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;cortex_density&#39;</span><span class="p">]</span>
    <span class="n">lgn_density</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;lgn_density&#39;</span><span class="p">]</span>
    <span class="n">retina_density</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;retina_density&#39;</span><span class="p">]</span>
    <span class="n">dims</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;dims&#39;</span><span class="p">]</span>
    <span class="n">dataset</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;dataset&#39;</span><span class="p">]</span>

    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;cortex_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cortex_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;lgn_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lgn_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;retina_density&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">retina_density</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;dims&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dims</span>
    <span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;dataset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dataset</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="n">__main__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

    <span class="c"># check we have the same before any pickling</span>
    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">break_at</span><span class="p">)</span>
    <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span>
                       <span class="n">err_msg</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">At topo.sim.time()=</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">save_snapshot</span>
    <span class="n">locn</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,</span><span class="n">data_filename</span><span class="o">+</span><span class="s">&#39;.typ_&#39;</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Saving snapshot to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>
    <span class="n">save_snapshot</span><span class="p">(</span><span class="n">locn</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compare_with_and_without_snapshot_LoadSnapshot</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="s">&quot;models/lissom.ty&quot;</span><span class="p">):</span>
    <span class="n">data_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;_PICKLETEST&quot;</span>
    <span class="n">snapshot_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">script</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;_PICKLETEST.typ_&quot;</span>

    <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,</span><span class="n">data_filename</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Loading pickle from </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">locn</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Data file &#39;&quot;</span><span class="o">+</span><span class="n">data_filename</span><span class="o">+</span><span class="s">&quot;&#39; could not be opened; run _A() first&quot;</span>
        <span class="k">raise</span>

    <span class="c"># retrieve parameters used when script was run</span>
    <span class="n">run_for</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;run_for&#39;</span><span class="p">]</span>
    <span class="n">break_at</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;break_at&#39;</span><span class="p">]</span>
    <span class="n">look_at</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;look_at&#39;</span><span class="p">]</span>

<span class="c">#    # CEBALERT: shouldn&#39;t need to re-list - should be able to read from data!</span>
<span class="c">#    cortex_density=data[&#39;cortex_density&#39;]</span>
<span class="c">#    lgn_density=data[&#39;lgn_density&#39;]</span>
<span class="c">#    retina_density=data[&#39;retina_density&#39;]</span>
<span class="c">#    dims=data[&#39;dims&#39;]</span>
<span class="c">#    dataset=data[&#39;dataset&#39;]</span>

    <span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">load_snapshot</span>

    <span class="n">locn</span> <span class="o">=</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,</span><span class="n">snapshot_filename</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Loading snapshot at </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">locn</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">load_snapshot</span><span class="p">(</span><span class="n">locn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Pickle file &#39;&quot;</span><span class="o">+</span><span class="n">snapshot_filename</span><span class="o">+</span><span class="s">&quot;&#39; could not be opened; run _B() first.&quot;</span>
        <span class="k">raise</span>

    <span class="k">assert</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">==</span><span class="n">break_at</span>
    <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span>
                       <span class="n">err_msg</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">At topo.sim.time()=</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">print</span> <span class="s">&quot;Match at </span><span class="si">%s</span><span class="s"> after loading snapshot&quot;</span><span class="o">%</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_for</span><span class="o">-</span><span class="n">break_at</span><span class="p">)</span>

    <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">look_at</span><span class="p">]</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span>
                       <span class="n">err_msg</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">At topo.sim.time()=</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">print</span> <span class="s">&quot;Match at </span><span class="si">%s</span><span class="s"> after running loaded snapshot&quot;</span><span class="o">%</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c">### end Snapshot tests</span>
<span class="c">###########################################################################</span>


<span class="c">###########################################################################</span>
<span class="c">### pickle tests</span>
<span class="k">def</span> <span class="nf">pickle_unpickle_everything</span><span class="p">(</span><span class="n">existing_pickles</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">pickle_errors</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">existing_pickles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="n">_instantiate_everything</span><span class="p">()</span>
        <span class="n">pickles</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pickles</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)]</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Error pickling </span><span class="si">%s</span><span class="s">:&quot;</span><span class="o">%</span><span class="n">instance</span>
                <span class="n">pickle_errors</span><span class="o">+=</span><span class="mi">1</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pickles</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">existing_pickles</span><span class="p">))</span>

    <span class="n">unpickle_errors</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">instance_name</span><span class="p">,</span><span class="n">pickled_instance</span> <span class="ow">in</span> <span class="n">pickles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled_instance</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error unpickling </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">instance_name</span>
            <span class="n">unpickle_errors</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">print</span>

    <span class="k">if</span> <span class="n">existing_pickles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Instances that failed to pickle: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">pickle_errors</span>

    <span class="k">print</span> <span class="s">&quot;Pickled instances that failed to unpickle: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">unpickle_errors</span>

    <span class="k">return</span> <span class="n">pickle_errors</span><span class="o">+</span><span class="n">unpickle_errors</span>
<span class="c">###########################################################################</span>



<span class="c">###########################################################################</span>
<span class="c"># basic test of run batch</span>
<span class="nd">@nottest</span>
<span class="k">def</span> <span class="nf">test_runbatch</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">topo.misc.genexamples</span> <span class="kn">import</span> <span class="n">find_examples</span>
    <span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">run_batch</span>

    <span class="n">original_output_path</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span>
    <span class="n">start_output_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
    <span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">start_output_path</span>

    <span class="n">tiny</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">find_examples</span><span class="p">(),</span><span class="s">&quot;tiny.ty&quot;</span><span class="p">)</span>
    <span class="n">run_batch</span><span class="p">(</span><span class="n">tiny</span><span class="p">,</span><span class="n">cortex_density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">retina_density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">snapshot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">output_directory</span><span class="o">=</span><span class="s">&quot;testing123&quot;</span><span class="p">)</span>

    <span class="n">new_output_path</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span>

    <span class="k">assert</span> <span class="n">new_output_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">start_output_path</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s">&quot;testing123&quot;</span> <span class="ow">in</span> <span class="n">new_output_path</span> <span class="c"># not perfect test, but better than nothing.</span>

    <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_output_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="n">endpart</span><span class="p">):</span>
        <span class="n">whole</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_output_path</span><span class="p">,</span><span class="n">base</span><span class="o">+</span><span class="n">endpart</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Checking for </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">whole</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">whole</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="s">&quot;.global_params.pickle&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="s">&quot;.out&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="s">&quot;_000001.00_V1_Activity.png&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="s">&quot;_000001.00_script_repr.ty&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="s">&quot;_000001.00.typ&quot;</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Deleting </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">param</span><span class="o">.</span><span class="n">normalize_path</span><span class="o">.</span><span class="n">prefix</span><span class="o">=</span><span class="n">original_output_path</span>
<span class="c">###########################################################################</span>





<span class="c">###########################################################################</span>
<span class="c">## CEBALERT: for C++ reference simulations - should be moved elsewhere</span>
<span class="k">def</span> <span class="nf">run_multiple_density_comparisons</span><span class="p">(</span><span class="n">ref_script</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">topo.misc.util</span> <span class="kn">import</span> <span class="n">cross_product</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="kn">import</span> <span class="nn">os</span>

    <span class="c">#k = [8,10,12,13,14,34]</span>
    <span class="c">#x = cross_product([k,k])</span>


    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">15</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">17</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">24</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">]]</span>

    <span class="n">cmds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">c</span><span class="o">=</span><span class="s">&quot;&quot;&quot;./topographica -c &quot;verbose=False;BaseRN=</span><span class="si">%s</span><span class="s">;BaseN=</span><span class="si">%s</span><span class="s">;comparisons=True;stop_at_1000=False&quot; topo/tests/reference/</span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ref_script</span><span class="p">)</span>
        <span class="n">cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&quot;************************************************************&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Executing &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">cmd</span>

<span class="c">#        errout = os.tmpfile()#StringIO.StringIO()</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>

        <span class="n">errout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span>
        <span class="c">#r = subprocess.call(cmd,shell=True)#,stderr=subprocess.PIPE)#errout)</span>
        <span class="c">#print &quot;TB&quot;,traceback.print_exc()</span>

        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;PASS&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;FAIL&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">errout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">L</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;AssertionError&quot;</span><span class="p">):</span>
                <span class="n">L</span><span class="o">=</span><span class="n">i</span>
                <span class="k">break</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">L</span><span class="p">::])</span>
        <span class="n">errout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;================================================================================&quot;</span>
    <span class="k">print</span>
    <span class="k">print</span> <span class="s">&quot;SUMMARY&quot;</span>
    <span class="k">print</span>
    <span class="n">nerr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">xi</span><span class="p">,</span><span class="n">result</span><span class="p">,</span><span class="n">err</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">errs</span><span class="p">):</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&quot;* </span><span class="si">%s</span><span class="s"> ... BaseRN=</span><span class="si">%s</span><span class="s">,BaseN=</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">==</span><span class="s">&quot;FAIL&quot;</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

            <span class="n">nerr</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">print</span> <span class="s">&quot;================================================================================&quot;</span>

    <span class="k">return</span> <span class="n">nerr</span>

<span class="c">###########################################################################</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../News/index.html">News</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>
<li><a href="../../../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../../../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../../../Forums/index.html">Forums</a></li>
<li><a href="../../../Team_Members/index.html">Team Members</a></li>
<li><a href="../../../Future_Work/index.html">Future Work</a></li>
<li><a href="../../../FAQ/index.html">FAQ</a></li>
<li><a href="../../../Links/index.html">Links</a></li>
<li><a href="../../../Home/pubs.html">Publications</a></li>
<li><a href="../../../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../../../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/_modules/topo/tests/test_script.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 07, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>