
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>versioneer &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for versioneer</h1><div class="highlight"><pre>
<span class="c"># Version: 0.10</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Versioneer</span>
<span class="sd">==============</span>

<span class="sd">* like a rocketeer, but for versions!</span>
<span class="sd">* https://github.com/warner/python-versioneer</span>
<span class="sd">* Brian Warner</span>
<span class="sd">* License: Public Domain</span>
<span class="sd">* Compatible With: python2.6, 2.7, and 3.2, 3.3</span>

<span class="sd">[![Build Status](https://travis-ci.org/warner/python-versioneer.png?branch=master)](https://travis-ci.org/warner/python-versioneer)</span>

<span class="sd">This is a tool for managing a recorded version number in distutils-based</span>
<span class="sd">python projects. The goal is to remove the tedious and error-prone &quot;update</span>
<span class="sd">the embedded version string&quot; step from your release process. Making a new</span>
<span class="sd">release should be as easy as recording a new tag in your version-control</span>
<span class="sd">system, and maybe making new tarballs.</span>


<span class="sd">## Quick Install</span>

<span class="sd">* `pip install versioneer` to somewhere to your $PATH</span>
<span class="sd">* run `versioneer-installer` in your source tree: this installs `versioneer.py`</span>
<span class="sd">* follow the instructions below (also in the `versioneer.py` docstring)</span>

<span class="sd">## Version Identifiers</span>

<span class="sd">Source trees come from a variety of places:</span>

<span class="sd">* a version-control system checkout (mostly used by developers)</span>
<span class="sd">* a nightly tarball, produced by build automation</span>
<span class="sd">* a snapshot tarball, produced by a web-based VCS browser, like github&#39;s</span>
<span class="sd">  &quot;tarball from tag&quot; feature</span>
<span class="sd">* a release tarball, produced by &quot;setup.py sdist&quot;, distributed through PyPI</span>

<span class="sd">Within each source tree, the version identifier (either a string or a number,</span>
<span class="sd">this tool is format-agnostic) can come from a variety of places:</span>

<span class="sd">* ask the VCS tool itself, e.g. &quot;git describe&quot; (for checkouts), which knows</span>
<span class="sd">  about recent &quot;tags&quot; and an absolute revision-id</span>
<span class="sd">* the name of the directory into which the tarball was unpacked</span>
<span class="sd">* an expanded VCS variable ($Id$, etc)</span>
<span class="sd">* a `_version.py` created by some earlier build step</span>

<span class="sd">For released software, the version identifier is closely related to a VCS</span>
<span class="sd">tag. Some projects use tag names that include more than just the version</span>
<span class="sd">string (e.g. &quot;myproject-1.2&quot; instead of just &quot;1.2&quot;), in which case the tool</span>
<span class="sd">needs to strip the tag prefix to extract the version identifier. For</span>
<span class="sd">unreleased software (between tags), the version identifier should provide</span>
<span class="sd">enough information to help developers recreate the same tree, while also</span>
<span class="sd">giving them an idea of roughly how old the tree is (after version 1.2, before</span>
<span class="sd">version 1.3). Many VCS systems can report a description that captures this,</span>
<span class="sd">for example &#39;git describe --tags --dirty --always&#39; reports things like</span>
<span class="sd">&quot;0.7-1-g574ab98-dirty&quot; to indicate that the checkout is one revision past the</span>
<span class="sd">0.7 tag, has a unique revision id of &quot;574ab98&quot;, and is &quot;dirty&quot; (it has</span>
<span class="sd">uncommitted changes.</span>

<span class="sd">The version identifier is used for multiple purposes:</span>

<span class="sd">* to allow the module to self-identify its version: `myproject.__version__`</span>
<span class="sd">* to choose a name and prefix for a &#39;setup.py sdist&#39; tarball</span>

<span class="sd">## Theory of Operation</span>

<span class="sd">Versioneer works by adding a special `_version.py` file into your source</span>
<span class="sd">tree, where your `__init__.py` can import it. This `_version.py` knows how to</span>
<span class="sd">dynamically ask the VCS tool for version information at import time. However,</span>
<span class="sd">when you use &quot;setup.py build&quot; or &quot;setup.py sdist&quot;, `_version.py` in the new</span>
<span class="sd">copy is replaced by a small static file that contains just the generated</span>
<span class="sd">version data.</span>

<span class="sd">`_version.py` also contains `$Revision$` markers, and the installation</span>
<span class="sd">process marks `_version.py` to have this marker rewritten with a tag name</span>
<span class="sd">during the &quot;git archive&quot; command. As a result, generated tarballs will</span>
<span class="sd">contain enough information to get the proper version.</span>


<span class="sd">## Installation</span>

<span class="sd">First, decide on values for the following configuration variables:</span>

<span class="sd">* `versionfile_source`:</span>

<span class="sd">  A project-relative pathname into which the generated version strings should</span>
<span class="sd">  be written. This is usually a `_version.py` next to your project&#39;s main</span>
<span class="sd">  `__init__.py` file. If your project uses `src/myproject/__init__.py`, this</span>
<span class="sd">  should be `src/myproject/_version.py`. This file should be checked in to</span>
<span class="sd">  your VCS as usual: the copy created below by `setup.py versioneer` will</span>
<span class="sd">  include code that parses expanded VCS keywords in generated tarballs. The</span>
<span class="sd">  &#39;build&#39; and &#39;sdist&#39; commands will replace it with a copy that has just the</span>
<span class="sd">  calculated version string.</span>

<span class="sd">*  `versionfile_build`:</span>

<span class="sd">  Like `versionfile_source`, but relative to the build directory instead of</span>
<span class="sd">  the source directory. These will differ when your setup.py uses</span>
<span class="sd">  &#39;package_dir=&#39;. If you have `package_dir={&#39;myproject&#39;: &#39;src/myproject&#39;}`,</span>
<span class="sd">  then you will probably have `versionfile_build=&#39;myproject/_version.py&#39;` and</span>
<span class="sd">  `versionfile_source=&#39;src/myproject/_version.py&#39;`.</span>

<span class="sd">* `tag_prefix`:</span>

<span class="sd">  a string, like &#39;PROJECTNAME-&#39;, which appears at the start of all VCS tags.</span>
<span class="sd">  If your tags look like &#39;myproject-1.2.0&#39;, then you should use</span>
<span class="sd">  tag_prefix=&#39;myproject-&#39;. If you use unprefixed tags like &#39;1.2.0&#39;, this</span>
<span class="sd">  should be an empty string.</span>

<span class="sd">* `parentdir_prefix`:</span>

<span class="sd">  a string, frequently the same as tag_prefix, which appears at the start of</span>
<span class="sd">  all unpacked tarball filenames. If your tarball unpacks into</span>
<span class="sd">  &#39;myproject-1.2.0&#39;, this should be &#39;myproject-&#39;.</span>

<span class="sd">This tool provides one script, named `versioneer-installer`. That script does</span>
<span class="sd">one thing: write a copy of `versioneer.py` into the current directory.</span>

<span class="sd">To versioneer-enable your project:</span>

<span class="sd">* 1: Run `versioneer-installer` to copy `versioneer.py` into the top of your</span>
<span class="sd">  source tree.</span>

<span class="sd">* 2: add the following lines to the top of your `setup.py`, with the</span>
<span class="sd">  configuration values you decided earlier:</span>

<span class="sd">        import versioneer</span>
<span class="sd">        versioneer.versionfile_source = &#39;src/myproject/_version.py&#39;</span>
<span class="sd">        versioneer.versionfile_build = &#39;myproject/_version.py&#39;</span>
<span class="sd">        versioneer.tag_prefix = &#39;&#39; # tags are like 1.2.0</span>
<span class="sd">        versioneer.parentdir_prefix = &#39;myproject-&#39; # dirname like &#39;myproject-1.2.0&#39;</span>

<span class="sd">* 3: add the following arguments to the setup() call in your setup.py:</span>

<span class="sd">        version=versioneer.get_version(),</span>
<span class="sd">        cmdclass=versioneer.get_cmdclass(),</span>

<span class="sd">* 4: now run `setup.py versioneer`, which will create `_version.py`, and</span>
<span class="sd">  will modify your `__init__.py` to define `__version__` (by calling a</span>
<span class="sd">  function from `_version.py`). It will also modify your `MANIFEST.in` to</span>
<span class="sd">  include both `versioneer.py` and the generated `_version.py` in sdist</span>
<span class="sd">  tarballs.</span>

<span class="sd">* 5: commit these changes to your VCS. To make sure you won&#39;t forget,</span>
<span class="sd">  `setup.py versioneer` will mark everything it touched for addition.</span>

<span class="sd">## Post-Installation Usage</span>

<span class="sd">Once established, all uses of your tree from a VCS checkout should get the</span>
<span class="sd">current version string. All generated tarballs should include an embedded</span>
<span class="sd">version string (so users who unpack them will not need a VCS tool installed).</span>

<span class="sd">If you distribute your project through PyPI, then the release process should</span>
<span class="sd">boil down to two steps:</span>

<span class="sd">* 1: git tag 1.0</span>
<span class="sd">* 2: python setup.py register sdist upload</span>

<span class="sd">If you distribute it through github (i.e. users use github to generate</span>
<span class="sd">tarballs with `git archive`), the process is:</span>

<span class="sd">* 1: git tag 1.0</span>
<span class="sd">* 2: git push; git push --tags</span>

<span class="sd">Currently, all version strings must be based upon a tag. Versioneer will</span>
<span class="sd">report &quot;unknown&quot; until your tree has at least one tag in its history. This</span>
<span class="sd">restriction will be fixed eventually (see issue #12).</span>

<span class="sd">## Version-String Flavors</span>

<span class="sd">Code which uses Versioneer can learn about its version string at runtime by</span>
<span class="sd">importing `_version` from your main `__init__.py` file and running the</span>
<span class="sd">`get_versions()` function. From the &quot;outside&quot; (e.g. in `setup.py`), you can</span>
<span class="sd">import the top-level `versioneer.py` and run `get_versions()`.</span>

<span class="sd">Both functions return a dictionary with different keys for different flavors</span>
<span class="sd">of the version string:</span>

<span class="sd">* `[&#39;version&#39;]`: condensed tag+distance+shortid+dirty identifier. For git,</span>
<span class="sd">  this uses the output of `git describe --tags --dirty --always` but strips</span>
<span class="sd">  the tag_prefix. For example &quot;0.11-2-g1076c97-dirty&quot; indicates that the tree</span>
<span class="sd">  is like the &quot;1076c97&quot; commit but has uncommitted changes (&quot;-dirty&quot;), and</span>
<span class="sd">  that this commit is two revisions (&quot;-2-&quot;) beyond the &quot;0.11&quot; tag. For</span>
<span class="sd">  released software (exactly equal to a known tag), the identifier will only</span>
<span class="sd">  contain the stripped tag, e.g. &quot;0.11&quot;.</span>

<span class="sd">* `[&#39;full&#39;]`: detailed revision identifier. For Git, this is the full SHA1</span>
<span class="sd">  commit id, followed by &quot;-dirty&quot; if the tree contains uncommitted changes,</span>
<span class="sd">  e.g. &quot;1076c978a8d3cfc70f408fe5974aa6c092c949ac-dirty&quot;.</span>

<span class="sd">Some variants are more useful than others. Including `full` in a bug report</span>
<span class="sd">should allow developers to reconstruct the exact code being tested (or</span>
<span class="sd">indicate the presence of local changes that should be shared with the</span>
<span class="sd">developers). `version` is suitable for display in an &quot;about&quot; box or a CLI</span>
<span class="sd">`--version` output: it can be easily compared against release notes and lists</span>
<span class="sd">of bugs fixed in various releases.</span>

<span class="sd">In the future, this will also include a</span>
<span class="sd">[PEP-0440](http://legacy.python.org/dev/peps/pep-0440/) -compatible flavor</span>
<span class="sd">(e.g. `1.2.post0.dev123`). This loses a lot of information (and has no room</span>
<span class="sd">for a hash-based revision id), but is safe to use in a `setup.py`</span>
<span class="sd">&quot;`version=`&quot; argument. It also enables tools like *pip* to compare version</span>
<span class="sd">strings and evaluate compatibility constraint declarations.</span>

<span class="sd">The `setup.py versioneer` command adds the following text to your</span>
<span class="sd">`__init__.py` to place a basic version in `YOURPROJECT.__version__`:</span>

<span class="sd">    from ._version import get_versions</span>
<span class="sd">    __version = get_versions()[&#39;version&#39;]</span>
<span class="sd">    del get_versions</span>

<span class="sd">## Updating Versioneer</span>

<span class="sd">To upgrade your project to a new release of Versioneer, do the following:</span>

<span class="sd">* install the new Versioneer (`pip install -U versioneer` or equivalent)</span>
<span class="sd">* re-run `versioneer-installer` in your source tree to replace `versioneer.py`</span>
<span class="sd">* edit `setup.py`, if necessary, to include any new configuration settings indicated by the release notes</span>
<span class="sd">* re-run `setup.py versioneer` to replace `SRC/_version.py`</span>
<span class="sd">* commit any changed files</span>

<span class="sd">## Future Directions</span>

<span class="sd">This tool is designed to make it easily extended to other version-control</span>
<span class="sd">systems: all VCS-specific components are in separate directories like</span>
<span class="sd">src/git/ . The top-level `versioneer.py` script is assembled from these</span>
<span class="sd">components by running make-versioneer.py . In the future, make-versioneer.py</span>
<span class="sd">will take a VCS name as an argument, and will construct a version of</span>
<span class="sd">`versioneer.py` that is specific to the given VCS. It might also take the</span>
<span class="sd">configuration arguments that are currently provided manually during</span>
<span class="sd">installation by editing setup.py . Alternatively, it might go the other</span>
<span class="sd">direction and include code from all supported VCS systems, reducing the</span>
<span class="sd">number of intermediate scripts.</span>


<span class="sd">## License</span>

<span class="sd">To make Versioneer easier to embed, all its code is hereby released into the</span>
<span class="sd">public domain. The `_version.py` that it creates is also in the public</span>
<span class="sd">domain.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span> <span class="nn">distutils.command.sdist</span> <span class="kn">import</span> <span class="n">sdist</span> <span class="k">as</span> <span class="n">_sdist</span>
<span class="kn">from</span> <span class="nn">distutils.command.build</span> <span class="kn">import</span> <span class="n">build</span> <span class="k">as</span> <span class="n">_build</span>

<span class="n">versionfile_source</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">versionfile_build</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">tag_prefix</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">parentdir_prefix</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">VCS</span> <span class="o">=</span> <span class="s">&quot;git&quot;</span>


<span class="n">LONG_VERSION_PY</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s"># This file helps to compute a version number in source trees obtained from</span>
<span class="s"># git-archive tarball (such as those provided by githubs download-from-tag</span>
<span class="s"># feature). Distribution tarballs (build by setup.py sdist) and build</span>
<span class="s"># directories (produced by setup.py build) will contain a much shorter file</span>
<span class="s"># that just contains the computed version number.</span>

<span class="s"># This file is released into the public domain. Generated by</span>
<span class="s"># versioneer-0.10 (https://github.com/warner/python-versioneer)</span>

<span class="s"># these strings will be replaced by git during git-archive</span>
<span class="s">git_refnames = &quot;</span><span class="si">%(DOLLAR)s</span><span class="s">Format:</span><span class="si">%%</span><span class="s">d</span><span class="si">%(DOLLAR)s</span><span class="s">&quot;</span>
<span class="s">git_full = &quot;</span><span class="si">%(DOLLAR)s</span><span class="s">Format:</span><span class="si">%%</span><span class="s">H</span><span class="si">%(DOLLAR)s</span><span class="s">&quot;</span>


<span class="s">import subprocess</span>
<span class="s">import sys</span>
<span class="s">import errno</span>


<span class="s">def run_command(commands, args, cwd=None, verbose=False, hide_stderr=False):</span>
<span class="s">    assert isinstance(commands, list)</span>
<span class="s">    p = None</span>
<span class="s">    for c in commands:</span>
<span class="s">        try:</span>
<span class="s">            # remember shell=False, so use git.cmd on windows, not just git</span>
<span class="s">            p = subprocess.Popen([c] + args, cwd=cwd, stdout=subprocess.PIPE,</span>
<span class="s">                                 stderr=(subprocess.PIPE if hide_stderr</span>
<span class="s">                                         else None))</span>
<span class="s">            break</span>
<span class="s">        except EnvironmentError:</span>
<span class="s">            e = sys.exc_info()[1]</span>
<span class="s">            if e.errno == errno.ENOENT:</span>
<span class="s">                continue</span>
<span class="s">            if verbose:</span>
<span class="s">                print(&quot;unable to run </span><span class="si">%%</span><span class="s">s&quot; </span><span class="si">%%</span><span class="s"> args[0])</span>
<span class="s">                print(e)</span>
<span class="s">            return None</span>
<span class="s">    else:</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;unable to find command, tried </span><span class="si">%%</span><span class="s">s&quot; </span><span class="si">%%</span><span class="s"> (commands,))</span>
<span class="s">        return None</span>
<span class="s">    stdout = p.communicate()[0].strip()</span>
<span class="s">    if sys.version &gt;= &#39;3&#39;:</span>
<span class="s">        stdout = stdout.decode()</span>
<span class="s">    if p.returncode != 0:</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;unable to run </span><span class="si">%%</span><span class="s">s (error)&quot; </span><span class="si">%%</span><span class="s"> args[0])</span>
<span class="s">        return None</span>
<span class="s">    return stdout</span>


<span class="s">import sys</span>
<span class="s">import re</span>
<span class="s">import os.path</span>

<span class="s">def get_expanded_variables(versionfile_abs):</span>
<span class="s">    # the code embedded in _version.py can just fetch the value of these</span>
<span class="s">    # variables. When used from setup.py, we don&#39;t want to import</span>
<span class="s">    # _version.py, so we do it with a regexp instead. This function is not</span>
<span class="s">    # used from _version.py.</span>
<span class="s">    variables = {}</span>
<span class="s">    try:</span>
<span class="s">        f = open(versionfile_abs,&quot;r&quot;)</span>
<span class="s">        for line in f.readlines():</span>
<span class="s">            if line.strip().startswith(&quot;git_refnames =&quot;):</span>
<span class="s">                mo = re.search(r&#39;=\s*&quot;(.*)&quot;&#39;, line)</span>
<span class="s">                if mo:</span>
<span class="s">                    variables[&quot;refnames&quot;] = mo.group(1)</span>
<span class="s">            if line.strip().startswith(&quot;git_full =&quot;):</span>
<span class="s">                mo = re.search(r&#39;=\s*&quot;(.*)&quot;&#39;, line)</span>
<span class="s">                if mo:</span>
<span class="s">                    variables[&quot;full&quot;] = mo.group(1)</span>
<span class="s">        f.close()</span>
<span class="s">    except EnvironmentError:</span>
<span class="s">        pass</span>
<span class="s">    return variables</span>

<span class="s">def versions_from_expanded_variables(variables, tag_prefix, verbose=False):</span>
<span class="s">    refnames = variables[&quot;refnames&quot;].strip()</span>
<span class="s">    if refnames.startswith(&quot;$Format&quot;):</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;variables are unexpanded, not using&quot;)</span>
<span class="s">        return {} # unexpanded, so not in an unpacked git-archive tarball</span>
<span class="s">    refs = set([r.strip() for r in refnames.strip(&quot;()&quot;).split(&quot;,&quot;)])</span>
<span class="s">    # starting in git-1.8.3, tags are listed as &quot;tag: foo-1.0&quot; instead of</span>
<span class="s">    # just &quot;foo-1.0&quot;. If we see a &quot;tag: &quot; prefix, prefer those.</span>
<span class="s">    TAG = &quot;tag: &quot;</span>
<span class="s">    tags = set([r[len(TAG):] for r in refs if r.startswith(TAG)])</span>
<span class="s">    if not tags:</span>
<span class="s">        # Either we&#39;re using git &lt; 1.8.3, or there really are no tags. We use</span>
<span class="s">        # a heuristic: assume all version tags have a digit. The old git </span><span class="si">%%</span><span class="s">d</span>
<span class="s">        # expansion behaves like git log --decorate=short and strips out the</span>
<span class="s">        # refs/heads/ and refs/tags/ prefixes that would let us distinguish</span>
<span class="s">        # between branches and tags. By ignoring refnames without digits, we</span>
<span class="s">        # filter out many common branch names like &quot;release&quot; and</span>
<span class="s">        # &quot;stabilization&quot;, as well as &quot;HEAD&quot; and &quot;master&quot;.</span>
<span class="s">        tags = set([r for r in refs if re.search(r&#39;\d&#39;, r)])</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;discarding &#39;</span><span class="si">%%</span><span class="s">s&#39;, no digits&quot; </span><span class="si">%%</span><span class="s"> &quot;,&quot;.join(refs-tags))</span>
<span class="s">    if verbose:</span>
<span class="s">        print(&quot;likely tags: </span><span class="si">%%</span><span class="s">s&quot; </span><span class="si">%%</span><span class="s"> &quot;,&quot;.join(sorted(tags)))</span>
<span class="s">    for ref in sorted(tags):</span>
<span class="s">        # sorting will prefer e.g. &quot;2.0&quot; over &quot;2.0rc1&quot;</span>
<span class="s">        if ref.startswith(tag_prefix):</span>
<span class="s">            r = ref[len(tag_prefix):]</span>
<span class="s">            if verbose:</span>
<span class="s">                print(&quot;picking </span><span class="si">%%</span><span class="s">s&quot; </span><span class="si">%%</span><span class="s"> r)</span>
<span class="s">            return { &quot;version&quot;: r,</span>
<span class="s">                     &quot;full&quot;: variables[&quot;full&quot;].strip() }</span>
<span class="s">    # no suitable tags, so we use the full revision id</span>
<span class="s">    if verbose:</span>
<span class="s">        print(&quot;no suitable tags, using full revision id&quot;)</span>
<span class="s">    return { &quot;version&quot;: variables[&quot;full&quot;].strip(),</span>
<span class="s">             &quot;full&quot;: variables[&quot;full&quot;].strip() }</span>

<span class="s">def versions_from_vcs(tag_prefix, root, verbose=False):</span>
<span class="s">    # this runs &#39;git&#39; from the root of the source tree. This only gets called</span>
<span class="s">    # if the git-archive &#39;subst&#39; variables were *not* expanded, and</span>
<span class="s">    # _version.py hasn&#39;t already been rewritten with a short version string,</span>
<span class="s">    # meaning we&#39;re inside a checked out source tree.</span>

<span class="s">    if not os.path.exists(os.path.join(root, &quot;.git&quot;)):</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;no .git in </span><span class="si">%%</span><span class="s">s&quot; </span><span class="si">%%</span><span class="s"> root)</span>
<span class="s">        return {}</span>

<span class="s">    GITS = [&quot;git&quot;]</span>
<span class="s">    if sys.platform == &quot;win32&quot;:</span>
<span class="s">        GITS = [&quot;git.cmd&quot;, &quot;git.exe&quot;]</span>
<span class="s">    stdout = run_command(GITS, [&quot;describe&quot;, &quot;--tags&quot;, &quot;--dirty&quot;, &quot;--always&quot;],</span>
<span class="s">                         cwd=root)</span>
<span class="s">    if stdout is None:</span>
<span class="s">        return {}</span>
<span class="s">    if not stdout.startswith(tag_prefix):</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;tag &#39;</span><span class="si">%%</span><span class="s">s&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%%</span><span class="s">s&#39;&quot; </span><span class="si">%%</span><span class="s"> (stdout, tag_prefix))</span>
<span class="s">        return {}</span>
<span class="s">    tag = stdout[len(tag_prefix):]</span>
<span class="s">    stdout = run_command(GITS, [&quot;rev-parse&quot;, &quot;HEAD&quot;], cwd=root)</span>
<span class="s">    if stdout is None:</span>
<span class="s">        return {}</span>
<span class="s">    full = stdout.strip()</span>
<span class="s">    if tag.endswith(&quot;-dirty&quot;):</span>
<span class="s">        full += &quot;-dirty&quot;</span>
<span class="s">    return {&quot;version&quot;: tag, &quot;full&quot;: full}</span>


<span class="s">def versions_from_parentdir(parentdir_prefix, root, verbose=False):</span>
<span class="s">    # Source tarballs conventionally unpack into a directory that includes</span>
<span class="s">    # both the project name and a version string.</span>
<span class="s">    dirname = os.path.basename(root)</span>
<span class="s">    if not dirname.startswith(parentdir_prefix):</span>
<span class="s">        if verbose:</span>
<span class="s">            print(&quot;guessing rootdir is &#39;</span><span class="si">%%</span><span class="s">s&#39;, but &#39;</span><span class="si">%%</span><span class="s">s&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%%</span><span class="s">s&#39;&quot; </span><span class="si">%%</span><span class="s"></span>
<span class="s">                  (root, dirname, parentdir_prefix))</span>
<span class="s">        return None</span>
<span class="s">    return {&quot;version&quot;: dirname[len(parentdir_prefix):], &quot;full&quot;: &quot;&quot;}</span>

<span class="s">tag_prefix = &quot;</span><span class="si">%(TAG_PREFIX)s</span><span class="s">&quot;</span>
<span class="s">parentdir_prefix = &quot;</span><span class="si">%(PARENTDIR_PREFIX)s</span><span class="s">&quot;</span>
<span class="s">versionfile_source = &quot;</span><span class="si">%(VERSIONFILE_SOURCE)s</span><span class="s">&quot;</span>

<span class="s">def get_versions(default={&quot;version&quot;: &quot;unknown&quot;, &quot;full&quot;: &quot;&quot;}, verbose=False):</span>
<span class="s">    # I am in _version.py, which lives at ROOT/VERSIONFILE_SOURCE. If we have</span>
<span class="s">    # __file__, we can work backwards from there to the root. Some</span>
<span class="s">    # py2exe/bbfreeze/non-CPython implementations don&#39;t do __file__, in which</span>
<span class="s">    # case we can only use expanded variables.</span>

<span class="s">    variables = { &quot;refnames&quot;: git_refnames, &quot;full&quot;: git_full }</span>
<span class="s">    ver = versions_from_expanded_variables(variables, tag_prefix, verbose)</span>
<span class="s">    if ver:</span>
<span class="s">        return ver</span>

<span class="s">    try:</span>
<span class="s">        root = os.path.abspath(__file__)</span>
<span class="s">        # versionfile_source is the relative path from the top of the source</span>
<span class="s">        # tree (where the .git directory might live) to this file. Invert</span>
<span class="s">        # this to find the root from __file__.</span>
<span class="s">        for i in range(len(versionfile_source.split(&quot;/&quot;))):</span>
<span class="s">            root = os.path.dirname(root)</span>
<span class="s">    except NameError:</span>
<span class="s">        return default</span>

<span class="s">    return (versions_from_vcs(tag_prefix, root, verbose)</span>
<span class="s">            or versions_from_parentdir(parentdir_prefix, root, verbose)</span>
<span class="s">            or default)</span>

<span class="s">&#39;&#39;&#39;</span>


<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">errno</span>


<span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hide_stderr</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># remember shell=False, so use git.cmd on windows, not just git</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">stderr</span><span class="o">=</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">if</span> <span class="n">hide_stderr</span>
                                         <span class="k">else</span> <span class="bp">None</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;unable to run </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;unable to find command, tried </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">commands</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="s">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;unable to run </span><span class="si">%s</span><span class="s"> (error)&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">stdout</span>



<span class="k">def</span> <span class="nf">get_expanded_variables</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">):</span>
    <span class="c"># the code embedded in _version.py can just fetch the value of these</span>
    <span class="c"># variables. When used from setup.py, we don&#39;t want to import</span>
    <span class="c"># _version.py, so we do it with a regexp instead. This function is not</span>
    <span class="c"># used from _version.py.</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;git_refnames =&quot;</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;=\s*&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                    <span class="n">variables</span><span class="p">[</span><span class="s">&quot;refnames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;git_full =&quot;</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;=\s*&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                    <span class="n">variables</span><span class="p">[</span><span class="s">&quot;full&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">variables</span>

<span class="k">def</span> <span class="nf">versions_from_expanded_variables</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">refnames</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s">&quot;refnames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">refnames</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;$Format&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;variables are unexpanded, not using&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span> <span class="c"># unexpanded, so not in an unpacked git-archive tarball</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refnames</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)])</span>
    <span class="c"># starting in git-1.8.3, tags are listed as &quot;tag: foo-1.0&quot; instead of</span>
    <span class="c"># just &quot;foo-1.0&quot;. If we see a &quot;tag: &quot; prefix, prefer those.</span>
    <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;tag: &quot;</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">TAG</span><span class="p">):]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">TAG</span><span class="p">)])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
        <span class="c"># Either we&#39;re using git &lt; 1.8.3, or there really are no tags. We use</span>
        <span class="c"># a heuristic: assume all version tags have a digit. The old git %d</span>
        <span class="c"># expansion behaves like git log --decorate=short and strips out the</span>
        <span class="c"># refs/heads/ and refs/tags/ prefixes that would let us distinguish</span>
        <span class="c"># between branches and tags. By ignoring refnames without digits, we</span>
        <span class="c"># filter out many common branch names like &quot;release&quot; and</span>
        <span class="c"># &quot;stabilization&quot;, as well as &quot;HEAD&quot; and &quot;master&quot;.</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;\d&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;discarding &#39;</span><span class="si">%s</span><span class="s">&#39;, no digits&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">refs</span><span class="o">-</span><span class="n">tags</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;likely tags: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
        <span class="c"># sorting will prefer e.g. &quot;2.0&quot; over &quot;2.0rc1&quot;</span>
        <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;picking </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span>
                     <span class="s">&quot;full&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">[</span><span class="s">&quot;full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">}</span>
    <span class="c"># no suitable tags, so we use the full revision id</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;no suitable tags, using full revision id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">[</span><span class="s">&quot;full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
             <span class="s">&quot;full&quot;</span><span class="p">:</span> <span class="n">variables</span><span class="p">[</span><span class="s">&quot;full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">versions_from_vcs</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># this runs &#39;git&#39; from the root of the source tree. This only gets called</span>
    <span class="c"># if the git-archive &#39;subst&#39; variables were *not* expanded, and</span>
    <span class="c"># _version.py hasn&#39;t already been rewritten with a short version string,</span>
    <span class="c"># meaning we&#39;re inside a checked out source tree.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;.git&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;no .git in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;git&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;git.cmd&quot;</span><span class="p">,</span> <span class="s">&quot;git.exe&quot;</span><span class="p">]</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;describe&quot;</span><span class="p">,</span> <span class="s">&quot;--tags&quot;</span><span class="p">,</span> <span class="s">&quot;--dirty&quot;</span><span class="p">,</span> <span class="s">&quot;--always&quot;</span><span class="p">],</span>
                         <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stdout</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stdout</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;tag &#39;</span><span class="si">%s</span><span class="s">&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):]</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stdout</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">full</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;-dirty&quot;</span><span class="p">):</span>
        <span class="n">full</span> <span class="o">+=</span> <span class="s">&quot;-dirty&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">tag</span><span class="p">,</span> <span class="s">&quot;full&quot;</span><span class="p">:</span> <span class="n">full</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">versions_from_parentdir</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># Source tarballs conventionally unpack into a directory that includes</span>
    <span class="c"># both the project name and a version string.</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dirname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;guessing rootdir is &#39;</span><span class="si">%s</span><span class="s">&#39;, but &#39;</span><span class="si">%s</span><span class="s">&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">parentdir_prefix</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">dirname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">):],</span> <span class="s">&quot;full&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">}</span>

<span class="c"># os.path.relpath only appeared in Python-2.6 . Define it here for 2.5.</span>
<span class="k">def</span> <span class="nf">os_path_relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">):</span>
<div class="viewcode-block" id="os_path_relpath"><a class="viewcode-back" href="../Reference_Manual/versioneer-module.html#versioneer.os_path_relpath">[docs]</a>    <span class="sd">&quot;&quot;&quot;Return a relative version of a path&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;no path specified&quot;</span><span class="p">)</span>

    <span class="n">start_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">path_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>

    <span class="c"># Work out how much of the filepath is shared by start and path.</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">start_list</span><span class="p">,</span> <span class="n">path_list</span><span class="p">]))</span>

    <span class="n">rel_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start_list</span><span class="p">)</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">path_list</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rel_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">rel_list</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">do_vcs_install</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">,</span> <span class="n">ipy</span><span class="p">):</span></div>
    <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;git&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;git.cmd&quot;</span><span class="p">,</span> <span class="s">&quot;git.exe&quot;</span><span class="p">]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">,</span> <span class="n">ipy</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">me</span> <span class="o">=</span> <span class="n">__file__</span>
        <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.pyc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">me</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.pyo&quot;</span><span class="p">):</span>
            <span class="n">me</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">me</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span>
        <span class="n">versioneer_file</span> <span class="o">=</span> <span class="n">os_path_relpath</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">versioneer_file</span> <span class="o">=</span> <span class="s">&quot;versioneer.py&quot;</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">versioneer_file</span><span class="p">)</span>
    <span class="n">present</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;.gitattributes&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">versionfile_source</span><span class="p">):</span>
                <span class="k">if</span> <span class="s">&quot;export-subst&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">present</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">pass</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">present</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;.gitattributes&quot;</span><span class="p">,</span> <span class="s">&quot;a+&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> export-subst</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">versionfile_source</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;.gitattributes&quot;</span><span class="p">)</span>
    <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;add&quot;</span><span class="p">,</span> <span class="s">&quot;--&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">files</span><span class="p">)</span>

<span class="n">SHORT_VERSION_PY</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s"># This file was generated by &#39;versioneer.py&#39; (0.10) from</span>
<span class="s"># revision-control system data, or from the parent directory name of an</span>
<span class="s"># unpacked source archive. Distribution tarballs contain a pre-generated copy</span>
<span class="s"># of this file.</span>

<span class="s">version_version = &#39;</span><span class="si">%(version)s</span><span class="s">&#39;</span>
<span class="s">version_full = &#39;</span><span class="si">%(full)s</span><span class="s">&#39;</span>
<span class="s">def get_versions(default={}, verbose=False):</span>
<span class="s">    return {&#39;version&#39;: version_version, &#39;full&#39;: version_full}</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="n">DEFAULT</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span> <span class="s">&quot;full&quot;</span><span class="p">:</span> <span class="s">&quot;unknown&quot;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">versions_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">versions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">versions</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;version_version = &#39;([^&#39;]+)&#39;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
            <span class="n">versions</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;version_full = &#39;([^&#39;]+)&#39;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
            <span class="n">versions</span><span class="p">[</span><span class="s">&quot;full&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">versions</span>

<span class="k">def</span> <span class="nf">write_to_version_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SHORT_VERSION_PY</span> <span class="o">%</span> <span class="n">versions</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;set </span><span class="si">%s</span><span class="s"> to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">versions</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">get_root</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">get_versions</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">DEFAULT</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># returns dict with two keys: &#39;version&#39; and &#39;full&#39;</span>
    <span class="k">assert</span> <span class="n">versionfile_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;please set versioneer.versionfile_source&quot;</span>
    <span class="k">assert</span> <span class="n">tag_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;please set versioneer.tag_prefix&quot;</span>
    <span class="k">assert</span> <span class="n">parentdir_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;please set versioneer.parentdir_prefix&quot;</span>
    <span class="c"># I am in versioneer.py, which must live at the top of the source tree,</span>
    <span class="c"># which we use to compute the root directory. py2exe/bbfreeze/non-CPython</span>
    <span class="c"># don&#39;t have __file__, in which case we fall back to sys.argv[0] (which</span>
    <span class="c"># ought to be the setup.py script). We prefer __file__ since that&#39;s more</span>
    <span class="c"># robust in cases where setup.py was invoked in some weird way (e.g. pip)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
    <span class="n">versionfile_abs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">)</span>

    <span class="c"># extract version from first of _version.py, &#39;git describe&#39;, parentdir.</span>
    <span class="c"># This is meant to work for developers using a source checkout, for users</span>
    <span class="c"># of a tarball created by &#39;setup.py sdist&#39;, and for users of a</span>
    <span class="c"># tarball/zipball created by &#39;git archive&#39; or github&#39;s download-from-tag</span>
    <span class="c"># feature.</span>

    <span class="n">variables</span> <span class="o">=</span> <span class="n">get_expanded_variables</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_expanded_variables</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ver</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;got version from expanded variable </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ver</span>

    <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_file</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ver</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;got version from file </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">versionfile_abs</span><span class="p">,</span><span class="n">ver</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ver</span>

    <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_vcs</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ver</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;got version from git </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ver</span>

    <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_parentdir</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ver</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;got version from parentdir </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ver</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;got version from default </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)[</span><span class="s">&quot;version&quot;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">cmd_version</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;report generated version string&quot;</span>
    <span class="n">user_options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">boolean_options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">initialize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">finalize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">get_version</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Version is currently: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">cmd_build</span><span class="p">(</span><span class="n">_build</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">_build</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># now locate _version.py in the new build/ directory and replace it</span>
        <span class="c"># with an updated value</span>
        <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_lib</span><span class="p">,</span> <span class="n">versionfile_build</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;UPDATING </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SHORT_VERSION_PY</span> <span class="o">%</span> <span class="n">versions</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="s">&#39;cx_Freeze&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>  <span class="c"># cx_freeze enabled?</span>
    <span class="kn">from</span> <span class="nn">cx_Freeze.dist</span> <span class="kn">import</span> <span class="n">build_exe</span> <span class="k">as</span> <span class="n">_build_exe</span>

    <span class="k">class</span> <span class="nc">cmd_build_exe</span><span class="p">(</span><span class="n">_build_exe</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">versionfile_source</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;UPDATING </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SHORT_VERSION_PY</span> <span class="o">%</span> <span class="n">versions</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">_build_exe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LONG_VERSION_PY</span> <span class="o">%</span> <span class="p">{</span><span class="s">&quot;DOLLAR&quot;</span><span class="p">:</span> <span class="s">&quot;$&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;TAG_PREFIX&quot;</span><span class="p">:</span> <span class="n">tag_prefix</span><span class="p">,</span>
                                       <span class="s">&quot;PARENTDIR_PREFIX&quot;</span><span class="p">:</span> <span class="n">parentdir_prefix</span><span class="p">,</span>
                                       <span class="s">&quot;VERSIONFILE_SOURCE&quot;</span><span class="p">:</span> <span class="n">versionfile_source</span><span class="p">,</span>
                                       <span class="p">})</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">cmd_sdist</span><span class="p">(</span><span class="n">_sdist</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_versioneer_generated_versions</span> <span class="o">=</span> <span class="n">versions</span>
        <span class="c"># unless we update this, the command will keep using the old version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">versions</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_sdist</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_release_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
        <span class="n">_sdist</span><span class="o">.</span><span class="n">make_release_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
        <span class="c"># now locate _version.py in the new base_dir directory (remembering</span>
        <span class="c"># that it may be a hardlink) and replace it with an updated value</span>
        <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;UPDATING </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SHORT_VERSION_PY</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_versioneer_generated_versions</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">INIT_PY_SNIPPET</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">from ._version import get_versions</span>
<span class="s">__version__ = get_versions()[&#39;version&#39;]</span>
<span class="s">del get_versions</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">cmd_update_files</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;install/upgrade Versioneer files: __init__.py SRC/_version.py&quot;</span>
    <span class="n">user_options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">boolean_options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">initialize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">finalize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; creating </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">versionfile_source</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LONG_VERSION_PY</span> <span class="o">%</span> <span class="p">{</span><span class="s">&quot;DOLLAR&quot;</span><span class="p">:</span> <span class="s">&quot;$&quot;</span><span class="p">,</span>
                                   <span class="s">&quot;TAG_PREFIX&quot;</span><span class="p">:</span> <span class="n">tag_prefix</span><span class="p">,</span>
                                   <span class="s">&quot;PARENTDIR_PREFIX&quot;</span><span class="p">:</span> <span class="n">parentdir_prefix</span><span class="p">,</span>
                                   <span class="s">&quot;VERSIONFILE_SOURCE&quot;</span><span class="p">:</span> <span class="n">versionfile_source</span><span class="p">,</span>
                                   <span class="p">})</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">ipy</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">versionfile_source</span><span class="p">),</span> <span class="s">&quot;__init__.py&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipy</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">INIT_PY_SNIPPET</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; appending to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ipy</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipy</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">INIT_PY_SNIPPET</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%s</span><span class="s"> unmodified&quot;</span> <span class="o">%</span> <span class="n">ipy</span><span class="p">)</span>

        <span class="c"># Make sure both the top-level &quot;versioneer.py&quot; and versionfile_source</span>
        <span class="c"># (PKG/_version.py, used by runtime code) are in MANIFEST.in, so</span>
        <span class="c"># they&#39;ll be copied into source distributions. Pip won&#39;t be able to</span>
        <span class="c"># install the package without this.</span>
        <span class="n">manifest_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_root</span><span class="p">(),</span> <span class="s">&quot;MANIFEST.in&quot;</span><span class="p">)</span>
        <span class="n">simple_includes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;include &quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">simple_includes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">include</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># That doesn&#39;t cover everything MANIFEST.in can do</span>
        <span class="c"># (http://docs.python.org/2/distutils/sourcedist.html#commands), so</span>
        <span class="c"># it might give some false negatives. Appending redundant &#39;include&#39;</span>
        <span class="c"># lines is safe, though.</span>
        <span class="k">if</span> <span class="s">&quot;versioneer.py&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simple_includes</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; appending &#39;versioneer.py&#39; to MANIFEST.in&quot;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;include versioneer.py</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; &#39;versioneer.py&#39; already in MANIFEST.in&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">versionfile_source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simple_includes</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; appending versionfile_source (&#39;</span><span class="si">%s</span><span class="s">&#39;) to MANIFEST.in&quot;</span> <span class="o">%</span>
                  <span class="n">versionfile_source</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;include </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">versionfile_source</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; versionfile_source already in MANIFEST.in&quot;</span><span class="p">)</span>

        <span class="c"># Make VCS-specific changes. For git, this means creating/changing</span>
        <span class="c"># .gitattributes to mark _version.py for export-time keyword</span>
        <span class="c"># substitution.</span>
        <span class="n">do_vcs_install</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">,</span> <span class="n">ipy</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_cmdclass</span><span class="p">():</span>
    <span class="n">cmds</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="n">cmd_version</span><span class="p">,</span>
            <span class="s">&#39;versioneer&#39;</span><span class="p">:</span> <span class="n">cmd_update_files</span><span class="p">,</span>
            <span class="s">&#39;build&#39;</span><span class="p">:</span> <span class="n">cmd_build</span><span class="p">,</span>
            <span class="s">&#39;sdist&#39;</span><span class="p">:</span> <span class="n">cmd_sdist</span><span class="p">,</span>
            <span class="p">}</span>
    <span class="k">if</span> <span class="s">&#39;cx_Freeze&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>  <span class="c"># cx_freeze enabled?</span>
        <span class="n">cmds</span><span class="p">[</span><span class="s">&#39;build_exe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_build_exe</span>
        <span class="k">del</span> <span class="n">cmds</span><span class="p">[</span><span class="s">&#39;build&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">cmds</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../index.html">Home</a></li>
<li><a href="../News/index.html">News</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>
<li><a href="../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../Forums/index.html">Forums</a></li>
<li><a href="../Team_Members/index.html">Team Members</a></li>
<li><a href="../Future_Work/index.html">Future Work</a></li>
<li><a href="../FAQ/index.html">FAQ</a></li>
<li><a href="../Links/index.html">Links</a></li>
<li><a href="../Home/pubs.html">Publications</a></li>
<li><a href="../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/_modules/versioneer.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" >Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 15, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>