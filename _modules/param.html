
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>param &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for param</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Parameters are a kind of class attribute allowing special behavior,</span>
<span class="sd">including dynamically generated parameter values, documentation</span>
<span class="sd">strings, constant and read-only parameters, and type or range checking</span>
<span class="sd">at assignment time.</span>

<span class="sd">Potentially useful for any large Python program that needs</span>
<span class="sd">user-modifiable object attributes; see the parameterized.Parameter and</span>
<span class="sd">parameterized.Parameterized classes for more information.</span>


<span class="sd">This file contains subclasses of Parameter, implementing specific</span>
<span class="sd">parameter types (e.g. Number).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># CEBALERT: we need more documentation above, now that params is a</span>
<span class="c"># separate package.</span>

<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">Parameterized</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> \
     <span class="n">descendents</span><span class="p">,</span> <span class="n">ParameterizedFunction</span><span class="p">,</span> <span class="n">ParamOverrides</span>


<span class="c">#: Top-level object to allow messaging not tied to a particular</span>
<span class="c">#: Parameterized object, as in &#39;param.main.warning(&quot;Invalid option&quot;)&#39;.</span>
<span class="n">main</span><span class="o">=</span><span class="n">Parameterized</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">)</span>


<span class="c"># A global random seed available for controlling the behaviour of</span>
<span class="c"># parameterized objects with random state.</span>
<span class="n">random_seed</span> <span class="o">=</span> <span class="mi">42</span>


<span class="c"># Set __version__ using versioneer.</span>
<span class="c">#</span>
<span class="c"># Encased in a try/except to guarantee this does not interfere with</span>
<span class="c"># using param (i.e. __init__.py and parameterized.py remain the only</span>
<span class="c"># two necessary files).</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">._version</span> <span class="kn">import</span> <span class="n">get_versions</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">()[</span><span class="s">&#39;version&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">get_versions</span>
    <span class="k">if</span> <span class="n">__version__</span><span class="o">==</span><span class="s">&#39;unknown&#39;</span><span class="p">:</span> 
        <span class="c"># Think &#39;unknown&#39; is what versioneer returns if unable to</span>
        <span class="c"># determine version info</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>       
<span class="k">except</span><span class="p">:</span>
    <span class="n">main</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Unable to determine the version of this copy of param.</span>

<span class="s">For an official release, the version is stored in param/_version.py.</span>

<span class="s">For a development copy, the version information is requested from Git</span>
<span class="s">by param/_version.py.</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>


<div class="viewcode-block" id="produce_value"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.produce_value">[docs]</a><span class="k">def</span> <span class="nf">produce_value</span><span class="p">(</span><span class="n">value_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function that produces an actual parameter from a stored</span>
<span class="sd">    object: if the object is callable, call it, otherwise return the</span>
<span class="sd">    object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value_obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value_obj</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_obj</span>

</div>
<div class="viewcode-block" id="Infinity"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Infinity">[docs]</a><span class="k">class</span> <span class="nc">Infinity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An instance of this class represents an infinite value. Unlike</span>
<span class="sd">    Python&#39;s float(&#39;inf&#39;) value, this object can be safely compared</span>
<span class="sd">    with gmpy numeric types across different gmpy versions.</span>

<span class="sd">    All operators on Infinity() return Infinity(), apart from the</span>
<span class="sd">    comparison and equality operators. Equality works by checking</span>
<span class="sd">    whether the two objects are both instances of this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__eq__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__ne__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">==</span><span class="n">other</span>
    <span class="k">def</span> <span class="nf">__lt__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">__le__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">__gt__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">__ge__</span>  <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">__add__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__ladd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__sub__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__iadd_</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&quot;Infinity()&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Time"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Time">[docs]</a><span class="k">class</span> <span class="nc">Time</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A callable object returning a number for the current time.</span>

<span class="sd">    Here &#39;time&#39; is an abstract concept that can be interpreted in any</span>
<span class="sd">    useful way.  For instance, in a simulation, it would be the</span>
<span class="sd">    current simulation time, while in a turn-taking game it could be</span>
<span class="sd">    the number of moves so far.  The key intended usage is to allow</span>
<span class="sd">    independent Parameterized objects with Dynamic parameters to</span>
<span class="sd">    remain consistent with a global reference.</span>

<span class="sd">    The time datatype (time_type) is configurable, but should</span>
<span class="sd">    typically be an exact numeric type like an integer or a rational,</span>
<span class="sd">    so that small floating-point errors do not accumulate as time is</span>
<span class="sd">    incremented repeatedly.</span>

<span class="sd">    When used as a context manager using the &#39;with&#39; statement</span>
<span class="sd">    (implemented by the __enter__ and __exit__ special methods), entry</span>
<span class="sd">    into a context pushes the state of the Time object, allowing the</span>
<span class="sd">    effect of changes to the time value to be explored by setting,</span>
<span class="sd">    incrementing or decrementing time as desired. This allows the</span>
<span class="sd">    state of time-dependent objects to be modified temporarily as a</span>
<span class="sd">    function of time, within the context&#39;s block. For instance, you</span>
<span class="sd">    could use the context manager to &quot;see into the future&quot; to collect</span>
<span class="sd">    data over multiple times, without affecting the global time state</span>
<span class="sd">    once exiting the context. Of course, you need to be careful not to</span>
<span class="sd">    do anything while in context that would affect the lasting state</span>
<span class="sd">    of your other objects, if you want things to return to their</span>
<span class="sd">    starting state when exiting the context.</span>

<span class="sd">    The starting time value of a new Time object is 0, converted to</span>
<span class="sd">    the chosen time type. Here is an illustration of how time can be</span>
<span class="sd">    manipulated using a Time object:</span>

<span class="sd">    &gt;&gt;&gt; time = Time(until=20, timestep=1)</span>
<span class="sd">    &gt;&gt;&gt; &#39;The initial time is %s&#39; % time()</span>
<span class="sd">    &#39;The initial time is 0&#39;</span>
<span class="sd">    &gt;&gt;&gt; &#39;Setting the time to %s&#39; % time(5)</span>
<span class="sd">    &#39;Setting the time to 5&#39;</span>
<span class="sd">    &gt;&gt;&gt; time += 5</span>
<span class="sd">    &gt;&gt;&gt; &#39;After incrementing by 5, the time is %s&#39; % time()</span>
<span class="sd">    &#39;After incrementing by 5, the time is 10&#39;</span>
<span class="sd">    &gt;&gt;&gt; with time as t:  # Entering a context</span>
<span class="sd">    ...     &#39;Time before iteration: %s&#39; % t()</span>
<span class="sd">    ...     &#39;Iteration: %s&#39; % [val for val in t]</span>
<span class="sd">    ...     &#39;Time after iteration: %s&#39; % t()</span>
<span class="sd">    ...     t += 2</span>
<span class="sd">    ...     &#39;The until parameter may be exceeded outside iteration: %s&#39; % t()</span>
<span class="sd">    &#39;Time before iteration: 10&#39;</span>
<span class="sd">    &#39;Iteration: [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]&#39;</span>
<span class="sd">    &#39;Time after iteration: 20&#39;</span>
<span class="sd">    &#39;The until parameter may be exceeded outside iteration: 22&#39;</span>
<span class="sd">    &gt;&gt;&gt; &#39;After exiting the context the time is back to %s&#39; % time()</span>
<span class="sd">    &#39;After exiting the context the time is back to 10&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_infinitely_iterable</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">forever</span> <span class="o">=</span> <span class="n">Infinity</span><span class="p">()</span>

    <span class="n">time_type</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Callable that Time will use to convert user-specified time</span>
<span class="s">        values into the current time; all times will be of the resulting</span>
<span class="s">        numeric type.</span>

<span class="s">        By default, time is of integer type, but you can supply any</span>
<span class="s">        arbitrary-precision type like a fixed-point decimal or a</span>
<span class="s">        rational, to allow fractional times.  Floating-point times are</span>
<span class="s">        also allowed, but are not recommended because they will suffer</span>
<span class="s">        from accumulated rounding errors.  For instance, incrementing</span>
<span class="s">        a floating-point value 0.0 by 0.05, 20 times, will not reach</span>
<span class="s">        1.0 exactly.  Instead, it will be slightly higher than 1.0,</span>
<span class="s">        because 0.05 cannot be represented exactly in a standard</span>
<span class="s">        floating point numeric type. Fixed-point or rational types</span>
<span class="s">        should be able to handle such computations exactly, avoiding</span>
<span class="s">        accumulation issues over long time intervals.</span>

<span class="s">        Some potentially useful exact number classes::</span>

<span class="s">         - int: Suitable if all times can be expressed as integers.</span>

<span class="s">         - Python&#39;s decimal.Decimal and fractions.Fraction classes:</span>
<span class="s">           widely available but slow and also awkward to specify times</span>
<span class="s">           (e.g. cannot simply type 0.05, but have to use a special</span>
<span class="s">           constructor or a string).</span>

<span class="s">         - fixedpoint.FixedPoint: Allows a natural representation of</span>
<span class="s">           times in decimal notation, but very slow and needs to be</span>
<span class="s">           installed separately.</span>

<span class="s">         - gmpy.mpq: Allows a natural representation of times in</span>
<span class="s">           decimal notation, and very fast because it uses the GNU</span>
<span class="s">           Multi-Precision library, but needs to be installed</span>
<span class="s">           separately and depends on a non-Python library.  gmpy.mpq</span>
<span class="s">           is gmpy&#39;s rational type.</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">timestep</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Stepsize to be used with the iterator interface.</span>
<span class="s">        Time can be advanced or decremented by any value, not just</span>
<span class="s">        those corresponding to the stepsize, and so this value is only</span>
<span class="s">        a default.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">until</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">forever</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         Declaration of an expected end to time values, if any.  When</span>
<span class="s">         using the iterator interface, iteration will end before this</span>
<span class="s">         value is exceeded.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exhausted</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_state</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">self_params</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">until</span><span class="p">)</span>
        <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span><span class="n">other</span><span class="o">.</span><span class="n">until</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self_params</span> <span class="o">!=</span> <span class="n">other_params</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exhausted</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exhausted</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">+</span> <span class="n">timestep</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">until</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">+=</span> <span class="n">timestep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exhausted</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

    <span class="c"># For Python 2 compatibility; can be removed for Python 3.</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="n">__next__</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">time_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When called with no arguments, returns the current time value.</span>

<span class="sd">        When called with a specified val, sets the time to it.</span>

<span class="sd">        When called with a specified time_type, changes the time_type</span>
<span class="sd">        and sets the current time to the given val (which *must* be</span>
<span class="sd">        specified) converted to that time type.  To ensure that</span>
<span class="sd">        the current state remains consistent, this is normally the only</span>
<span class="sd">        way to change the time_type of an existing Time instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">time_type</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Please specify a value for the new time_type.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_type</span><span class="p">:</span>
            <span class="n">type_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;time_type&#39;</span><span class="p">)</span>
            <span class="n">type_param</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span> <span class="o">=</span> <span class="n">time_type</span>
            <span class="n">type_param</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>


    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enter the context and push the current state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_state</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">until</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_context</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exit from the current context, restoring the previous state.</span>
<span class="sd">        The StopIteration exception raised in context will force the</span>
<span class="sd">        context to exit. Any other exception exc that is raised in the</span>
<span class="sd">        block will not be caught.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">until</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pushed_state</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_context</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pushed_state</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


</div>
<div class="viewcode-block" id="Dynamic"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Dynamic">[docs]</a><span class="k">class</span> <span class="nc">Dynamic</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value can be generated dynamically by a callable</span>
<span class="sd">    object.</span>

<span class="sd">    If a Parameter is declared as Dynamic, it can be set a callable</span>
<span class="sd">    object (such as a function or callable class), and getting the</span>
<span class="sd">    parameter&#39;s value will call that callable.</span>

<span class="sd">    Note that at present, the callable object must allow attributes</span>
<span class="sd">    to be set on itself.</span>

<span class="sd">    [Python 2.4 limitation: the callable object must be an instance of a</span>
<span class="sd">    callable class, rather than a named function or a lambda function,</span>
<span class="sd">    otherwise the object will not be picklable or deepcopyable.]</span>

<span class="sd">    If set as time_dependent, setting the Dynamic.time_fn allows the</span>
<span class="sd">    production of dynamic values to be controlled: a new value will be</span>
<span class="sd">    produced only if the current value of time_fn is different from</span>
<span class="sd">    what it was the last time the parameter value was requested.</span>

<span class="sd">    By default, the Dynamic parameters are not time_dependent so that</span>
<span class="sd">    new values are generated on every call regardless of the time. The</span>
<span class="sd">    default time_fn used when time_dependent is a single Time instance</span>
<span class="sd">    that allows general manipulations of time. It may be set to some</span>
<span class="sd">    other callable as required so long as a number is returned on each</span>
<span class="sd">    call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># CB: making Dynamic support iterators and generators is sf.net</span>
    <span class="c"># feature request 1864370. When working on that task, note that</span>
    <span class="c"># detection of a dynamic generator by &#39;callable&#39; needs to be</span>
    <span class="c"># replaced by something that matches whatever Dynamic becomes</span>
    <span class="c"># capable of using.</span>

    <span class="n">time_fn</span> <span class="o">=</span> <span class="n">Time</span><span class="p">()</span>
    <span class="n">time_dependent</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># CBENHANCEMENT: Add an &#39;epsilon&#39; slot.</span>
    <span class="c"># See email &#39;Re: simulation-time-controlled Dynamic parameters&#39;</span>
    <span class="c"># Dec 22, 2007 CB-&gt;JAB</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the superclass&#39;s __init__ and set instantiate=True if the</span>
<span class="sd">        default is dynamic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_instantiate</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_generator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_initialize_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gen</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add &#39;last time&#39; and &#39;last value&#39; attributes to the generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># CEBALERT: use a dictionary to hold these things.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&quot;_Dynamic_time_fn&quot;</span><span class="p">):</span>
            <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span>

        <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_last</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># CEB: I&#39;d use None for this, except can&#39;t compare a fixedpoint</span>
        <span class="c"># number with None (e.g. 1&gt;None but FixedPoint(1)&gt;None can&#39;t be done)</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">gen</span><span class="o">.</span><span class="n">_saved_Dynamic_last</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gen</span><span class="o">.</span><span class="n">_saved_Dynamic_time</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the superclass&#39;s __get__; if the result is not dynamic</span>
<span class="sd">        return that result, otherwise ask that result to produce a</span>
<span class="sd">        value and return it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="s">&#39;_Dynamic_last&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">gen</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_value</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the superclass&#39;s set and keep this parameter&#39;s</span>
<span class="sd">        instantiate value up to date (dynamic parameters</span>
<span class="sd">        must be instantiated).</span>

<span class="sd">        If val is dynamic, initialize it as a generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="n">dynamic</span> <span class="o">=</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_generator</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_instantiate</span><span class="p">(</span><span class="n">dynamic</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_produce_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gen</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a value from gen.</span>

<span class="sd">        If there is no time_fn, then a new value will be returned</span>
<span class="sd">        (i.e. gen will be asked to produce a new value).</span>

<span class="sd">        If force is True, or the value of time_fn() is different from</span>
<span class="sd">        what it was was last time produce_value was called, a new</span>
<span class="sd">        value will be produced and returned. Otherwise, the last value</span>
<span class="sd">        gen produced will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="s">&quot;_Dynamic_time_fn&quot;</span><span class="p">):</span>
            <span class="n">time_fn</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_time_fn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_fn</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time_fn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dependent</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">produce_value</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
            <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_last</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">time</span> <span class="o">=</span> <span class="n">time_fn</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">force</span> <span class="ow">or</span> <span class="n">time</span><span class="o">!=</span><span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_time</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">produce_value</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
                <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_last</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_time</span> <span class="o">=</span> <span class="n">time</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_last</span>

        <span class="k">return</span> <span class="n">value</span>


    <span class="k">def</span> <span class="nf">_value_is_dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the parameter is actually dynamic (i.e. the</span>
<span class="sd">        value is being generated).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">),</span><span class="s">&#39;_Dynamic_last&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the last generated value for this parameter.&quot;&quot;&quot;</span>
        <span class="n">gen</span><span class="o">=</span><span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="s">&#39;_Dynamic_last&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">gen</span><span class="o">.</span><span class="n">_Dynamic_last</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gen</span>


    <span class="k">def</span> <span class="nf">_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force a new value to be generated, and return it.&quot;&quot;&quot;</span>
        <span class="n">gen</span><span class="o">=</span><span class="nb">super</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="s">&#39;_Dynamic_last&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_value</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gen</span>

</div>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="k">def</span> <span class="nf">_is_number</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="c"># The extra check is for classes that behave like numbers, such as those</span>
    <span class="c"># found in numpy, gmpy, etc.</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__int__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__add__&#39;</span><span class="p">)):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="c"># This is for older versions of gmpy</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;qdiv&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">identity_hook</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span> <span class="k">return</span> <span class="n">val</span>



<div class="viewcode-block" id="Number"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Number">[docs]</a><span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Dynamic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A numeric Dynamic Parameter, with a default value and optional bounds.</span>

<span class="sd">    There are two types of bounds: ``bounds`` and</span>
<span class="sd">    ``softbounds``.  ``bounds`` are hard bounds: the parameter must</span>
<span class="sd">    have a value within the specified range.  The default bounds are</span>
<span class="sd">    (None,None), meaning there are actually no hard bounds.  One or</span>
<span class="sd">    both bounds can be set by specifying a value</span>
<span class="sd">    (e.g. bounds=(None,10) means there is no lower bound, and an upper</span>
<span class="sd">    bound of 10). Bounds are inclusive by default, but exclusivity</span>
<span class="sd">    can be specified for each bound by setting inclusive_bounds</span>
<span class="sd">    (e.g. inclusive_bounds=(True,False) specifies an exclusive upper</span>
<span class="sd">    bound).</span>

<span class="sd">    Number is also a type of Dynamic parameter, so its value</span>
<span class="sd">    can be set to a callable to get a dynamically generated</span>
<span class="sd">    number (see Dynamic).</span>

<span class="sd">    When not being dynamically generated, bounds are checked when a</span>
<span class="sd">    Number is created or set. Using a default value outside the hard</span>
<span class="sd">    bounds, or one that is not numeric, results in an exception. When</span>
<span class="sd">    being dynamically generated, bounds are checked when a the value</span>
<span class="sd">    of a Number is requested. A generated value that is not numeric,</span>
<span class="sd">    or is outside the hard bounds, results in an exception.</span>

<span class="sd">    As a special case, if allow_None=True (which is true by default if</span>
<span class="sd">    the parameter has a default of None when declared) then a value</span>
<span class="sd">    of None is also allowed.</span>

<span class="sd">    A separate function set_in_bounds() is provided that will</span>
<span class="sd">    silently crop the given value into the legal range, for use</span>
<span class="sd">    in, for instance, a GUI.</span>

<span class="sd">    ``softbounds`` are present to indicate the typical range of</span>
<span class="sd">    the parameter, but are not enforced. Setting the soft bounds</span>
<span class="sd">    allows, for instance, a GUI to know what values to display on</span>
<span class="sd">    sliders for the Number.</span>

<span class="sd">    Example of creating a Number::</span>
<span class="sd">      AB = Number(default=0.5, bounds=(None,10), softbounds=(0,1), doc=&#39;Distance from A to B.&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bounds&#39;</span><span class="p">,</span><span class="s">&#39;_softbounds&#39;</span><span class="p">,</span><span class="s">&#39;allow_None&#39;</span><span class="p">,</span><span class="s">&#39;inclusive_bounds&#39;</span><span class="p">,</span><span class="s">&#39;set_hook&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">softbounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">allow_None</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize this parameter object and store the bounds.</span>

<span class="sd">        Non-dynamic default values are checked against the bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_hook</span> <span class="o">=</span> <span class="n">identity_hook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inclusive_bounds</span> <span class="o">=</span> <span class="n">inclusive_bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_softbounds</span> <span class="o">=</span> <span class="n">softbounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">allow_None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">default</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as the superclass&#39;s __get__, but if the value was</span>
<span class="sd">        dynamically generated, check the bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">)</span>
        <span class="c"># CEBALERT: results in extra lookups (_value_is_dynamic() is</span>
        <span class="c"># also looking up &#39;result&#39; - should just pass it in). Note</span>
        <span class="c"># that this method is called often.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_is_dynamic</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set to the given value raising an exception if out of bounds.</span>
<span class="sd">        Also applies set_hook, providing support for conversions</span>
<span class="sd">        and transformations of the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_hook</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set to the given value, but cropped to be within the legal bounds.</span>
<span class="sd">        All objects are accepted, and no exceptions will be raised.  See</span>
<span class="sd">        crop_to_bounds for details on how cropping is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">bounded_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to_bounds</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounded_val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">bounded_val</span><span class="p">)</span>


    <span class="c"># CEBERRORALERT: doesn&#39;t take account of exclusive bounds. When</span>
    <span class="c"># the gui uses set_in_bounds(), expecting to get acceptable</span>
    <span class="c"># values, it actually gets an out-of-bounds error. When fixed,</span>
    <span class="c"># should remove hack in</span>
    <span class="c"># topo.tkgui.projectionpanel.UnitsPanel.sheet_change().</span>

    <span class="k">def</span> <span class="nf">crop_to_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the given value cropped to be within the hard bounds</span>
<span class="sd">        for this parameter.</span>

<span class="sd">        If a numeric value is passed in, check it is within the hard</span>
<span class="sd">        bounds. If it is larger than the high bound, return the high</span>
<span class="sd">        bound. If it&#39;s smaller, return the low bound. In either case, the</span>
<span class="sd">        returned value could be None.  If a non-numeric value is passed</span>
<span class="sd">        in, set to be the default value (which could be None).  In no</span>
<span class="sd">        case is an exception raised; all values are accepted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Currently, values outside the bounds are silently cropped to</span>
        <span class="c"># be inside the bounds; it may be appropriate to add a warning</span>
        <span class="c"># in such cases.</span>
        <span class="k">if</span> <span class="n">_is_number</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
            <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">vmin</span><span class="p">:</span>
                    <span class="k">return</span>  <span class="n">vmin</span>

            <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">vmax</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">vmax</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># non-numeric value sent in: reverts to default value</span>
            <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">default</span>

        <span class="k">return</span> <span class="n">val</span>


    <span class="k">def</span> <span class="nf">_checkBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">incmin</span><span class="p">,</span><span class="n">incmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inclusive_bounds</span>

            <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">incmax</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">vmax</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; must be at most </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">vmax</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">vmax</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; must be less than </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">vmax</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">incmin</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">vmin</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; must be at least </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">vmin</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">vmin</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; must be greater than </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">vmin</span><span class="p">))</span>

<span class="c">##         could consider simplifying the above to something like this untested code:</span>

<span class="c">##          too_low = False if vmin is None else</span>
<span class="c">##                    (val &lt; vmin if incmin else val &lt;= vmin) and</span>
<span class="c">##                    (val &gt; vmin if incmin else val &lt;= vmin)</span>

<span class="c">##          too_high = ...</span>

<span class="c">##          if too_low or too_high:</span>
<span class="c">##              raise ValueError(&quot;Parameter &#39;%s&#39; must be in the range %s&quot; % (self._attrib_name,self.rangestr()))</span>

<span class="c">##         where self.rangestr() formats the range using the usual notation for</span>
<span class="c">##         indicating exclusivity, e.g. &quot;[0,10)&quot;.</span>


    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the value is numeric and that it is within the hard</span>
<span class="sd">        bounds; if not, an exception is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_number</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; only takes numeric values&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_checkBounds</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_soft_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each soft bound (upper and lower), if there is a defined bound (not equal to None)</span>
<span class="sd">        then it is returned, otherwise it defaults to the hard bound. The hard bound could still be None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">hl</span><span class="p">,</span><span class="n">hu</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hl</span><span class="p">,</span><span class="n">hu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_softbounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sl</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sl</span><span class="p">,</span><span class="n">su</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_softbounds</span>


        <span class="k">if</span> <span class="n">sl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">l</span> <span class="o">=</span> <span class="n">hl</span>
        <span class="k">else</span><span class="p">:</span>          <span class="n">l</span> <span class="o">=</span> <span class="n">sl</span>

        <span class="k">if</span> <span class="n">su</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">u</span> <span class="o">=</span> <span class="n">hu</span>
        <span class="k">else</span><span class="p">:</span>          <span class="n">u</span> <span class="o">=</span> <span class="n">su</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Integer"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Integer">[docs]</a><span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Numeric Parameter required to be an Integer&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; must be an integer.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_checkBounds</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Magnitude"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Magnitude">[docs]</a><span class="k">class</span> <span class="nc">Magnitude</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Numeric Parameter required to be in the range [0.0-1.0].&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">softbounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">Number</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="n">softbounds</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>



<span class="c"># JAB: Should this and other Parameters below be a Dynamic instead?</span></div>
<div class="viewcode-block" id="Boolean"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Boolean">[docs]</a><span class="k">class</span> <span class="nc">Boolean</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Binary or tristate Boolean Parameter.&quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bounds&#39;</span><span class="p">,</span><span class="s">&#39;allow_None&#39;</span><span class="p">]</span>

    <span class="c"># CB: what does bounds=(0,1) mean/do for this Parameter? (Maybe we meant to inherit from</span>
    <span class="c"># Integer?)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">allow_None</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">allow_None</span><span class="p">)</span>
        <span class="n">Parameter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Boolean &#39;</span><span class="si">%s</span><span class="s">&#39; only takes a Boolean value or None.&quot;</span>
                                 <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Boolean &#39;</span><span class="si">%s</span><span class="s">&#39; must be True, False, or None.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Boolean &#39;</span><span class="si">%s</span><span class="s">&#39; only takes a Boolean value.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Boolean &#39;</span><span class="si">%s</span><span class="s">&#39; must be True or False.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="NumericTuple"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.NumericTuple">[docs]</a><span class="k">class</span> <span class="nc">NumericTuple</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A numeric tuple Parameter (e.g. (4.5,7.6,3)) with a fixed tuple length.&quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;length&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">length</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a numeric tuple parameter with a fixed length</span>
<span class="sd">        (number of elements).  The length is determined by the initial</span>
<span class="sd">        default value, and is not allowed to change after</span>
<span class="sd">        instantiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="n">Parameter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;NumericTuple &#39;</span><span class="si">%s</span><span class="s">&#39; only takes a tuple value.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: tuple is not of the correct length (</span><span class="si">%d</span><span class="s"> instead of </span><span class="si">%d</span><span class="s">).&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_number</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: tuple element is not numeric: </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NumericTuple</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="XYCoordinates"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.XYCoordinates">[docs]</a><span class="k">class</span> <span class="nc">XYCoordinates</span><span class="p">(</span><span class="n">NumericTuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A NumericTuple for an X,Y coordinate.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">XYCoordinates</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Callable"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Callable">[docs]</a><span class="k">class</span> <span class="nc">Callable</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter holding a value that is a callable object, such as a function.</span>

<span class="sd">    A keyword argument instantiate=True should be provided when a</span>
<span class="sd">    function object is used that might have state.  On the other hand,</span>
<span class="sd">    regular standalone functions cannot be deepcopied as of Python</span>
<span class="sd">    2.4, so instantiate must be False for those values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Callable &#39;</span><span class="si">%s</span><span class="s">&#39; only takes a callable object.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Callable</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>



<span class="c"># CBNOTE: python now has abstract base classes, so we could update</span>
<span class="c"># this. At least if the check is in a method, all such checks could be</span>
<span class="c"># changed at once.</span></div>
<span class="k">def</span> <span class="nf">_is_abstract</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">class_</span><span class="o">.</span><span class="n">abstract</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>



<span class="c"># CEBALERT: this should be a method of ClassSelector.</span>
<div class="viewcode-block" id="concrete_descendents"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.concrete_descendents">[docs]</a><span class="k">def</span> <span class="nf">concrete_descendents</span><span class="p">(</span><span class="n">parentclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary containing all subclasses of the specified</span>
<span class="sd">    parentclass, including the parentclass.  Only classes that are</span>
<span class="sd">    defined in scripts that have been run or modules that have been</span>
<span class="sd">    imported are included, so the caller will usually first do ``from</span>
<span class="sd">    package import *``.</span>

<span class="sd">    Only non-abstract classes will be included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">descendents</span><span class="p">(</span><span class="n">parentclass</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_abstract</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="Composite"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Composite">[docs]</a><span class="k">class</span> <span class="nc">Composite</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Parameter that is a composite of a set of other attributes of the class.</span>

<span class="sd">    The constructor argument &#39;attribs&#39; takes a list of attribute</span>
<span class="sd">    names, which may or may not be Parameters.  Getting the parameter</span>
<span class="sd">    returns a list of the values of the constituents of the composite,</span>
<span class="sd">    in the order specified.  Likewise, setting the parameter takes a</span>
<span class="sd">    sequence of values and sets the value of the constituent</span>
<span class="sd">    attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;attribs&#39;</span><span class="p">,</span><span class="s">&#39;objtype&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attribs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attribs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">attribs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Composite</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span> <span class="o">=</span> <span class="n">attribs</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the values of all the attribs, as a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the values of all the attribs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">),</span><span class="s">&quot;Compound parameter &#39;</span><span class="si">%s</span><span class="s">&#39; got the wrong number of values (needed </span><span class="si">%d</span><span class="s">, but got </span><span class="si">%d</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Selector"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Selector">[docs]</a><span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value must be chosen from a list of possibilities.</span>

<span class="sd">    Subclasses must implement get_range().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;get_range() must be implemented in subclasses.&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ObjectSelector"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.ObjectSelector">[docs]</a><span class="k">class</span> <span class="nc">ObjectSelector</span><span class="p">(</span><span class="n">Selector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value must be one object from a list of possible objects.</span>

<span class="sd">    check_on_set restricts the value to be among the current list of</span>
<span class="sd">    objects. By default, if objects are initially supplied,</span>
<span class="sd">    check_on_set is True, whereas if no objects are initially</span>
<span class="sd">    supplied, check_on_set is False. This can be overridden by</span>
<span class="sd">    explicitly specifying check_on_set initially.</span>

<span class="sd">    If check_on_set is True (either because objects are supplied</span>
<span class="sd">    initially, or because it is explicitly specified), the default</span>
<span class="sd">    (initial) value must be among the list of objects (unless the</span>
<span class="sd">    default value is None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">,</span><span class="s">&#39;compute_default_fn&#39;</span><span class="p">,</span><span class="s">&#39;check_on_set&#39;</span><span class="p">]</span>

    <span class="c"># ObjectSelector is usually used to allow selection from a list of</span>
    <span class="c"># existing objects, therefore instantiate is False by default.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">objects</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">compute_default_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">check_on_set</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_default_fn</span> <span class="o">=</span> <span class="n">compute_default_fn</span>

        <span class="k">if</span> <span class="n">check_on_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_on_set</span><span class="o">=</span><span class="n">check_on_set</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_on_set</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_on_set</span><span class="o">=</span><span class="bp">True</span>

        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_on_set</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ObjectSelector</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="n">instantiate</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>


    <span class="c"># CBNOTE: if the list of objects is changed, the current value for</span>
    <span class="c"># this parameter in existing POs could be out of the new range.</span>

    <span class="k">def</span> <span class="nf">compute_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If this parameter&#39;s compute_default_fn is callable, call it</span>
<span class="sd">        and store the result in self.default.</span>

<span class="sd">        Also removes None from the list of objects (if the default is</span>
<span class="sd">        no longer None).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_default_fn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_default_fn</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        val must be None or one of the objects in self.objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="c"># CEBALERT: can be called before __init__ has called</span>
            <span class="c"># super&#39;s __init__, i.e. before attrib_name has been set.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attrib_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">attrib_name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> not in Parameter </span><span class="si">%s</span><span class="s">&#39;s list of possible objects&quot;</span> \
                             <span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">attrib_name</span><span class="p">))</span>

<span class="c"># CBNOTE: I think it&#39;s not helpful to do a type check for the value of</span>
<span class="c"># an ObjectSelector. If we did such type checking, any user</span>
<span class="c"># of this Parameter would have to be sure to update the list of possible</span>
<span class="c"># objects before setting the Parameter&#39;s value. As it is, only users who care about the</span>
<span class="c"># correct list of objects being displayed need to update the list.</span>
    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_on_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ObjectSelector</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>


    <span class="c"># CebAlert; move some bits into superclass (same for clsselector)?</span>
    <span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the possible objects to which this parameter could be set.</span>

<span class="sd">        (Returns the dictionary {object.name:object}.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># CEBHACKALERT: was written assuming it would only operate on</span>
        <span class="c"># Parameterized instances. Think this is an sf.net bug/feature</span>
        <span class="c"># request. Temporary fix: don&#39;t use obj.name if unavailable.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">obj</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

</div>
<div class="viewcode-block" id="ClassSelector"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.ClassSelector">[docs]</a><span class="k">class</span> <span class="nc">ClassSelector</span><span class="p">(</span><span class="n">Selector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parameter whose value is an instance of the specified class.&quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;class_&#39;</span><span class="p">,</span><span class="s">&#39;allow_None&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">class_</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">allow_None</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_</span> <span class="o">=</span> <span class="n">class_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">allow_None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ClassSelector</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="n">instantiate</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;val must be None or an instance of self.class_&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;Parameter &#39;</span><span class="si">%s</span><span class="s">&#39; value must be an instance of </span><span class="si">%s</span><span class="s">, not &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ClassSelector</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the possible types for this parameter&#39;s value.</span>

<span class="sd">        (I.e. return {name: &lt;class&gt;} for all classes that are</span>
<span class="sd">        concrete_descendents() of self.class_.)</span>

<span class="sd">        Only classes from modules that have been imported are added</span>
<span class="sd">        (see concrete_descendents()).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">concrete_descendents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_</span><span class="p">)</span>
        <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span><span class="n">class_</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">class_</span> <span class="ow">in</span> <span class="n">classes</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_None</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;None&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">return</span> <span class="n">d</span>

</div>
<div class="viewcode-block" id="List"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.List">[docs]</a><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value is a list of objects, usually of a specified type.</span>

<span class="sd">    The bounds allow a minimum and/or maximum length of</span>
<span class="sd">    list to be enforced.  If the class is non-None, all</span>
<span class="sd">    items in the list are checked to be of that type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;class_&#39;</span><span class="p">,</span><span class="s">&#39;bounds&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">[],</span><span class="n">class_</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_</span> <span class="o">=</span> <span class="n">class_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_bounds</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="n">Parameter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="n">instantiate</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c"># Could add range() method from ClassSelector, to allow</span>
    <span class="c"># list to be populated in the GUI</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set to the given value, raising an exception if out of bounds.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_bounds</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the list is of the right length and has the right contents.</span>
<span class="sd">        Otherwise, an exception is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;List &#39;</span><span class="si">%s</span><span class="s">&#39; must be a list.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">min_length</span><span class="p">,</span><span class="n">max_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">l</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">min_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">max_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_length</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: list length must be between </span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> (inclusive)&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">min_length</span><span class="p">,</span><span class="n">max_length</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">min_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">min_length</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: list length must be at least </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">min_length</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">max_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: list length must be at most </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">,</span><span class="n">max_length</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">class_</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;: &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not an instance of &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span>


</div>
<div class="viewcode-block" id="HookList"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.HookList">[docs]</a><span class="k">class</span> <span class="nc">HookList</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value is a list of callable objects.</span>

<span class="sd">    This type of List Parameter is typically used to provide a place</span>
<span class="sd">    for users to register a set of commands to be called at a</span>
<span class="sd">    specified place in some sequence of processing steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;class_&#39;</span><span class="p">,</span><span class="s">&#39;bounds&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;: &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not callable.&quot;</span>


</div>
<div class="viewcode-block" id="Dict"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Dict">[docs]</a><span class="k">class</span> <span class="nc">Dict</span><span class="p">(</span><span class="n">ClassSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value is a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Array"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Array">[docs]</a><span class="k">class</span> <span class="nc">Array</span><span class="p">(</span><span class="n">ClassSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter whose value is a numpy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="c"># CEBALERT: instead use python array as default?</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Array</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>


<span class="c"># For portable code:</span>
<span class="c">#   - specify paths in unix (rather than Windows) style;</span>
<span class="c">#   - use resolve_file_path() for paths to existing files to be read,</span>
<span class="c">#   - use resolve_folder_path() for paths to existing folders to be read,</span>
<span class="c">#     and normalize_path() for paths to new files to be written.</span>
</div>
<div class="viewcode-block" id="resolve_path"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.resolve_path">[docs]</a><span class="k">class</span> <span class="nc">resolve_path</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the path to an existing file, searching the paths specified</span>
<span class="sd">    in the search_paths parameter if the filename is not absolute, and</span>
<span class="sd">    converting a UNIX-style path to the current OS&#39;s format if</span>
<span class="sd">    necessary.</span>

<span class="sd">    To turn a supplied relative path into an absolute one, the path is</span>
<span class="sd">    appended to paths in the search_paths parameter, in order, until</span>
<span class="sd">    the file is found.</span>

<span class="sd">    An IOError is raised if the file is not found.</span>

<span class="sd">    Similar to Python&#39;s os.path.abspath(), except more search paths</span>
<span class="sd">    than just os.getcwd() can be used, and the file must exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">search_paths</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()],</span> <span class="n">pickle_default_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Prepended to a non-relative path, in order, until a file is</span>
<span class="s">        found.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">path_to_file</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pickle_default_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        String specifying whether the path refers to a &#39;File&#39; or a &#39;Folder&#39;.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">path_to_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;File &#39;</span><span class="si">%s</span><span class="s">&#39; not found.&quot;</span> <span class="o">%</span><span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">path_to_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Folder &#39;</span><span class="si">%s</span><span class="s">&#39; not found.&quot;</span> <span class="o">%</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Type &#39;</span><span class="si">%s</span><span class="s">&#39; not recognised.&quot;</span> <span class="o">%</span><span class="n">p</span><span class="o">.</span><span class="n">path_type</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">paths_tried</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">search_paths</span><span class="p">:</span>
                <span class="n">try_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">path_to_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">try_path</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">try_path</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">path_to_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">try_path</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">try_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Type &#39;</span><span class="si">%s</span><span class="s">&#39; not recognised.&quot;</span> <span class="o">%</span><span class="n">p</span><span class="o">.</span><span class="n">path_type</span><span class="p">)</span>

                <span class="n">paths_tried</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">try_path</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; was not found in the following place(s): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths_tried</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="normalize_path"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.normalize_path">[docs]</a><span class="k">class</span> <span class="nc">normalize_path</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a UNIX-style path to the current OS&#39;s format,</span>
<span class="sd">    typically for creating a new file or directory.</span>

<span class="sd">    If the path is not already absolute, it will be made absolute</span>
<span class="sd">    (using the prefix parameter).</span>

<span class="sd">    Should do the same as Python&#39;s os.path.abspath(), except using</span>
<span class="sd">    prefix rather than os.getcwd).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">pickle_default_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Prepended to the specified path, if that path is not</span>
<span class="s">        absolute.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prefix</span><span class="p">),</span><span class="n">path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Path"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Path">[docs]</a><span class="k">class</span> <span class="nc">Path</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter that can be set to a string specifying the path of a file or folder.</span>

<span class="sd">    The string should be specified in UNIX style, but it will be</span>
<span class="sd">    returned in the format of the user&#39;s operating system. Please use</span>
<span class="sd">    the Filename or Foldername classes if you require discrimination</span>
<span class="sd">    between the two possibilities.</span>

<span class="sd">    The specified path can be absolute, or relative to either:</span>

<span class="sd">    * any of the paths specified in the search_paths attribute (if</span>
<span class="sd">      search_paths is not None);</span>

<span class="sd">    or</span>

<span class="sd">    * any of the paths searched by resolve_path() (if search_paths</span>
<span class="sd">      is None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;search_paths&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">search_paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">search_paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">search_paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span> <span class="o">=</span> <span class="n">search_paths</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">search_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call Parameter&#39;s __set__, but warn if the file cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">Parameterized</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrib_name</span><span class="p">))</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an absolute, normalized path (see resolve_path).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_path</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">objtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">raw_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># don&#39;t want to pickle the search_paths</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&#39;search_paths&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s">&#39;search_paths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">state</span>


</div>
<div class="viewcode-block" id="Filename"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Filename">[docs]</a><span class="k">class</span> <span class="nc">Filename</span><span class="p">(</span><span class="n">Path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter that can be set to a string specifying the path of a file.</span>

<span class="sd">    The string should be specified in UNIX style, but it will be</span>
<span class="sd">    returned in the format of the user&#39;s operating system.</span>

<span class="sd">    The specified path can be absolute, or relative to either:</span>

<span class="sd">    * any of the paths specified in the search_paths attribute (if</span>
<span class="sd">      search_paths is not None);</span>
<span class="sd">    or</span>

<span class="sd">    * any of the paths searched by resolve_path() (if search_paths</span>
<span class="sd">      is None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_to_file</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">search_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_to_file</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Foldername"><a class="viewcode-back" href="../Reference_Manual/param-module.html#param.Foldername">[docs]</a><span class="k">class</span> <span class="nc">Foldername</span><span class="p">(</span><span class="n">Path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter that can be set to a string specifying the path of a folder.</span>

<span class="sd">    The string should be specified in UNIX style, but it will be</span>
<span class="sd">    returned in the format of the user&#39;s operating system.</span>

<span class="sd">    The specified path can be absolute, or relative to either:</span>

<span class="sd">    * any of the paths specified in the search_paths attribute (if</span>
<span class="sd">      search_paths is not None);</span>
<span class="sd">    or</span>

<span class="sd">    * any of the paths searched by resolve_dir_path() (if search_paths</span>
<span class="sd">      is None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_to_file</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">search_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">search_paths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_to_file</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../index.html">Home</a></li>
<li><a href="../News/index.html">News</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>
<li><a href="../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../Forums/index.html">Forums</a></li>
<li><a href="../Team_Members/index.html">Team Members</a></li>
<li><a href="../Future_Work/index.html">Future Work</a></li>
<li><a href="../FAQ/index.html">FAQ</a></li>
<li><a href="../Links/index.html">Links</a></li>
<li><a href="../Home/pubs.html">Publications</a></li>
<li><a href="../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/_modules/param.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="index.html" >Module code</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 15, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>