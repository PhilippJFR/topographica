<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Interfacing to external simulators &mdash; Topographica</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/custom.js"></script>
    <link rel="shortcut icon" href="../_static/topo-favicon.ico"/>
    <link rel="top" title="Topographica" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>







      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="interfacing-to-external-simulators">
<h1>Interfacing to external simulators<a class="headerlink" href="#interfacing-to-external-simulators" title="Permalink to this headline">¶</a></h1>
<p>Topographica supports a large class of models well, but there are
many models already implemented in other simulators that would take
a lot of effort to reimplement. Moreover, there are many at
different levels of analysis not well supported by Topographica,
such as simulations that include detailed internal structure for
each neuron. In order to provide a consistent framework for
evaluating competing models of the same phenomena, and for
integrating models at different levels, it can be useful to connect
external simulators to Topographica. Such simulators include
<a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a> and <a class="reference external" href="http://www.genesis-sim.org">GENESIS</a>, focusing on detailed studies of individual
neurons or very small networks of them, and <a class="reference external" href="http://www.nest-initiative.org">NEST</a>, focusing on
large networks of simple spiking neurons.</p>
<p>The general problem of interfacing between simulators is quite
difficult, for a variety of technical and conceptual reasons. Even
so, in Topographica the process can in many cases be relatively
simple, for three main reasons:</p>
<ol class="arabic simple">
<li>Many simulators now have Python interfaces, which makes it much
simpler to establish the basic lines of communication between
them and Topographica.</li>
<li>Even if the external simulator does not have its own Python
interface, Python supports a wide variety of well-supported ways
to call code written in other languages. In particular,
Topographica provides very simple interface mechanisms for
external C/C++ or Matlab code.</li>
<li>Perhaps most importantly, the abstractions implemented in
Topographica, i.e. the <a class="reference external" href="space.html">Sheet interface</a> within a general
<a class="reference external" href="time.html">event-driven framework</a>, provide a set of concepts shared
between models formulated at very different levels, making it
reasonable to compare such models and connect them within the
same framework.</li>
</ol>
<p>To be more specific, there is a very large and wide-ranging class of
models that share the property of having an array of neural units
whose firing rate is important for some computations. For instance,
even if the underlying units are spiking, and all of their
computation is based on spikes, many neurophysiological experiments
are based on measuring firing rates or average activity levels. In
Topographica these experiments can be formulated once, at a general
level, and then applied to any model that can fit into the
Topographica framework, spiking or not.</p>
<p>Interfacing to Topographica will be straightforward for a simulation
in any language that contains a large number of neurons at any level
of complexity arranged into a two-dimensional array (or a
three-dimensional stack of such two-dimensional arrays). Integrating
such a model into Topographica will, in turn, be <em>useful</em> if there
are meaningful types of analysis that rely only on an average
(firing rate) activation level for each neuron. Many such routines
based on firing rates are implemented in a fully general form in
Topographica, such as measuring receptive fields, tuning curves, and
feature preference maps, decoding activity values, and 1D, 2D, or 3D
activity or map plotting.</p>
<p>To be a part of Topographica, a model will generally need to support
one or more <a class="reference external" href="../Reference_Manual/topo.base.sheet.Sheet-class.html">Sheet</a> objects. A Sheet is required to have a fixed
area and density of neurons, and to be able to generate a
floating-point array of the appropriate size when asked for its
current pattern of activity. Once this activity matrix is available
for a new Sheet type, then nearly all of Topographica&#8217;s analysis and
plotting code can be used with the new Sheet type, e.g. to decode
neural responses from the firing rate, or to measure a topographic
map. This general-purpose interface is what makes it practical to
wrap around a wide variety of external simulations, as long as they
can be interpreted as a two-dimensional array that can have some
average firing-rate activity value.</p>
<p>To demonstrate concretely the procedure for connecting external
simulations to Topographica, in the following section we present a
detailed example of wrapping an external NEST simulation using the
Topographica Sheet interface. Shorter examples of how to interface
with a variety of other simulators follow.</p>
<div class="section" id="interfacing-to-perrinet-retinal-model-in-pynn">
<span id="perrinet-model"></span><h2>Interfacing to Perrinet retinal model in PyNN<a class="headerlink" href="#interfacing-to-perrinet-retinal-model-in-pynn" title="Permalink to this headline">¶</a></h2>
<p>For this example, we wrapped a spiking retinal ganglion cell model
(examples/perrinet_retina_pynest.py) being developed by Laurent
Perrinet (INCM/CNRS) as part of the <a class="reference external" href="http://facets.kip.uni-heidelberg.de">FACETS project</a> and used in a
large-scale spiking model of cortical columns in V1. The external
model is specified in <a class="reference external" href="http://neuralensemble.org/trac/PyNN">PyNN</a>, a Python wrapper that sets up and
runs simulations of neural models relatively independently of the
underlying simulation engine. This particular script calls the NEST
simulator, which is well adapted for large-scale spiking neural
networks, but it could also be run under NEURON by changing one line
of declaration.</p>
<p>The model contains two populations of spiking retinal ganglion
cells, a 32x32 array of ON cells and a 32x32 array of OFF cells,
receiving input from a 32x32 array of photoreceptors whose
activation level can be controlled externally. The code is in
examples/perrinet_retina.ty, and can be run by installing PyNN,
NEST, and PyNEST using Topographica&#8217;s copy of python as described in
the file.</p>
<p>The Topographica model resulting from wrapping this network as a
Photoreceptor Sheet (<tt class="docutils literal"><span class="pre">Photoreceptors</span></tt>), a connection to PyNN
(<tt class="docutils literal"><span class="pre">PyNNR</span></tt>), and two ganglion cell Sheets (<tt class="docutils literal"><span class="pre">ON_RGC</span></tt> and
<tt class="docutils literal"><span class="pre">OFF_RGC</span></tt>) is:</p>
<div class="figure align-center">
<img alt="" src="../_images/perrinet_retina_modeleditor2.png" />
</div>
<p>and the corresponding code is:</p>
<div class="highlight-python"><div class="highlight"><pre>      <span class="kn">import</span> <span class="nn">numpy</span>
      <span class="kn">import</span> <span class="nn">param</span>
      <span class="kn">from</span> <span class="nn">topo</span> <span class="kn">import</span> <span class="n">sheet</span><span class="p">,</span><span class="n">numbergen</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">projection</span>
      <span class="kn">from</span> <span class="nn">topo.base.simulation</span> <span class="kn">import</span> <span class="n">EventProcessor</span>
<span class="hll"><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="kn">import</span> <span class="nn">perrinet_retina_pynest</span> <span class="kn">as</span> <span class="nn">pynr</span>
</span>
<span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="k">class</span> <span class="nc">PyNNRetina</span><span class="p">(</span><span class="n">EventProcessor</span><span class="p">):</span>
<span class="p">(</span><span class="mi">3</span><span class="p">)</span>       <span class="n">dest_ports</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Activity&quot;</span><span class="p">]</span>
              <span class="n">src_ports</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;ONActivity&quot;</span><span class="p">,</span><span class="s">&quot;OFFActivity&quot;</span><span class="p">]</span>
              <span class="n">N</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;Network width&quot;</span><span class="p">)</span>
              <span class="n">simtime</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4000</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
                  <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Duration to simulate for each input&quot;</span><span class="p">)</span>

              <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
                  <span class="nb">super</span><span class="p">(</span><span class="n">PyNNRetina</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="hll"><span class="p">(</span><span class="mi">4</span><span class="p">)</span>           <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">=</span><span class="n">pynr</span><span class="o">.</span><span class="n">retina_default</span><span class="p">()</span>
</span><span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;N&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">})</span>
</span><span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;simtime&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">simtime</span><span class="p">})</span>
</span><span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="s">&quot;dt&quot;</span><span class="p">]</span>
</span>
<span class="p">(</span><span class="mi">5</span><span class="p">)</span>       <span class="k">def</span> <span class="nf">input_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conn</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
<span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;amplitude&quot;</span><span class="p">:</span><span class="o">.</span><span class="mi">10</span><span class="o">*</span><span class="n">data</span><span class="p">})</span>
</span><span class="hll">                  <span class="n">on_list</span><span class="p">,</span><span class="n">off_list</span><span class="o">=</span><span class="n">pynr</span><span class="o">.</span><span class="n">run_retina</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>
</span><span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">process_spikelist</span><span class="p">(</span><span class="n">on_list</span><span class="p">,</span><span class="s">&quot;ONActivity&quot;</span><span class="p">)</span>
</span><span class="hll">                  <span class="bp">self</span><span class="o">.</span><span class="n">process_spikelist</span><span class="p">(</span><span class="n">off_list</span><span class="p">,</span><span class="s">&quot;OFFActivity&quot;</span><span class="p">)</span>
</span>
<span class="p">(</span><span class="mi">6</span><span class="p">)</span>       <span class="k">def</span> <span class="nf">process_spikelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spikelist</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
<span class="hll">                  <span class="n">spikes</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spikelist</span><span class="p">)</span>
</span><span class="hll">                  <span class="n">spike_time</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">spikes</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
</span><span class="hll">                  <span class="n">spike_out</span><span class="o">=</span><span class="n">pynr</span><span class="o">.</span><span class="n">spikelist2spikematrix</span><span class="p">(</span>
</span><span class="hll">                      <span class="n">spikes</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">simtime</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</span>                  <span class="bp">self</span><span class="o">.</span><span class="n">send_output</span><span class="p">(</span><span class="n">src_port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">spike_out</span><span class="p">)</span>

<span class="p">(</span><span class="mi">7</span><span class="p">)</span>   <span class="n">N</span><span class="o">=</span><span class="mi">32</span>
          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;PyNNR&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">PyNNRetina</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;Photoreceptors&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">GeneratorSheet</span><span class="p">(</span>
               <span class="n">nominal_density</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
               <span class="n">input_generator</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span>
                   <span class="n">orientation</span><span class="o">=</span><span class="n">numbergen</span><span class="o">.</span><span class="n">UniformRandom</span><span class="p">(</span><span class="n">lbound</span><span class="o">=-</span><span class="n">pi</span><span class="p">,</span><span class="n">ubound</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>

          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;ON_RGC&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">ActivityCopy</span><span class="p">(</span><span class="n">nominal_density</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;OFF_RGC&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">ActivityCopy</span><span class="p">(</span><span class="n">nominal_density</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">precedence</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;Photoreceptors&quot;</span><span class="p">,</span><span class="s">&quot;PyNNR&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span>
              <span class="n">delay</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">src_port</span><span class="o">=</span><span class="s">&quot;Activity&quot;</span><span class="p">,</span><span class="n">dest_port</span><span class="o">=</span><span class="s">&quot;Activity&quot;</span><span class="p">)</span>
          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;PyNNR&quot;</span><span class="p">,</span><span class="s">&quot;ON_RGC&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;  &#39;</span><span class="p">,</span>
              <span class="n">delay</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">src_port</span><span class="o">=</span><span class="s">&quot;ONActivity&quot;</span><span class="p">,</span><span class="n">dest_port</span><span class="o">=</span><span class="s">&quot;Activity&quot;</span><span class="p">)</span>
          <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;PyNNR&quot;</span><span class="p">,</span><span class="s">&quot;OFF_RGC&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span>
              <span class="n">delay</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">src_port</span><span class="o">=</span><span class="s">&quot;OFFActivity&quot;</span><span class="p">,</span><span class="n">dest_port</span><span class="o">=</span><span class="s">&quot;Activity&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The example code would be nearly the same for interfacing to any
other external simulation that consists of two-dimensional arrays of
neurons, and so we will step through each part of this code to show
how the interface is achieved. In each case, the relevant line of
code is marked with a number in parentheses, which can be found on
the code listing. Note that this code constitutes the complete,
runnable model specification for Topographica; it is not an excerpt
or summary, but is all that is required to run the external
simulation within Topographica.</p>
<p>(1) First, the external simulation is imported, making anything
available to Python from that simulation also available to
Topographica. For this import to succeed, PyNN, NEST, and PyNEST
need to be installed, and each need to have been given
Topographica&#8217;s copy of Python during installation so that they will
be available to Topographica.</p>
<p>(2) Next, we define a new type of Topographica EventProcessor
<tt class="docutils literal"><span class="pre">PyNNRetina</span></tt> to handle communication between Topographica and the
external simulator. This class simply accepts an incoming event from
Topographica that contains a matrix of photoreceptor activity,
passes the matrix to the external spiking simulator, collects the
firing-rate-averaged results, and sends them out to any Topographica
sheets that may be connected.</p>
<p>(3)More specifically, the class first declares that it can accept an
incoming event on a port labeled <tt class="docutils literal"><span class="pre">Activity</span></tt>, and that it will
generate two separate types of output data to be made available on
the <tt class="docutils literal"><span class="pre">ONActivity</span></tt> and <tt class="docutils literal"><span class="pre">OFFActivity</span></tt> <tt class="docutils literal"><span class="pre">dest_ports</span></tt>. It also
declares that it has two user-controlled parameters, <tt class="docutils literal"><span class="pre">N</span></tt> (size of
array of neurons) and <tt class="docutils literal"><span class="pre">simtime</span></tt> (duration to run the simulation
for each input). (Additional parameters from the underlying
simulator can be declared similarly, or all of the underlying
parameters could be exposed as a batch using suitable gluing code.)</p>
<p>(4) The constructor (<tt class="docutils literal"><span class="pre">__init__</span></tt>) does any initialization that
should be done once per run, here consisting only of defining some
parameters, but potentially including launching an external
simulator, making a connection to an existing simulator, etc.</p>
<p>(5) The <tt class="docutils literal"><span class="pre">input_event</span></tt> method is called by Topographica whenever an
Event delivers data to this object&#8217;s <tt class="docutils literal"><span class="pre">src_port</span></tt> (<tt class="docutils literal"><span class="pre">Activity</span></tt>). In
this case, the method adds the incoming activity matrix into its
parameters data structure (<tt class="docutils literal"><span class="pre">ps</span></tt>), and then calls the external
function <tt class="docutils literal"><span class="pre">run_retina</span></tt> to run the underlying simulation. When the
external simulator completes, two lists of spikes are returned, one
for ON and one for OFF, and these are processed using the helper
function <tt class="docutils literal"><span class="pre">process_spikelist</span></tt>. (6) For each list,
<tt class="docutils literal"><span class="pre">process_spikelist</span></tt> computes the firing rate of each neuron and
sends the resulting floating-point arrays out the appropriate port.</p>
<p>(7)The remainder of the code instantiates a model network to display
the results from this class, defining one <tt class="docutils literal"><span class="pre">PyNNR</span></tt> object, a
<tt class="docutils literal"><span class="pre">Photoreceptors</span></tt> Sheet to generate input patterns, two RGC Sheets
to display the resulting activity patterns, and connections between
them.</p>
<p>With this interface in place, the external simulation can be used
with nearly all of Topographica&#8217;s features. For instance, the model
editor image above shows one example input pattern and the resulting
pattern of ON and OFF RGC activity. For this example, the main
benefit to having the Topographica wrapper is to be able to present
any of the types of input patterns in Topographica&#8217;s large library
of input patterns, using either the GUI or systematically using
Python code. For other simulations, e.g. those including cortical
areas such as V1, Topographica can compute tuning curves, receptive
fields, preference maps, and other types of analyses and plots for
any of the neurons and Sheets available to Topographica. As long as
the computation only requires average firing rates, no
special-purpose code or additional interface will be needed beyond
what is shown in this example. Thus Topographica can be used to
provide a consistent set of analyses and plots for a wide variety of
underlying simulations.</p>
</div>
<div class="section" id="interfacing-to-other-python-code-e-g-pynest-neuron">
<h2>Interfacing to other Python code (e.g., PyNEST, NEURON)<a class="headerlink" href="#interfacing-to-other-python-code-e-g-pynest-neuron" title="Permalink to this headline">¶</a></h2>
<p>The general approach outlined <a class="reference external" href="#perrinet-model">above</a> can be used for any other
model running in an external simulator that has a Python interface.
In each case, a new Topographica EventProcessor class can be created
to accept incoming events, process them somehow, and generate
appropriate output. For instance, similar steps would have been used
if the retina model had been written in PyNEST directly rather than
PyNN, or in NEURON&#8217;s own Python interface. As long as the external
simulator can be told to use Topographica&#8217;s copy of Python, then
Topographica can import the required functions, execute them as part
of such a class, and thus control its input and output.</p>
</div>
<div class="section" id="interfacing-to-matlab">
<h2>Interfacing to Matlab<a class="headerlink" href="#interfacing-to-matlab" title="Permalink to this headline">¶</a></h2>
<p>Topographica can also connect easily to external simulations running
in Matlab, using the Python&lt;-&gt;Matlab interface package <a class="reference external" href="http://mlabwrap.sourceforge.net">mlabwrap</a>
that is supplied with Topographica.</p>
<p>For instance, the following complete, runnable Topographica script
defines a small Python/numpy array <tt class="docutils literal"><span class="pre">x</span></tt> and then calls a Matlab
function ``plot&#8217;&#8217; to visualize it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">mlabwrap</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">x</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">mlab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Any Matlab function (including user scripts) can be called
similarly, with seamless interchange of scalar and array data
between the two systems. This capability makes it simple to develop
interfaces like the one outlined <a class="reference external" href="#perrinet-model">above</a>, or just to use small bits
of Matlab code when appropriate.</p>
</div>
<div class="section" id="interfacing-to-c-c">
<h2>Interfacing to C/C++<a class="headerlink" href="#interfacing-to-c-c" title="Permalink to this headline">¶</a></h2>
<p>Python offers a wide variety of methods for interfacing to C or C++
code, any of which could be used with Topographica. The specific
interface currently used for the performance-critical portions of
Topographica is <a class="reference external" href="http://www.scipy.org/Weave">Weave</a>, which allows snippets of C or C++ code to
be called easily from within Python code. A sample complete,
runnable Topographica script with C code is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">weave</span><span class="o">,</span><span class="nn">numpy</span>
<span class="n">a</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">])</span>
<span class="n">code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;printf(&quot;Hello, world </span><span class="si">%f</span><span class="se">\n</span><span class="s">&quot;,a[1]);&quot;&quot;&quot;</span>
<span class="n">weave</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">code</span><span class="p">,[</span><span class="s">&quot;a&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Here the C <tt class="docutils literal"><span class="pre">printf</span></tt> function is being used with a Python/numpy
array, and will print <tt class="docutils literal"><span class="pre">Hello,</span> <span class="pre">world</span> <span class="pre">2.000000</span></tt> when run. The first
time it is run the C compiler will be called automatically to
compile that code fragment, and then the saved object file will be
reused in subsequent calls and on subsequent runs, unless the C code
string is changed. This approach makes it simple to include bits of
existing C code to optimize specific functions, or to make calls to
C libraries.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>As the examples above show, very little coding is required to wrap
even complex simulations into the basic Sheet and EventProcessor
components used in Topographica. A large class of models across
different modelling and analysis levels (e.g., firing-rate,
integrate-and-fire, and compartmental neuron models) can fit into
this structure, allowing all of them to be analyzed and compared
consistently, interconnected where appropriate, and explored
visually even if the underlying simulator has no graphical interface
(as for NEST). Although the general problem of simulator
interoperatibility is difficult to address, in this specific case it
is relatively easy to get practical benefits from combining
simulators.</p>
<p>While the approach outlined above is general purpose, it does
require coding a Topographica component to match each specific model
implemented externally. A useful but more complex alternative would
be to provide a detailed mapping between object types in an external
simulator. For instance, one could provide a Topographica Sheet
object that instantiates a corresponding NEST layer object, and
similarly for a Topographica Projection object and a NEST connection
object. In this way NEST or other simulators could be used to
provide specific functionality missing from Topographica, rather
than to implement complete models. However, developing such
interfaces is much more involved than the simple wrapping described
here.</p>
<p>Even though the Topographica Sheet interface is general enough to
fit a wide range of current models, there are some models that do
not fit within its assumptions. In particular, a Sheet needs to have
an underlying grid shape to the population of neurons, though
individual neurons can be at jittered spatial locations (or
sometimes absent), as long as no more than one neuron is present in
any grid cell. Also, only Cartesian grids are currently supported;
hexagonal grids could be added in the future. Arbitrary 3D locations
will be difficult to support except by imposing a 3D grid. Note that
nonlinear spacings <em>are</em> supported, using arbitrary coordinate
mapping between Sheets, e.g. for foveated retinotopic mappings, as
long as there is still an underlying grid of neurons.</p>
<p>In summary, working at the topographic map level makes it practical
to provide interconnections between models and simulators working at
different levels of detail. As long as the neurons are grouped into
two-dimensional sheets of related units, they will be able to
interface easily with Topographica&#8217;s tools and components. The
result provides a shared platform for evaluating models from
different sources, allowing consistent analysis and testing even for
very different implementations.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">

<li><a href="../index.html">Home</a></li>
<li><a href="../News/index.html">News</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>
<li><a href="../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../Forums/index.html">Forums</a></li>
<li><a href="../Team_Members/index.html">Team Members</a></li>
<li><a href="../Future_Work/index.html">Future Work</a></li>
<li><a href="../FAQ/index.html">FAQ</a></li>
<li><a href="../Links/index.html">Links</a></li>
<li><a href="../Home/pubs.html">Publications</a></li>
<li><a href="../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../index.html">Table Of Contents</a></h3>

<ul>
<li><a class="reference internal" href="#">Interfacing to external simulators</a><ul>
<li><a class="reference internal" href="#interfacing-to-perrinet-retinal-model-in-pynn">Interfacing to Perrinet retinal model in PyNN</a></li>
<li><a class="reference internal" href="#interfacing-to-other-python-code-e-g-pynest-neuron">Interfacing to other Python code (e.g., PyNEST, NEURON)</a></li>
<li><a class="reference internal" href="#interfacing-to-matlab">Interfacing to Matlab</a></li>
<li><a class="reference internal" href="#interfacing-to-c-c">Interfacing to C/C++</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/User_Manual/interfacing.rst" rel="nofollow">Edit on GitHub</a></li>
    <li><a	href="http://doozy.inf.ed.ac.uk:8010/builders/topographica_docs" rel="nofollow">Rebuild docs</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>







      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>