<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running Topographica simulations in batch mode &mdash; Topographica</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/custom.js"></script>
    <link rel="shortcut icon" href="../_static/topo-favicon.ico"/>
    <link rel="top" title="Topographica" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>







      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="running-topographica-simulations-in-batch-mode">
<h1>Running Topographica simulations in batch mode<a class="headerlink" href="#running-topographica-simulations-in-batch-mode" title="Permalink to this headline">¶</a></h1>
<p>Topographica is designed so that full functionality is available
from the command line and batch mode, without any GUI required. This
support is essential for running large numbers of similar
simulations, e.g. to compare parameter settings or other options,
usually using clusters or networks of workstations.</p>
<p>To make this process simpler, Topographica provides a command
topo.command.run_batch, which puts all results into a uniquely
identifiable directory that records the options used for the run.
Example:</p>
<div class="highlight-python"><div class="highlight"><pre>topographica -a -c &quot;run_batch(&#39;~/Documents/Topographica/examples/tiny.ty&#39;)&quot;
</pre></div>
</div>
<p>(see <a class="reference external" href="../User_Manual/scripts.html#copy-examples">how to get a copy of the example files</a> if you do not have
them already).</p>
<p>Here the <a class="reference external" href="commandline.html#option-a">&#8220;-a&#8221; option</a> is used so that run_batch can be called
without importing it explicitly, and also so that all commands will
be available to the various plotting and analysis routines called by
run_batch (as described below). The result will be a directory with
a name like <tt class="docutils literal"><span class="pre">200710112056_tiny</span></tt> in the <tt class="docutils literal"><span class="pre">Output</span></tt> subdirectory of
your <tt class="docutils literal"><span class="pre">Topographica</span></tt> folder in your <tt class="docutils literal"><span class="pre">Documents</span></tt> directory (this
can be customized, and is <tt class="docutils literal"><span class="pre">~/topographica</span></tt> in release 0.9.7 and
earlier; see the note about the <a class="reference external" href="scripts.html#output-path">default output path</a> for more
information). The name encodes the date of the run (in
year/month/day/hour/minute format) plus the name of the script file.</p>
<p>If you want to override any of the options accepted by tiny.ty, you
can do that when you call run_batch:</p>
<div class="highlight-python"><div class="highlight"><pre>topographica -a -c &quot;run_batch(&#39;~/Documents/Topographica/examples/tiny.ty&#39;,cortex_density=3)&quot;
</pre></div>
</div>
<p>To help you keep the options straight, they will be encoded into the
directory name (as <tt class="docutils literal"><span class="pre">200710112056_tiny,cortex_density=3</span></tt> in this
case).</p>
<p>run_batch also accepts a parameter <tt class="docutils literal"><span class="pre">analysis_fn</span></tt>, which can be
any callable Python object (e.g. the name of a function). The
analysis_fn will be called periodically during the run, at times
specified by a parameter <tt class="docutils literal"><span class="pre">times</span></tt> (e.g.
<tt class="docutils literal"><span class="pre">[0.5,2.8,100,500,1000,5000]</span></tt>). The simulation will complete after
the last analysis time.</p>
<p>The default analysis_fn creates a few plots each time and saves the
current script_repr() of the simulation to record the parameter
settings from that time. In practice you will want to supply your
own function, defined either in your .ty file or in a separate
script or module executed before you call run_batch. In this case
you can start from the default_analysis_function in
topo/command/basic.py as an example. Your analysis_fn should avoid
using any GUI functions (i.e., should not import anything from
topo.tkgui), and it should save all of its results into files. For
more information about commands that can go into the analysis_fn,
see the <a class="reference external" href="commandline.html">command line/script language</a> section.</p>
<p>As you might expect, you can provide any other options before or
after the run_batch call, as usual. These will be processed before
or after the batch run, respectively:</p>
<div class="highlight-python"><div class="highlight"><pre>topographica -a -c &quot;save_script_repr()&quot; -p cortex_density=3\
-c &quot;run_batch(&#39;~/Documents/Topographica/examples/tiny.ty&#39;)&quot; \
-c &quot;save_snapshot()&quot;
</pre></div>
</div>
<p>Note that the output directory is not created or changed until the
run_batch command is executed, so the output from the
save_script_repr() command will go into the default output
directory. Also note that when a parameter is set before run_batch
(as cortex_density is in this example), it will not be encoded into
the directory filename, because run_batch will not be aware that it
has changed. Similarly, any errors in the commands provided before
or after run_batch will not show up in the .out file stored in the
simulation directory, because that is closed when run_batch
completes. Thus it&#8217;s usually best to use run_batch&#8217;s options rather
than the separate commands shown in this example.</p>
<div class="section" id="lancet">
<h2>Lancet<a class="headerlink" href="#lancet" title="Permalink to this headline">¶</a></h2>
<p>Once you get used to run_batch, you&#8217;ll often want to run a large
number of coordinated run_batch runs, e.g. to do a parameter
search. Topographica works well with <a class="reference external" href="https://github.com/ioam/lancet/">Lancet</a>, which provides these
features and many more. Lancet allows you to specify parameter
spaces to cover, launch multiple jobs (on single machines or
computing clusters), collate the results, generate figures and
analyses from the results, and archive these for posterity. See the
Lancet site for more details.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">

<li><a href="../index.html">Home</a></li>
<li><a href="../News/index.html">News</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>
<li><a href="../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="http://github.com/ioam/topographica">Github Source Code</a></li>
<li><a href="../Forums/index.html">Forums</a></li>
<li><a href="../Team_Members/index.html">Team Members</a></li>
<li><a href="../Future_Work/index.html">Future Work</a></li>
<li><a href="../FAQ/index.html">FAQ</a></li>
<li><a href="../Links/index.html">Links</a></li>
<li><a href="../Home/pubs.html">Publications</a></li>
<li><a href="../site_map.html">Site Map</a></li>
</ul>
<h3><a href="../index.html">Table Of Contents</a></h3>

<ul>
<li><a class="reference internal" href="#">Running Topographica simulations in batch mode</a><ul>
<li><a class="reference internal" href="#lancet">Lancet</a></li>
</ul>
</li>
</ul>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/ioam/topographica/edit/master/doc/User_Manual/batch.rst" rel="nofollow">Edit on GitHub</a></li>
    <li><a	href="http://doozy.inf.ed.ac.uk:8010/builders/topographica_docs" rel="nofollow">Rebuild docs</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>

<li><a href="../index.html">Home</a></li>
<li><a href="../Downloads/index.html">Downloads</a></li>
<li><a href="../Tutorials/index.html">Tutorials</a></li>
<li><a href="index.html">User Manual</a></li>







      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>